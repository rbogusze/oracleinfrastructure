= Nice links =
General:
  * Oracle E-Business Suite Release 12.2 Information Center (Doc ID 1581299.1)
  * How to find the Latest, Recommended Patches for E-business Suite R12 or 11i (Doc ID 1525452.1)

RAC and R12
  * Using Oracle 11g Release 2 Real Application Clusters and Automatic storage management with Oracle E-Business Suite Release 12.2 (Doc ID 1453213.1)
  * Oracle E-Business Suite Release 12.2: Adding or Deleting 11gR2 Oracle RAC Nodes (Doc ID 1570554.1)
  * Cloning Oracle E-Business Suite Release 12.2 RAC Enabled Systems with Rapid Clone (Doc ID 1679270.1)
  * Concurrent Processing - How To Ensure Load Balancing Of Concurrent Manager Processes In PCP-RAC Configuration (Doc ID 762024.1)
  * Configuring and Managing E-Business Application Tier for RAC (Doc ID 1311528.1)
  * Concurrent Manager Do Not Fail Over When One Rac Instance Goes Down. (Doc ID 1335036.1)
  * How to Activate Parallel Concurrent Processing - Background Facts and Setup Steps [ID 602899.1]
  * Concurrent Processing - Parallel Concurrent Processing Failover/Failback Expectations (Doc ID 271090.1)

PCP and Non-RAC
  * How to Setup and Test Failover of PCP on Non-RAC Environments. [ID 743716.1]

Client browser
  * Recommended Browsers for Oracle E-Business Suite Release 12 (Doc ID 389422.1)
  * https://blogs.oracle.com/stevenChan/entry/java_blocked_ie_error_ebs

Security:
  * Document 403537.1, Secure Configuration Guide for Oracle E-Business Suite Release 12

== Installation ==
  * OracleÂ® E-Business Suite Installation Guide: Using Rapid Install Release 12.2 (12.2.0) Part No. E22950-14
http://docs.oracle.com/cd/V39571_01/current/acrobat/122oaig.pdf



== Others ==
  * Oracle E-Business Suite Release 12.2: Online Patching FAQ (Doc ID 1583902.1)
  * Oracle E-Business Suite Maintenance Guide Release 12.2
  * http://docs.oracle.com/cd/E26401_01/doc.122/e22954/T202991T206856.htm
  * Oracle E-Business Suite Concepts
  * http://docs.oracle.com/cd/E26401_01/doc.122/e22949/toc.htm
  * Autoconfig Scripts adstrtal.sh and adstpall.sh Cannot Have All Require Parameters Passed To Them. (Doc ID 1902776.1)
  * How To Change or Reset The WebLogic Administration Password In 12.2 E-Business Suite (Doc ID 1385751.1)
  * How to upgrade Oracle E-Business Suite from 11i to 12.1.1 and keep the existing 10g Database? [ID 1345020.1]

  * https://blogs.oracle.com/stevenChan/entry/five_errors_customers_make_when


= Installing Oracle E-Business Suite Release 12.2 under OEL 5.10 x86-64 =

== Install Oracle Enterprise Linux 5.10 ==
Oracle Linux Release 5 Update 10 for x86_64 (64 Bit)	V40139-01	4.0G
V40139-01.iso	MD5		1AA0A1246B1A55108ABF20AA2BCAC00E

I used two hosts. One for APP tier and one for DB tier. This is the configuration that you will find in most production environments.

Resources:
|| Tier || u01 size  || RAM minimal || CPU minimal      ||
|| APP  || 200G disk || 7G RAM      || 1 socket 6 cores ||
|| DB   || 250G disk || 5G RAM      || 1 socket 4 cores ||

Notes:
  * additionally 20G for OS isntallation, including 4G swap

Install OEL 5.10 with the most basic options. I first devote 20G for OS as /dev/sda and let the OEL installer do the default partitioning.
  * firewall disabled
  * SE linux disabled
  * do not create any users, just the root account is what we need

Disable yum-updatesd
{{{
# service yum-updatesd stop
# chkconfig --levels 2345 yum-updatesd off
}}}

Disable X Windows at System Boot
{{{
# vi /etc/inittab
change from
id:5:initdefault:
to
id:3:initdefault:
# reboot
}}}

Enable some other repositories
{{{
# vim /etc/yum.repos.d/public-yum-el5.repo
[el5_latest]
[el5_addons]
[el5_oracle_addons]
[ol5_UEK_latest]
[ol5_UEK_base]
gpgcheck=1
enabled=1
}}}

Install basic dependencies for EBS R12
{{{
# yum install oracle-ebs-server-R12-preinstall
}}}

To avoid problems with /usr/lib64/libpthread_nonshared.a
{{{
# yum install oracle-validated
}}}

Now I can install SVN to download some automation scripts I have prepared
{{{
# yum install subversion
}}}



Now this is my unusual linux configuration script. You probably do not want to do it, because it sets a certain DNS, domain name, public key, vmware tools, etc. but this is what I do, that is why I put it here.

{{{
# cd
# svn checkout https://oracleinfrastructure.googlecode.com/svn/trunk/scripto scripto
}}}

Review the script and see what makes sense in your environment.
{{{
# cd ~/scripto/linux/
# ./linux_setup.sh ALL
(repeated few times untill no reboots are required)
}}}

To save on IO disable atime
  * http://wlangiewicz.com/2013/02/18/what-is-kjournald-and-why-its-using-99-of-io-what-about-noatime/
change the mount parameter to include noatime.
{{{
# vim /etc/fstab
/dev/VolGroup00/LogVol00 /                       ext3    defaults,noatime        1 1
}}}

If X forwarding does not work:
{{{
# vi /etc/ssh/sshd_config
X11UseLocalhost no
# /etc/init.d/sshd restart
}}}


== Create user and group ==
No need to create them manually, they sould be present after oracle-ebs-server-R12-preinstall installation.

{{{
# cat /etc/passwd
oracle:x:54321:54321::/home/oracle:/bin/bash
applmgr:x:54322:54321::/home/applmgr:/bin/bash
}}}

{{{
# cat /etc/group
oinstall:x:54321:applmgr
dba:x:54322:oracle
}}}

Set passwords
{{{
# passwd oracle
# passwd applmgr
}}}


== Create the /u01 mount point ==
Create the /u01 mount point that will store app or db tier data on respective nodes.

I use LVM to facilitate future expansion. My /dev/sdb is additional drive that will be used for that.
{{{
# pvcreate /dev/sdb
# vgcreate vg_u01 /dev/sdb
# lvcreate --name u01 --extents 100%FREE vg_u01
# mkfs.ext4 /dev/vg_u01/u01
}}}

{{{
# vim /etc/fstab
/dev/vg_u01/u01	/u01		ext4	defaults,noatime	0 0
}}}

{{{
# mkdir /u01
# mount /u01
}}}

oraInv.loc should be created
{{{
# echo "inventory_loc=/u01/oraInventory" > /etc/oraInst.loc
# echo "inst_group=oinstall" >> /etc/oraInst.loc
$ mkdir /u01/oraInventory
}}}

== Contents of /etc/hosts ==
Make sure that both app and DB tiers can see each other by the hostname. Pay attention to the 'IP name.domain name' convention. Do not use tabs, just single space between values.

{{{
# vi /etc/hosts
  #7.0.0.1 localhost
  #2.168.1.160 ebs3.remik.org ebs3
  #2.168.1.161 ebsdb3.remik.org ebsdb3
}}}



== IO sanity checks ==
EBS and especially ADOP cycle is pretty IO intensive. On low end storage the patching can take many days to complete. To have some idea how much time we can expect I have made the following observations:

=== Poorly configured system (something is way too slow) ===
MT on NFS
$ time dd if=/dev/zero of=./testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 28.7702 seconds, 32.1 MB/s
real	0m28.845s

$ time dd if=./testfile of=/dev/null bs=16k



== Create staging area ==
=== Download the EBS 12.2 binaries and check the md5 sum ===
DO NOT unpack the downloaded files.

MOS:
  * MD5 Checksums for R12.2 Rapid Install Media (Doc ID 1505510.1)

Download the md5_linux.txt file.

{{{
$ md5sum --check md5_linux.txt > md5sum_result.txt
md5sum: WARNING: 1 of 12822 computed checksums did NOT match
}}}

The only failed czecksum is in my installation:
{{{
$ cat md5sum_result.txt | grep -v OK
TechInstallMedia/ohs11116/Disk1/stage/prereq/linux64/refhost.xml: FAILED
}}}

The staging area is created on Samba share and mounted on app and DB tiers.

On the client:
{{{
# vim /etc/fstab
//192.168.1.10/STAGING	/STAGING	cifs credentials=/etc/samba/cred-file 0 0
# cat /etc/samba/cred-file
username=remik
password=
}}}

{{{
# mkdir /STAGING
# mount /STAGING
}}}

=== apply recent startcd patch ===
Patch 17873425: RI STARTCD 12.2.0.47_5
MD5	9EFFF779D2870CD83451A13E830951EF

Download the patch zip file to the place where you have all (around 80G) EBS 12.2 installation media. Do not unzip any other file, except those mentioned.

{{{
# unzip p17873425_R12_GENERIC.zip
}}}

Run as root
{{{
# cd startCD/Disk1/rapidwiz
# ./RapidWizVersion
Oracle E-Business Suite Rapid Install Wizard
Version 12.2.0.47
# cd bin
# ./buildStage.sh
  #     Create new stage area
2.    Linux x86 (64-bit)
}}}

The above command actually unzipped the installation media files. Now we are ready to start the installation.


== Installation on two hosts ==
(now it is a good time to take a before_installation snapchot)

=== DB tier ===
This will take a while, run in under vncserver session
{{{
# vncserver
}}}

Connect to the VNC session
{{{
$ vncviewer ebsdb3.remik.org:1
}}}

Run as root
{{{
# chown oracle:oinstall /u01
# cd /STAGING/startCD/Disk1/rapidwiz
# ./rapidwiz
}}}

When app and DB hosts are different the instalator will install DB tier and end. The configuration file will be saved that needs to be copied to app tier.

=== APP tier ===
We need to copy the configuration file from DB tier to APP tier.

On DB tier
{{{
$ scp /u01/oracle/VIS/11.2.0/appsutil/conf_VIS.txt root@ebs3:/tmp
}}}

Now we start the same installation on APP tier and provide the configuration file when possible.

This will take a while, run in under vncserver session
{{{
# vncserver
}}}

Connect to the VNC session
{{{
$ vncviewer ebsdb3.remik.org:1
}}}

Run as root
{{{
# chown applmgr:oinstall /u01
# cd startCD/Disk1/rapidwiz
# ./rapidwiz
}}}


== Validate completed installation ==
My installation fails on the following checks. After leaving is for a while and rechecking the only still failing is SSH, which runs fine when executed manually.

=== Virtual Directory ===
The error log:
  *--
Virtual Directory
checking URL = http://ebs1.remik.org:8000/OA_MEDIA/FNDLOGOL.gif
RW-50016: Error: - {0} was not created:
File = {1}   checking URL = http://ebs1.remik.org:8000/OA_JAVA/oracle/apps/fnd/admin/server/server.xml
RW-50016: Error: - {0} was not created:
File = {1}   checking URL = http://ebs1.remik.org:8000/OA_CGI/FNDWRR.exe
RW-50016: Error: - {0} was not created:
File = {1}
  *--

MOS:
  * Troubleshooting Rapid Install for E-Business Suite Release 12.2 (Doc ID 1378579.1)



=== Login Page ===
Login Page
checking URL = http://ebs3.remik.org:8000/OA_HTML/AppsLogin
RW-50016: Error: - {0} was not created:
File = {1}

=== SSH verification check ===
  *-- Error
Unable to execute command:
perl /u01/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl verifyssh -contextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/appl/admin/VIS_ebs3.xml -hosts=ebs3 -invalidnodefile=verifyssh.log
  *--

Trying from hand:
{{{
$ perl /u01/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl verifyssh -contextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/appl/admin/VIS_ebs3.xml -hosts=ebs3 -invalidnodefile=verifyssh.log
ERROR DESCRIPTION:
(
failed to create node-cmd.txt file Permission denied
)
}}}

{{{
$ ls -l /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/node-cmd.txt
  *rw-r--r-- 1 root root 27 May 12 23:56 /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/node-cmd.txt
}}}

{{{
# chown applmgr:oinstall /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/node-cmd.txt
# chown applmgr:oinstall /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/verifyssh.log
}}}

{{{
$ perl /u01/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl verifyssh -contextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/appl/admin/VIS_ebs3.xml -hosts=ebs3 -invalidnodefile=verifyssh.log
Logfile location /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/verifyssh.log
xml output = /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/out.xml
}}}

And he said that user equivalency is established. ???

Again running all the post install checks. This time only SSH connecion is failed :)
{{{
$ cat verifyssh.log
Failed to execute Remote API
Check the log file /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK for details
}}}

[applmgr@ebs3 TXK]$ ssh -l applmgr ebs3
works without password

Trying from root
{{{
# perl /u01/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl verifyssh -contextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/appl/admin/VIS_ebs3.xml -hosts=ebs3 -invalidnodefile=verifyssh.log
# cat verifyssh.log
Reading /u01/oracle/VIS/fs1/inst/apps/VIS_ebs3/logs/appl/rgf/TXK/out.xml file
SSH equivalence setup verification completed successfully
}}}




=== JSP ===
  *-- Error
JSP
checking URL = http://ebs3.remik.org:8000/OA_HTML/jtfTestCookie.jsp
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding
  *--



== 12.2.3 patch ==
Basically what we need to do to have 12.2.3 running is:

  # Clean 12.2 install downloaded from edelivery with 12.2.0.47 rapid install
This is what we have already done.

2. Following Oracle E-Business Suite Release Notes, Release 12.2 (Doc ID 1320300.1)
2a. Seed Table Upgrade Patch 17204589
2b. Fix Timestamp Mismatch Issues for Synonym, View, Package and Package Body Patch 17268684

3. Following Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)
3a. RDBMS oneoff patches on top of 11.2.0.3 (17600719, 17693770, 17875948, 18116376, 18259911)
3b. RDBMS passes the EBS Database Codelevel Checker

4. Following Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)
4a. apply the main R12.AD.C.Delta.4 Patch 17766337 merged with suggested 18628932,18470942,18274429
4b. apply the main R12.TXK.C.Delta.4 Patch 17893964 merged with suggested 18332816

5. Following Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)
5a. Apply the latest Application tier technology patches

6. Following Oracle E-Business Suite Release 12.2.3 Readme (Doc ID 1586214.1)
6a. Patch to the 12.2.3


=== 2. Following Oracle E-Business Suite Release Notes, Release 12.2 (Doc ID 1320300.1) ===
==== 2a. Seed Table Upgrade Patch 17204589 ====
Apply Consolidated Seed Table Upgrade Patch 17204589 (17204589:12.2.0)

This is a superseed of the earlier Patch 16605855.

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '16605855';
no rows selected
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17204589';
no rows selected
}}}


R12.2.0: CONSOLIDATED SEED TABLE UPGRADE PATCH (Patch)
p17204589_12.2.0_R12_GENERIC.zip	MD5	D15F4472BDCA99D911502CC4D2F2776D

{{{
$ cd /u01/oracle/VIS/fs_ne/EBSapps/patch

I just copy the patches from previously prepared location
$ rsync -a --progress /STAGING/ebs12patches/ /u01/oracle/VIS/fs_ne/EBSapps/patch/
$ md5sum p17204589_12.2.0_R12_GENERIC.zip
d15f4472bdca99d911502cc4d2f2776d  p17204589_12.2.0_R12_GENERIC.zip
$ unzip p17204589_12.2.0_R12_GENERIC.zip
}}}

Source the run app environment
{{{
Now, this handy escript is not yet here
/u01/oracle/VIS/EBSapps.env run

That is why we assume now that the run edition is on fs1 and source
$ . /u01/oracle/VIS/fs1/EBSapps/appl/VIS_`uname -n | awk -F"." '{print $1}'`.env

}}}

Stop all Application tier services on the Run File System.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adstpall.sh
}}}

Start up only the Weblogic AdminServer service on the Run File System.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start
}}}

I found out that increasing the size of redologs speeds up the process.
{{{
> alter database add logfile group 4 ('/u01/oracle/VIS/data/log4.dbf') size 1000M;
> alter database add logfile group 5 ('/u01/oracle/VIS/data/log5.dbf') size 1000M;
> alter database add logfile group 6 ('/u01/oracle/VIS/data/log6.dbf') size 1000M;
> alter system switch logfile;
> alter system checkpoint;
> alter database drop logfile group 1;
> alter database drop logfile group 2;
> alter database drop logfile group 3;
}}}


Apply Consolidated Seed Table Upgrade Patch 17204589 (17204589:12.2.0) on Run File system using adop hotpatch mode.
{{{
$ cd 17204589
$ adop phase=apply patches=17204589 hotpatch=yes
}}}

Patchin completed in:
  #:09:14 - 15:38:26
03:35:05 - 04:24:07

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '16605855';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913941 16605855			  28-APR-14
}}}

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17204589'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913913 17204589			  28-APR-14
}}}

And, what I find strange the 17064510 has been also applied:
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17064510';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913954 17064510			  28-APR-14
}}}

==== 2b. Fix Timestamp Mismatch Issues for Synonym, View, Package and Package Body Patch 17268684 ====
To avoid Dictionary Corrupted HAB_RT_EXEC_PROC_RUN_METRICS TS mismatch

MOS:
  * R12.2 Dictionary Corrupted While Running adop - "TS Mismatch" Error (Doc ID 1576086.1)

Follow:
  * Oracle E-Business Suite Release Notes, Release 12.2 (Doc ID 1320300.1)

Section: Fix Timestamp Mismatch Issues for Synonym, View, Package and Package Body

Download Patch 17268684 (17268684:R12.AD.C).

R12.2: Timestamp Mismatch Fixer for View, Synonym, Package and Package Body (Patch)
p17268684_R12.AD.C_R12_GENERIC.zip	MD5	5F108A4F0CB51559C2643FB32D475513

Do not apply the Patch 17268684 (17268684:R12.AD.C). You should instead execute instructions in the patch readme to fix timestamp mismatches for Synonym, View, Package and Package Body.


On the DB tier

{{{
$ md5sum p17268684_R12.AD.C_R12_GENERIC.zip
5f108a4f0cb51559c2643fb32d475513  p17268684_R12.AD.C_R12_GENERIC.zip
$ unzip p17268684_R12.AD.C_R12_GENERIC.zip
$ cd 17268684
$ mkdir -p $ORACLE_HOME/appsutil/admin
$ cp admin/ADZDDTFIX.sql $ORACLE_HOME/appsutil/admin
$ cd /tmp
> connect system/manager
> @$ORACLE_HOME/appsutil/admin/ADZDDTFIX.sql
$ sqlplus / as sysdba
> @adzddtfix.out
> connect system/manager
> @$ORACLE_HOME/appsutil/admin/ADZDDTFIX.sql
$ cat adzddtfix.out
  *> should be empty this time
}}}


=== 3. Following Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1) ===
==== 3a. RDBMS oneoff patches on top of 11.2.0.3 (17600719, 17693770, 17875948, 18116376, 18259911) ====
MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)

I used startCD Version 12.2.0.47

"If you used startCD 12.2.0.47 for a new Release 12.2 installation that included Oracle Database 11.2.0.3, you will not need to re-apply the patches listed in either the '12.2.0.47' or '12.2.0.46' rows of Table 1. This is because startCDs are cumulative, with successive ones including all the content of their predecessors. You will, however, need to apply the patches listed under 'Not included in any startCD' rows in the tables for the different technology components."

Check current DB patches
{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
}}}

Patching with those mentioned under 'Not included in any startCD' section

Shutdown APP and DB tiers
{{{
$ do it
}}}

===== OPatch =====
OPatch patch of version 11.2.0.3.6 for Oracle software releases 11.2.0.x (DEC 2013) (Patch)
p6880880_112000_Linux-x86-64.zip	MD5	2AB78CB17174C3A49DF560F05E3352C6

{{{
$ opatch version
OPatch Version: 11.2.0.3.0
$ mv $ORACLE_HOME/OPatch $ORACLE_HOME/OPatch_`/bin/date +%Y%m%d`
$ unzip -d $ORACLE_HOME p6880880_112000_Linux-x86-64.zip
$ opatch version
OPatch Version: 11.2.0.3.6
}}}

===== 17600719 =====

DBMS_UTILITY.INVALIDATE ORA-3113 ORA-7445 CORE DUMP [OPIGLN] (Patch)
p17600719_112030_Linux-x86-64.zip	MD5	39D742550866A206A444DA8E01320D7E

{{{
$ md5sum p17600719_112030_Linux-x86-64.zip
39d742550866a206a444da8e01320d7e  p17600719_112030_Linux-x86-64.zip
$ unzip p17600719_112030_Linux-x86-64.zip
$ cd 17600719
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
$ opatch apply
$ opatch lsinventory | grep 17600719
Patch  17600719     : applied on Mon Apr 28 20:28:48 CEST 2014
}}}

No Postinstallation

===== 17693770 =====
MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 17502060 17487358 (Patch)
p17693770_112030_Linux-x86-64.zip	MD5	2AB47B81CD24E5EDEC557E8332D6FFC8

{{{
$ md5sum p17693770_112030_Linux-x86-64.zip
2ab47b81cd24e5edec557e8332d6ffc8  p17693770_112030_Linux-x86-64.zip
$ unzip p17693770_112030_Linux-x86-64.zip
$ cd 17693770
$ opatch apply
$ opatch lsinventory | grep 17693770
Patch  17693770     : applied on Mon Apr 28 20:36:32 CEST 2014
}}}

Postinstallation
{{{
> startup
> @?/sqlpatch/17693770/postinstall.sql
> shutdown immediate
}}}


===== 17875948 =====

MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 16587934 17654622 (Patch)
p17875948_112030_Linux-x86-64.zip	MD5	F7FD987FC9BA4BADACD0E2BB3EC592A9

{{{
$ md5sum p17875948_112030_Linux-x86-64.zip
f7fd987fc9ba4badacd0e2bb3ec592a9  p17875948_112030_Linux-x86-64.zip
$ unzip p17875948_112030_Linux-x86-64.zip
$ cd 17875948
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
$ opatch apply
}}}

Postinstallation
{{{
> startup
> @?/sqlpatch/17875948/postinstall.sql
}}}

Note: If XDB is installed it is required to run "catmetx.sql" script also.
{{{
> @valid
Oracle XML Database		    VALID	    11.2.0.3.0
> @?/rdbms/admin/catmetx.sql
> shutdown immediate
}}}

===== 18116376 =====
MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 17047617 12811829 (Patch)
p18116376_112030_Linux-x86-64.zip	MD5	E10F7E87397573624A948CA6FA5C05E7

{{{
# md5sum p18116376_112030_Linux-x86-64.zip
e10f7e87397573624a948ca6fa5c05e7  p18116376_112030_Linux-x86-64.zip
# unzip p18116376_112030_Linux-x86-64.zip
$ cd 18116376
$ opatch apply
}}}

No Postinstallation steps.

===== 18259911 =====
MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 16163946 16833977 4189542 11896575 (Patch)
p18259911_112030_Linux-x86-64.zip	MD5	8D5701B5CDBD649E5D67A6B10AE0F27D

{{{
# md5sum p18259911_112030_Linux-x86-64.zip
8d5701b5cdbd649e5d67a6b10ae0f27d  p18259911_112030_Linux-x86-64.zip
# unzip p18259911_112030_Linux-x86-64.zip
$ cd 18259911
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
}}}

Please contact Oracle Support and get the merged patch of the patches :
  #461865, 18259911

{{{
$ opatch apply
If you continue, patch(es) [  17461865 ] will be rolled back and the new Patch  [ 18259911 ] will be installed.
}}}

MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)

Footnote 7 - Database bug fix 16187992 has been replaced with database bug fix 18241194, this is included in Patch 18259911 and should be installed instead of Patch 17461865.

Continuing with the patching.


==== 3b. RDBMS passes the EBS Database Codelevel Checker ====
EBS Database Codelevel Checker (Patch)
p17537119_R12_GENERIC.zip	MD5	095E006B61296033ABD67A58FCAB838B

{{{
$ cp p17537119_R12_GENERIC.zip /tmp
$ cd /tmp
$ md5sum p17537119_R12_GENERIC.zip
095e006b61296033abd67a58fcab838b  p17537119_R12_GENERIC.zip
$ unzip p17537119_R12_GENERIC.zip
}}}

Source DB env
{{{
$ ./checkDBpatch.sh
All the required one-offs are present in Oracle Database Home
}}}


=== 4. Following Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1) ===
==== 4a. apply the main R12.AD.C.Delta.4 Patch 17766337 merged with suggested 18628932,18470942,18274429 ====
Customers are required to apply the latest available AD and TXK Release Update Pack (RUP) for Oracle E-Business Suite Release 12.2 by referring to My Oracle Support Knowledge Document 1583092.1, E-Business Suite-wide RUP, AD and TXK RUP Information, Release 12.2.

MOS:
  * Oracle E-Business Suite Release 12.2: Suite-Wide Rollup and AD/TXK Delta Information (Doc ID 1583092.1)


p17766337_R12.AD.C_R12_LINUX.zip        MD5	1DC21E3C8D3302C3063C5DAB320778B0


On DB tier
{{{
$ md5sum p17766337_R12.AD.C_R12_LINUX.zip
  #c21e3c8d3302c3063c5dab320778b0  p17766337_R12.AD.C_R12_LINUX.zip
$ unzip p17766337_R12.AD.C_R12_LINUX.zip
}}}

Source DB env
{{{
$ mkdir -p $ORACLE_HOME/appsutil/admin
$ cd 17766337
$ cp admin/adgrants.sql $ORACLE_HOME/appsutil/admin
}}}

{{{
> startup
$ sqlplus /nolog
> @$ORACLE_HOME/appsutil/admin/adgrants.sql apps
> shutdown immediate
}}}

MOS:
  * Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)

Before proceeding with next step, ensure to review My Oracle Knowledge Document 1594274.1, Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes and apply all patches for Database 11.2.0.3.

  *> already done.


Still following Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)
MOS:
  * Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)
  * Oracle E-Business Suite 12.2 Patching Technology Components Guide (Doc ID 1355068.1)


New Installation Customers, Path A

  # Source the run edition environment file.
{{{
$ . $HOME/scripto/ebs/app_env
}}}

2. Apply the latest embedded Application Tier Technology patches on Run File System.
DB patches applied.

App patches:

Do I need to apply them if I am going to install 12.2.3 shortly? Yes, but they will be applied to the patch edition shortly before online adop 12.2.3 patching session.

3. Run adgrants.
  *> already done

4. Apply R12.AD.C.Delta.4 Patch 17766337 by merging with the following AD one-off patches in hotpatch mode. The patch should be applied on the Run Edition Application File System:

Start DB tier
{{{
$ $HOME/scripto/ebs/start_DB.sh
}}}

On APP tier start up only the Weblogic AdminServer service on the Run File System.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start
}}}

Preparing other patches to be merged with main 17766337
{{{
$ cd /u01/oracle/VIS/fs_ne/EBSapps/patch
}}}

  #Off R12.AD.C.Delta.4: ADOP PREPARE FAILS ON A MULTI-TIER ENVIRONMENT DURING FSCLONE STAGE (Patch)
p18628932_R12.AD.C_R12_GENERIC.zip	MD5	9B5E8DE3274A873F4B2C1E3268F57A3E

  #1Off R12.AD.C.Delta.4: FIX FOR HYBRRID CONFIGURATION, CCD AND EXEMPT POLICY (Patch)
p18470942_R12.AD.C_R12_GENERIC.zip	MD5	23FD88FB1533A4D63FD609CCDD3F93B3

  #Off R12.AD.C.Delta.4: script to fix ldt invalidation issue during main divisional upgrade (Patch)
p18274429_R12.AD.C_R12_GENERIC.zip	MD5	9E3DBA06786604F1347887DCB403C692

{{{
$ unzip p18628932_R12.AD.C_R12_GENERIC.zip
$ unzip p18470942_R12.AD.C_R12_GENERIC.zip
$ unzip p18274429_R12.AD.C_R12_GENERIC.zip
$ unzip p17766337_R12.AD.C_R12_LINUX.zip
}}}

On apps tier
{{{
$ adop phase=apply patches=17766337,18628932,18470942,18274429 hotpatch=yes merge=yes
}}}

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17766337'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913966 17766337			  05-MAY-14
}}}

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18628932'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913969 18628932			  05-MAY-14
}}}

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18470942'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913968 18470942			  05-MAY-14
}}}

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18274429'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913967 18274429			  05-MAY-14
}}}

==== 4b. apply the main R12.TXK.C.Delta.4 Patch 17893964 merged with suggested 18332816 ====
Still following Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)
MOS:
  * Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)
  * Oracle E-Business Suite 12.2 Patching Technology Components Guide (Doc ID 1355068.1)

5. Apply R12.TXK.C.Delta.4 Patch 17893964 by merging it with 18332816:R12.TXK.C in hotpatch mode on the run edition application tier file system:

R12.TXK.C.DELTA.4 (Patchset)
p17893964_R12.TXK.C_R12_GENERIC.zip	MD5	148815EDD925F1F327AB9714BD8127DE


QREP1224.2:AD/TXK RUP4 D6:AC-50606: EXCEPTION OCCURRED WHILE RELEASING LOCK (Patch)
p18332816_R12.TXK.C_R12_GENERIC.zip	MD5	67367EF4F004D01B3FEA0F99889A2B7C

{{{
$ unzip p17893964_R12.TXK.C_R12_GENERIC.zip
$ unzip p18332816_R12.TXK.C_R12_GENERIC.zip
}}}

{{{
$ adop phase=apply patches=17893964,18332816 merge=yes hotpatch=yes
}}}

6. On Windows, not applicable

7. Instantiate the Oracle HTTP Server configuration files admin.conf, ssl.conf, mod_wl_ohs.conf on the run edition application tier file system.

Perform the instantiation with the following commands.When prompted for the APPS password, press <Return>.

{{{
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -d $FND_TOP/admin/driver/ohstmpl.drv -tmpl $FND_TOP/admin/template/ssl_conf_FMW.tmp
}}}

Prepare the next command to run:
{{{
$ cat $CONTEXT_FILE | grep -e s_ohs_instance_loc -e s_ohs_component
<ohs_instance_loc oa_var="s_ohs_instance_loc">/u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1</ohs_instance_loc>
<ohs_component oa_var="s_ohs_component">EBS_web_VIS</ohs_component>
}}}

{{{
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -tmpl $FND_TOP/admin/template/mod_wl_ohs_conf_FMW.tmp -out <s_ohs_instance_loc>/config/OHS/<s_ohs_component>/mod_wl_ohs.conf
}}}

Which will be on this system:
{{{
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -tmpl $FND_TOP/admin/template/mod_wl_ohs_conf_FMW.tmp -out /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/mod_wl_ohs.conf
And other two:
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -d $FND_TOP/admin/driver/ohstmpl.drv -tmpl $FND_TOP/admin/template/admin_conf_FMW.tmp
}}}

{{{
$ perl $FND_TOP/patch/115/bin/txkSetAppsConf.pl -contextfile=$CONTEXT_FILE -outfile=$INST_TOP/logs/appl/rgf/TXK/test.log
}}}

8. Synchronize the file systems

We have done some changes to the run filesystem because the patches were applied in hotpatch=yes mode. Now it is time to sychronise those changes to the patch filesystem. This why we use fs_clone phase. As help is suggesting

{{{
$ adop -help
(...)
fs_clone      - Copy the run file system to the patch file system.
}}}


That is why we are advised to to that.
{{{
$ adop phase=fs_clone
}}}

Done with Following Applying R12.AD.C.Delta.4 and R12.TXK.C.Delta.4 Release Update Packs (Doc ID 1617461.1)

Applyed:

R12.AD.C.Delta.4 Patch 17766337
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17766337'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913966 17766337			  05-MAY-14
}}}

R12.TXK.C.Delta.4 Patch 17893964
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17893964'
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
914514 17893964			  05-MAY-14
}}}

With those patches came an easy way of setting the environment, the EBSapps.env file. We can set run, patch edition or be asked which one we want to set.
{{{
$ . /u01/oracle/VIS/EBSapps.env run
$ . /u01/oracle/VIS/EBSapps.env patch
$ . /u01/oracle/VIS/EBSapps.env
}}}




=== 5. Following Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1) ===
==== 5a. Apply the latest Application tier technology patches ====

We have here actually 3 possible scenarius. We have some Forms and FMW patches to apply. These are not like standard EBS patches now applied with adop, previously with adpatch. These are also not database patches applied to database home with opatch. These are patches to binaries of Forms and Fusion Middleware FMW patches, applied to selected homes with opatch or with Weblogic own mechanism.

Those binaries that we need to patch lie on both run and patch filesystems so we somehow have to take care of that. With extra functionality comes some complications.

The options how to handle this:

I. We can approach in a way similar to how we installed R12.AD.C.Delta.4 Patch 17766337.
a. Shutdown the APP tier
b. Apply the Forms and FMW patches to RUN filesystem
c. Run adop phase=fs_clone to copy the run file system to the patch file system.

II. We can treat it like almost usual adop patching session
a. adop phase=prepare
b. Apply the Forms and FMW patches to PATCH filesystem (just like adop phase=apply would do with standard patch)
c. adop phase=finalize,cutover,cleanup after witch we run the system with patched Forms and FMW
d. adop phase=fs_clone that will copy the run file system to the patch file system

III. We can combine the Forms and FMW patching with comming 12.2.3 patch, which can save us some time
a. adop phase=prepare
b. Apply the Forms and FMW patches to PATCH filesystem
c. adop phase=apply that will apply 12.2.3 patch to the PATCH filesystem
d. adop phase=finalize,cutover,cleanup after witch we run the system with patched Forms and FMW
e. adop phase=fs_clone that will copy the run file system to the patch file system

Here we go with option III. Just wait, go forward.



=== 6. Following Oracle E-Business Suite Release 12.2.3 Readme (Doc ID 1586214.1) 6a. Patch to the 12.2.3 ===

==== Prerequisite Patches ====
ORACLE APPLICATIONS DBA 12.2.3 PRODUCT RELEASE UPDATE PACK (Patchset)
p17023760_R12.AD.C_R12_LINUX.zip	MD5	34153EF8134BC3C2560950682A1A6B02

R12.AD.C.Delta.4 Patch 17766337 already applied, which includes 17023760

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17023760';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
914327 17023760			  05-MAY-14
}}}


==== 1. Preparation ====
{{{
$ cd $APPL_TOP_NE/../patch
}}}

MOS:
  * 1586214.1 - 'Oracle E-Business Suite Release 12.2.3 Readme'.

{{{
ORACLE E-BUSINESS SUITE 12.2.3 RELEASE UPDATE PACK (Patchset)
p17020683_R12_LINUX_1of6.zip	MD5	B8A3AE465DD1C9A8FF6E1056A56FB0DE
p17020683_R12_LINUX_2of6.zip	MD5	30F643C1E899F23EAE135A85AC8DF924
p17020683_R12_LINUX_3of6.zip	MD5	2293DDFBB5805B91C799C736D34903ED
p17020683_R12_LINUX_4of6.zip	MD5	3AC8B195D0BAD8AA3B3226BE9F9B0906
p17020683_R12_LINUX_5of6.zip	MD5	C55FFE5AE4EE4D975E99595C7AA7B4D8
p17020683_R12_LINUX_6of6.zip	MD5	C7576B678DD595C684C8FFC2220974B9
}}}

{{{
$ md5sum p17020683_R12_LINUX_1of6.zip
b8a3ae465dd1c9a8ff6e1056a56fb0de  p17020683_R12_LINUX_1of6.zip
$ md5sum p17020683_R12_LINUX_2of6.zip
30f643c1e899f23eae135a85ac8df924  p17020683_R12_LINUX_2of6.zip
$ md5sum p17020683_R12_LINUX_3of6.zip
2293ddfbb5805b91c799c736d34903ed  p17020683_R12_LINUX_3of6.zip
$ md5sum p17020683_R12_LINUX_4of6.zip
3ac8b195d0bad8aa3b3226be9f9b0906  p17020683_R12_LINUX_4of6.zip
$ md5sum p17020683_R12_LINUX_5of6.zip
c55ffe5ae4ee4d975e99595c7aa7b4d8  p17020683_R12_LINUX_5of6.zip
$ md5sum p17020683_R12_LINUX_6of6.zip
c7576b678dd595c684c8ffc2220974b9  p17020683_R12_LINUX_6of6.zip
}}}


{{{
$ unzip p17020683_R12_LINUX_1of6.zip
$ unzip p17020683_R12_LINUX_2of6.zip
$ unzip p17020683_R12_LINUX_3of6.zip
$ unzip p17020683_R12_LINUX_4of6.zip
$ unzip p17020683_R12_LINUX_5of6.zip
$ unzip p17020683_R12_LINUX_6of6.zip
}}}

==== 2. Required Database Patches ====
All database patches from  Document 1594274.1, Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes and apply all patches for Database 11.2.0.3.

Already applied.

==== 3. Apply Consolidated Seed Table Upgrade Patch (Required) ====

Consolidated Seed Table Upgrade Patch 17204589 (17204589:12.2.0) already applied

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17204589';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913913 17204589			  05-MAY-14
}}}

  # Stop all Application tier services on the run file system.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adstpall.sh
}}}

2. Start up only the Weblogic AdminServer service on the run file system.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start
}}}

3. Apply the consolidated seed table upgrade Patch 17204589 (17204589:12.2.0) on the run file system using adop hotpatch mode.
  *> already done

4. Start up all Application tier services.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adstrtal.sh
}}}

==== 4. Apply the Latest AD and TXK Delta Release Update Packs ====
Already applied.

R12.AD.C.Delta.4 Patch 17766337
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17766337';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913966 17766337			  05-MAY-14
}}}

R12.TXK.C.Delta.4 Patch 17893964
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17893964';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
914514 17893964			  05-MAY-14
}}}

==== 5. Apply Oracle E-Business Suite 12.2.3 Release Update Pack ====

====== 1. Source the run edition applications environment. ======
{{{
$ . /u01/oracle/VIS/EBSapps.env run
}}}


===== back to 5. Apply Oracle E-Business Suite 12.2.3 Release Update Pack =====
====== 2. Start an online patching cycle. ======
{{{
$ adop phase=prepare
}}}

====== 3. Application Tier Technology Patches ======

Apply the latest Application tier technology patches documented in 'Section 3: Application Tier Technology Patches and Bug Numbers' of My Oracle Support Knowledge Document 1594274.1, Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes.

MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)

I used the startCD 12.2.0.47 for the installation, but I still need to apply the patches listed under 'Not included in any startCD' for each of the technology components.

When obtaining patches listed in these tables select release 10.1.0.5.0 for patch download and install into the 10.1.2 ORACLE_HOME.

{{{
#
# Apply the FMW and Forms patches to the PATCH filesystem
#
}}}

How to source patch filesystem?
{{{
$ . /u01/oracle/VIS/EBSapps.env patch
}}}

====== Which homes are for what? ======
How to determine which home is which technology?
MOS:
  * Oracle E-Business Suite 12.2 Patching Technology Components Guide (Doc ID 1355068.1)

======= /u01/oracle/VIS/fs1/FMW_Home/webtier/OPatch/opatch =======
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/FMW_Home/webtier
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
}}}

Oracle WebTier and Utilities CD                                      11.1.1.6.0
Interim patches (7) : 16199894 14616819 10638758 17325559 13643211 12949905 7695070

Indicate, that this is:

Web Tier and Utilities (OHS) 11.1.1.6


======= /u01/oracle/VIS/fs1/FMW_Home/Oracle_EBS-app1/OPatch/opatch =======
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/FMW_Home/Oracle_EBS-app1
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
}}}

Oracle E-Business Suite Component                                    11.1.1.6.0
There are no Interim patches installed in this Oracle Home.

??



======= /u01/oracle/VIS/fs1/FMW_Home/oracle_common/OPatch/opatch =======
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/FMW_Home/oracle_common
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
}}}

Oracle AS Common Toplevel Component                                  11.1.1.2.0
Interim patches (5) :Patch  12714567 16199894 ...

Which indicates, that this is:
Oracle Fusion Middleware Common 11.1.1.6, but this 11.1.1.2.0? 11.1.1.6? Anyway, this is the best match.


======= /u01/oracle/VIS/fs1/EBSapps/10.1.2/OPatch/opatch =======
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
}}}

40) Patches applied, including Patch  7016961 which indicates, that this is:

'Forms and Reports 10.1.2.3'


====== Section 3.1: Forms and Reports 10.1.2.3 Patches and Bug Numbers ======
Here we have patches for versions 10.1.2.3.0 or 10.1.0.5.0. Which is the one I need?

We have 10.1.2.3

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
}}}

{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
}}}

Apply those Not included in any startCD

======= 5659594 =======
{{{
$ opatch lsinventory | grep 5659594
}}}

R11:REG:RWBUILDER/RWRUN RAISING EXCEPTION WHILE RUNNING REPORT IN VIEW (Patch)
p5659594_10123_GENERIC.zip	MD5	39972CD7B1D6AA71B80B61A459151E89

{{{
$ cd 5659594
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 5659594
  # Patch  5659594 applied on Tue May 06 06:03:27 EDT 2014
}}}

======= 8943095 =======
APPS1012: ALIGNMENT INCORRECT WHEN USING VIETNAMESE COMBINING CHARACTERS (Patch)
p8943095_10123_LINUX.zip	MD5	19CD850DD59E9F7CE995C17BC6E03F3B

{{{
$ cd 8943095
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 8943095
  # Patch  8943095 applied on Tue May 06 06:06:15 EDT 2014
}}}


======= 15900214 =======
APPS6: RUNNING RWCONVERTER SHOWS PARAMETERS PASSED IN PS -EF (Patch)
p15900214_10123_LINUX.zip	MD5	6B82F41683BA0CA83DED03CCAA95FCCB

cd 15900214
opatch apply

{{{
$ opatch lsinventory | grep 15900214
  # Patch  15900214 applied on Tue May 06 06:07:10 EDT 2014
}}}



======= 17645157 =======
APPS6:GETTING JAVA SERVER VM WARNING WITH 10.1.2 ORACLE_HOME EXE , JDK 1.7.0_40 (Patch)
p17645157_10123_LINUX.zip	MD5	697A9EC1567213779C400BBAD2B8F322

{{{
$ cd 17645157
}}}

Allow opatch to roll 16207165 back when applying <Patch 17645157>
{{{
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 17645157
  # Patch  17645157 applied on Tue May 06 06:10:02 EDT 2014
}}}


Relink the reports
{{{
$ cd $ORACLE_HOME/reports/lib
$ make -f ins_reports.mk install
}}}


======= 17907988 =======
MERGE REQUEST ON TOP OF 10.1.2.3.0 FOR BUGS 7121788 17594101 (Patch)
p17907988_10123_LINUX.zip	MD5	D100E84C1980079E1AC458955FCFD5DD

cd 17907988
opatch apply
chmod +x $ORACLE_HOME/bin/genshlib

{{{
$ opatch lsinventory | grep 17907988
  # Patch  17907988 applied on Tue May 06 06:11:53 EDT 2014
}}}


Relink the forms.
{{{
$ cd $ORACLE_HOME/forms/lib
$ make -f ins_forms.mk sharedlib install
}}}

{{{
$ opatch lsinventory
43 patches installed (5 installed 2 rollback)
}}}

====== Section 3.2: Web Tier & Utilities (OHS) 11.1.1.6 Patches and Bug Numbers ======
Web Tier and Utilities (OHS) 11.1.1.6 Patches
IAS_ORACLE_HOME=/u01/oracle/VIS/fs1/FMW_Home/webtier
{{{
$ cd /u01/oracle/VIS/fs1/FMW_Home/webtier/OPatch
$ ./opatch lsinventory
Oracle WebTier and Utilities CD                                      11.1.1.6.0
Interim patches (7) :Patch  16199894 14616819 10638758 17325559 13643211 12949905 7695070
}}}

No patches to apply.

====== Section 3.3: Oracle Fusion Middleware Common 11.1.1.6 Patches and Bug Numbers ======
{{{
$ relogin to clear env
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/FMW_Home/oracle_common
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/FMW_Home/oracle_common
}}}

{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
}}}

Apply those Not included in any startCD

======= 9905685 =======
MISSING COMMONS-CLI-1.1.JAR IN WEBTIER ORACLE_COMMON/SOA/MODULES (Patch)
p9905685_111160_Generic.zip	78.8 KB	(80669 bytes)
SHA-1	B0BD74EB7EFD0AB8BEFA8DD33618AA6A8E0CCA85
MD5	8C3F033B5B508CF7E366B3399D417676

{{{
$ cd 9905685/opatch/9905685
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 9905685
Patch  9905685      : applied on Tue May 06 08:39:12 EDT 2014
}}}

======= 13947608 =======
RUP4: JPS-02592 FAILED TO PUSH LDAP CONFIG DATA TO LIBOVD IN HCM DTE ENV (Patch)
p13947608_111160_Generic.zip	MD5	3138AE776F8F1F3435117C5A52478D3F

{{{
$ cd 13947608
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 13947608
Patch  13947608     : applied on Tue May 06 10:12:33 EDT 2014
}}}

======= 17394319 =======

PASTBINARY NOT RETURNING CORRECT STATUS IN CASE OF CTRL+C (Patch)
p17394319_111160_Generic.zip	MD5	8A34BC75E733059BF9CD2FAEDD5D080D

{{{
$ cd 17394319
$ opatch apply
}}}

{{{
$ opatch lsinventory | grep 17394319
Patch  17394319     : applied on Tue May 06 10:13:12 EDT 2014
}}}


====== Section 3.4: Oracle Weblogic Server 10.3.6.0 Patches and Bug Numbers ======
{{{
$ cd $FMW_HOME/utils/bsu
$ bsu.sh -report -bea_home=$FMW_HOME -output_format=text
Product Version........... 10.3.6.0
}}}

Patches Not included in any startCD	17495356

======= 17495356 =======

SU Patch [CIH8]: TRACKING BUG FOR SMARTUPDATE PATCH OF MLR BUG 17431995 (Patch)
p17495356_1036_Generic.zip	MD5	6D7C562BE2D908321CFD033099F482B2

MOS:
  * How to Apply WebLogic Server (WLS) Patches Using Smart Update [Video] (Doc ID 876004.1)

{{{
# md5sum p17495356_1036_Generic.zip
6d7c562be2d908321cfd033099f482b2  p17495356_1036_Generic.zip
$ cp p17495356_1036_Generic.zip $FMW_HOME/utils/bsu/cache_dir/
$ cd $FMW_HOME/utils/bsu/cache_dir
$ unzip p17495356_1036_Generic.zip
inflating: CIH8.jar
inflating: patch-catalog_20352.xml
$ rm p17495356_1036_Generic.zip README.txt
}}}

{{{
$ cd $FMW_HOME/utils/bsu
$ ./bsu.sh -prod_dir=$FMW_HOME/wlserver_10.3 -patchlist=CIH8 -verbose -install
}}}


===== back to 5. Apply Oracle E-Business Suite 12.2.3 Release Update Pack =====
Still Following Oracle E-Business Suite Release 12.2.3 Readme (Doc ID 1586214.1)
MOS:
  * 1586214.1 - 'Oracle E-Business Suite Release 12.2.3 Readme'.

====== 4. Apply Oracle E-Business Suite Release 12.2.3. ======

Start up only the Weblogic AdminServer service on the Run File System.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start
}}}

??? Actually the whole APP stack can be up, as this is online patching :)
{{{
$ start_APP
}}}

START 2014/05/06 15:33:57

The adop will apply the patches to the PATCH edition filesystem. That is why were also applying the Forms and FMW patches to the patch edition, which is now fs2.

Just a check.

The fs2 should have applied new patches, but the running not. It is supposed to be so.

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
43) Patch
}}}

There is no need to run any resync. It will be all done after the patch


Perform the actual online patching exercise
{{{
$ adop phase=apply patches=17020683
}}}

START 2014/05/07 10:40:43
END   2014/05/08 00:51:05

Just a check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
43) Patch
}}}

So still the run edition has no changed. The patch edition has the Forms patched and the whole patch app has 17020683, which is 12.2.3 applied.

===== back to 5. Apply Oracle E-Business Suite 12.2.3 Release Update Pack =====
Still Following Oracle E-Business Suite Release 12.2.3 Readme (Doc ID 1586214.1)
MOS:
  * 1586214.1 - 'Oracle E-Business Suite Release 12.2.3 Readme'.

====== 5. Instantiate the Oracle HTTP Server configuration files admin.conf, ssl.conf, and mod_wl_ohs.conf. ======

Source the patch edition environment file:
{{{
$ . $PATCH_BASE/EBSapps/appl/APPS$CONTEXT_NAME.env
}}}

When prompted for the APPS password, press <Return>.
{{{
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -d $FND_TOP/admin/driver/ohstmpl.drv -tmpl $FND_TOP/admin/template/ssl_conf_FMW.tmp
}}}

{{{
$ cat $CONTEXT_FILE | grep -e s_ohs_instance_loc -e s_ohs_component
<ohs_instance_loc oa_var="s_ohs_instance_loc">/u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1</ohs_instance_loc>
<ohs_component oa_var="s_ohs_component">EBS_web_VIS</ohs_component>
}}}

{{{
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -tmpl $FND_TOP/admin/template/mod_wl_ohs_conf_FMW.tmp -out /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/mod_wl_ohs.conf
$ $ADJVAPRG oracle.apps.ad.autoconfig.InstantiateFile -e $CONTEXT_FILE -d $FND_TOP/admin/driver/ohstmpl.drv -tmpl $FND_TOP/admin/template/admin_conf_FMW.tmp
}}}

{{{
$ perl $FND_TOP/patch/115/bin/txkSetAppsConf.pl -contextfile=$CONTEXT_FILE -outfile=$INST_TOP/logs/appl/rgf/TXK/test.log
}}}

====== 6. Complete the online patching cycle by running the following commands in the order shown. ======

Source the run edition environment file:
{{{
$ . $RUN_BASE/EBSapps/appl/APPS$CONTEXT_NAME.env
}}}

{{{
$ adop phase=finalize
$ adop phase=cutover
}}}

Now the situation is still the same:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
43) Patch
}}}

But, the run edition is now set to fs2
{{{
$ source /u01/oracle/VIS/EBSapps.env run
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
}}}

That is the whole beauty if online patching. The cutover phase has shutdown the services from fs1, and started from fs2, which the current run edition.

{{{
$ adop phase=cleanup
START 2014/05/08 06:35:45
END   2014/05/08 15:48:49
}}}

Just a check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
43) Patch
}}}

====== 7. Synchronize file systems ======
This action will copy the new run edition code and configuration to the other file system, to help the next online patching cycle complete faster.

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished	  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
ebs2		master		PREPARE     COMPLETED	    05-MAY-14 14:19:07 -04:00	   05-MAY-14 15:21:17 -04:00	  1:02:10
APPLY	    COMPLETED	    07-MAY-14 10:41:43 -04:00	   08-MAY-14 00:50:56 -04:00	  14:09:13
FINALIZE    COMPLETED	    08-MAY-14 05:40:10 -04:00	   08-MAY-14 05:42:20 -04:00	  0:02:10
CUTOVER     COMPLETED	    08-MAY-14 05:44:25 -04:00	   08-MAY-14 06:32:12 -04:00	  0:47:47
CLEANUP     COMPLETED	    08-MAY-14 06:37:26 -04:00	   08-MAY-14 15:48:29 -04:00	  9:11:03
}}}


{{{
$ adop phase=fs_clone
START 2014/05/08 16:03:31
END   2014/05/08 19:06:28
}}}

Just a check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
43) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
43) Patch
}}}


===== 6. Post-Update Steps =====
Nice:
source /u01/oracle/VIS/EBSapps.env run|patch

If you are upgrading from Release 11i, 12.0.x or 12.1.x to Release 12.2.3, then you must continue with 12.2.0 post upgrade steps.

I have done the upgrade from 12.2 to 12.2.3, so those post install steps do not apply.

===== Done =====

We have 12.2.3 installed.



== troubleschooting ==
=== Database Availability check riwTDBup.sh ===
Database Availability
command: su applmgr -c "/STAGING/oracle_EBS_R12.2_linux_x86-64/startCD/Disk1/rapidwiz/bin/riwTDBup.sh /u01/oracle/VIS/fs1/inst/apps/VIS_ebs1/ora/10.1.2/VIS_ebs1.env APPS/*****"

/STAGING/oracle_EBS_R12.2_linux_x86-64/startCD/Disk1/rapidwiz/bin/riwTDBup.sh /u01/oracle/VIS/fs1/inst/apps/VIS_ebs1/ora/10.1.2/VIS_ebs1.env APPS/APPS

to mi dziala jak odpaloone z reki.

MOS:
  * "No such file or directory: FastCGI: read() from pipe failed (0)" When Starting Oracle HTTP Server (Doc ID 1115253.1)

Edit the file /etc/hosts to use the following format:

ip_address fully_qualified_hostname short_hostname

First line of the etc/hosts file should be:


  #7.0.0.1 localhost



rw-50011
MOS:
  * R12i: Pre-Install Check Fails RW-50011 (Doc ID 951783.1)

Installation
http://docs.oracle.com/cd/B53825_03/current/acrobat/121oaig.pdf

=== Installation Freezes constantly during ===

Freezes constantly during
MOS:
  * Oracle E-Business Suite Release Notes, Release 12.2 (Doc ID 1320300.1)
  * Troubleshooting Rapid Install for E-Business Suite Release 12.2 (Doc ID 1378579.1)
  * Oracle E-Business Suite Release 12.2 Information Center - Announcements (Doc ID 1583109.1)

apply the patch to startCD


=== /etc/hosts ===
{{{
# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
  #7.0.0.1 localhost
::1		localhost6.localdomain6 localhost6
  #2.168.1.158 ebs2.remik.org ebs2
  #2.168.1.159 ebsdb2.remik.org ebsdb2
}}}

=== RW-50004 An error has occured ===
Looking at log file:

Fatal Error: TXK Install Service

oracle.apps.fnd.txk.config.ProcessStateException: OPatch process failed : Exit=1 See log for details. CMD= /u0
  #oracle/VIS/11.2.0/OPatch/opatch napply -skip_subset -skip_duplicate -verbose -silent   -ocmrf /u01/oracle/VI
S/11.2.0/temp/VIS_ebsdb3/DBInstallHome/fnd/admin/template/txkForms_ocm.rsp  /u01/oracle/VIS/11.2.0/temp/VIS_eb
sdb3/patches/16342486/16342486/

at oracle.apps.fnd.txk.config.OPatchActionNode.processState(OPatchActionNode.java:296)

at oracle.apps.fnd.txk.config.PatchActionNode.processState(PatchActionNode.java:187)

at oracle.apps.fnd.txk.config.PatchNode.processState(PatchNode.java:338)

running from vnc
and it works!

Probably the problem was with:

{{{
# ./rapidwiz
Rapid Install Wizard is validating your file system......
CMDDIR=/STAGING/oracle_EBS_R12.2_linux_x86-64/startCD/Disk1/rapidwiz
Rapid Install Wizard will now launch the Java Interface.....
}}}

[root@ebsdb3 rapidwiz]# X11 connection rejected because of wrong authentication.
Configuration file written to: /u01/oracle/VIS/11.2.0/appsutil/conf_VIS.txt
Database logfile - /u01/oracle/VIS/11.2.0/appsutil/log/VIS_ebsdb3/05121655.log
X11 connection rejected because of wrong authentication.
X11 connection rejected because of wrong authentication.

MOS:
  * Silent Installation Fails When Using Ssh With X Forwarding (Doc ID 1607080.1)

This probably has to do something with the IP6 disabled, that caused the ssh X forwarding to fail, what was workarounded by setting 'X11UseLocalhost no'.

Workaround: use vncserver.





=== DB Connection as APPS was not successful. Please verify the connection details and apps user password. ===

Apps user DB Connection
DB Connection as APPS was not successful. Please verify the connection details and apps user password.

Database Connection String - jdbc:oracle:thin:@ebsdb1.remik.org:1521:VIS

MOS:
  * Troubleshooting Rapid Install for E-Business Suite Release 12.2 (Doc ID 1378579.1)

looking at:
/tmp/05041500/05041500.log

Apps user DB Connection
  *----------------------


getConnection() -->
sDbHost    : ebsdb2
sDbDomain  : remik.org
sDbPort    : 1521
sDbSid     : VIS
sDbUser    : APPS
Trying to connect using SID...
getConnectionUsingSID() -->
JDBC URL: jdbc:oracle:thin:@ebsdb2.remik.org:1521:VIS
Exception occurred: java.sql.SQLException: ORA-01017: invalid username/passw
ord; logon denied

provided wrong password before.

Solved.

Pay attention to what passwords are asked for.

Apps OS User Password: this the Linux password for user applmgr.

Apps DB User Password: this the database password for user APPS, which is by default apps.

=== Trying (wrongly) to manualy synchronise fs2 ===

After the fs1 patching

Should I synchronise the fs2? NO! Just apply the patch.

{{{
$ adop phase=fs_clone
Using ADOP Session ID from currently incomplete patching cycle
[UNEXPECTED]FS clone cannot be called while a patching cycle is active
}}}

adop exiting with status = 2 (Fail)

MOS:
  * 12.2 E-Business Suite - Collecting Online Patching and fs_clone Log Files (Doc ID 1542162.1)
  * Oracle E-Business Suite Release 12.2: Backup and Recovery Guidelines For Online Patching Cutover (Doc ID 1584097.1)

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
ebs2		master		PREPARE     COMPLETED	    05-MAY-14 14:19:07 -04:00	   05-MAY-14 15:21:17 -04:00	  1:02:10
APPLY	    NOT STARTED
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED
}}}

{{{
$ adop phase=apply
He continues with standard adpatch :) Ho to abort it?
}}}

{{{
$ adop phase=abort
adop exiting with status = 0 (Success)
}}}

{{{
$ adop -status
ebs2		master		PREPARE     SESSION ABORTED 05-MAY-14 14:19:07 -04:00	   05-MAY-14 15:21:17 -04:00	  1:02:10
APPLY	    SESSION ABORTED 07-MAY-14 06:56:26 -04:00	   07-MAY-14 07:19:56 -04:00	  0:23:30
CUTOVER     SESSION ABORTED
CLEANUP     SESSION ABORTED
FINALIZE    SESSION ABORTED
}}}

OK, I should be able to do the fs_clone now.
{{{
$ adop phase=fs_clone
adop exiting with status = 2 (Fail)
[STATEMENT] There is a pending clone session for /u01/oracle/VIS/fs2.
}}}

to sie wywalalo: txkADOPPreparePhaseSynchronize.pl
Puscilem z reki cale polecenie i wywalilo sie na:

The Node Manager for machine ebs2 failed to start.
Try to start it manually

I start the whole app stack.

How does one handle eg Forms update when we have fs1 and fs2?
MOS:
  * Upgrading Oracle Fusion Middleware Technology Stack of Oracle E-Business Suite Release 12.2 to 11.1.1.7(11gR1 PS6) (Doc ID 1590356.1)


To jest wszystko zle!!!

Ja mialem caly system w statusie PREPARE, zgodnie z dokumentacja podczas aplikowania 12.2.3

Potem aplikowalem Application Tier Technology Patches, gdzie jest napisane:

Application tier technology patches must be applied to the PATCH file system.

Czyli odkrecam do snapschota (dobrze, ze go zrobilem), sprawdzam w jakim statusie jest adop, aplikuje patche Formsow, FMW na !!!PATCH!!! file system i dopiero potem jade z patchem 12.2.3.






== ADOP patching scenarios (some crash) ==
=== apply Forms/FMW patch to patch edition with the whole adop phases ===
OK, all is clean. DB up, APP up.

This time I will apply the Forms binaries patch to the filesystem patch edition. Together with the whole adop rutine, and when the APP is up.


{{{
$ adop -status
ebs3		master		APPLY	    COMPLETED	    14-MAY-14 10:43:41 +02:00	   14-MAY-14 11:13:07 +02:00	  0:29:26
CLEANUP     COMPLETED	    14-MAY-14 11:14:03 +02:00	   14-MAY-14 11:14:45 +02:00	  0:00:42
PREPARE     NOT APPLICABLE
CUTOVER     NOT APPLICABLE
FINALIZE    NOT STARTED
}}}

Pre check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl

Source the run filesystem and initiate adpatch
{{{
$ adop phase=prepare
}}}

Now source the patch filesystem and apply the patch.

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
}}}

{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory | grep 5659594
(nothing)
$ cd 5659594
$ opatch apply
$ opatch lsinventory | grep 5659594
  # Patch  5659594 applied on Wed May 14 13:41:35 CEST 2014
}}}

Post patch check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}


Source the run filesystem and complete the adpatch cycle
{{{
$ adop phase=finalize
$ adop phase=cutover
$ adop phase=cleanup
}}}

Post adop cleanup check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}

So nothing has changed in terms of what fs is patched, but now the run edition and patch edition is reversed. Now run is fs2 and patch is fs1.

{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
}}}

So, finally it is time to run fs_clone that will copy the run file system to the patch file system.

{{{
$ adop phase=fs_clone
And we are done. This all took a while:
Node Name	Node Type	Phase	    Status	    Started			   Finished		  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------
ebs3		master	PREPARE     COMPLETED	    14-MAY-14 16:37:04 14-MAY-14 16:58:01 +02:00	  0:20:57
FINALIZE    COMPLETED	    14-MAY-14 18:06:20 14-MAY-14 18:06:36 +02:00	  0:00:16
CUTOVER     COMPLETED	    14-MAY-14 18:08:10 14-MAY-14 18:31:50 +02:00	  0:23:40
CLEANUP     COMPLETED	    14-MAY-14 19:18:38 14-MAY-14 19:19:22 +02:00	  0:00:44
APPLY	    COMPLETED
}}}


But at the end both fs has the patches applied.

Post adop fs_clone check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}



=== apply Forms/FMW patch to patch edition without prepare phase ===



=== apply Forms/FMW patch to run edition and trying to resync ===
OK, all is clean. DB up (irrelevant), APP down.

{{{
$ adop -status
ebs3		master		APPLY	    COMPLETED	    14-MAY-14 10:43:41 +02:00	   14-MAY-14 11:13:07 +02:00	  0:29:26
CLEANUP     COMPLETED	    14-MAY-14 11:14:03 +02:00	   14-MAY-14 11:14:45 +02:00	  0:00:42
PREPARE     NOT APPLICABLE
CUTOVER     NOT APPLICABLE
FINALIZE    NOT STARTED
}}}


Pre check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

Now, with apps shut down I apply the Forms patch, like it would be a hotpatch to the run filesystem edition.

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
}}}

{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory | grep 5659594
(nothing)
$ cd 5659594
$ opatch apply
$ opatch lsinventory | grep 5659594
  # Patch  5659594 applied on Wed May 14 13:41:35 CEST 2014
}}}


Post patch check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
40) Patch
}}}

OK, so far, as expected we have the run edition patched. The patch edition is old.

Now I will run fs_clone phase. As help is suggesting
fs_clone      - Copy the run file system to the patch file system.

Source run edition
{{{
$ . /u01/oracle/VIS/EBSapps.env run
}}}

On APP tier start up only the Weblogic AdminServer service on the Run File System.
{{{
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start
}}}

{{{
$ adop phase=fs_clone
START 2014/05/14 13:48:34
END   2014/05/14 15:54:56
}}}

Post fs_clone check:
{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ cd $ORACLE_HOME/OPatch
$ ./opatch lsinventory
41) Patch
}}}

OK, so this approach works. The fs_clone procedure could probably be run when the system is running.

Is this way of applying patches to binaries supported?



=== to do ===
  * popieprzylem patchowanie, a caly czas dzialam na starym. Chce odkrecic, czy moge bez wracania do backupu?


== maintenance ==
=== concurrent managers logs ===
{{{
$APPLCSF/$APPLLOG
}}}

=== where am I? ===
Now, with APP environment it gets a litlle bit tricky. We have
/d01/oracle/VIS/fs1/EBSapps/appl/APPSVIS_jazz.env
/d01/oracle/VIS/fs2/EBSapps/appl/APPSVIS_jazz.env

Why? Because of ADOP - AD Online Patching, new way in which EBS is patched now.
Which is correct? It depends. Let's find out

{{{
$ grep EDITION /d01/oracle/VIS/fs*/EBSapps/appl/*env
/d01/oracle/VIS/fs1/EBSapps/appl/VIS_jazz.env:FILE_EDITION="run"
(...)
/d01/oracle/VIS/fs2/EBSapps/appl/VIS_jazz.env:FILE_EDITION="patch"
(...)
}}}

So /d01/oracle/VIS/fs1/EBSapps/appl/VIS_jazz.env is the current, active edition. And fs2 the patch one.


= Maintenance =
== Cloning ==
MOS:
  * Cloning Oracle E-Business Suite Release 12.2 with Rapid Clone (Doc ID 1383621.1)

=== Preclone APP ===
Preclone should be done on a properly running DB and APP tiers
{{{
$ source /u01/oracle/VIS/EBSapps.env run
$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier
}}}

=== Preclone DB ===
Preclone should be done on a properly running DB and APP tiers
{{{
$ . $HOME/scripto/ebs/db_env
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ perl adpreclone.pl dbTier
}}}


=== Copy DB and MT from source to target ===
On target (both):
{{{
# cd /u01
# cat rsyncd.conf
[tmp]
path = /u01/tmp
comment = write only
use chroot = no
max connections = 1
read only = false
write only = true
transfer logging = true
uid = root
gid = root
}}}

Shutdown both app and DB (that way it will be easier)

On source APP
{{{
# rsync -a --progress oracle target_app::tmp
}}}

On source DB
{{{
# rsync -a --progress oracle target_db::tmp
}}}

!!! Fix the rsyncd-munged

=== Prepare target DB to postclone ===
{{{
# chown oracle:oinstall /u01
# mv /u01/tmp/oracle /u01/
}}}

=== Postclone DB ===
{{{
$ cd /u01/oracle/VIS/11.2.0/appsutil/clone/bin
$ perl adcfgclone.pl dbTier
}}}


Enter the APPS password :
Target System Hostname (virtual or normal) [ebsdb4] :

Target Instance is RAC (y/n) [n] :

Target System Database SID : VIS

Target System Base Directory : /u01/oracle/VIS

Target System utl_file_dir Directory List : /tmp

Number of DATA_TOP's on the Target System [1] :

Target System DATA_TOP Directory 1 [/u01/oracle/VIS/data] :

Target System RDBMS ORACLE_HOME Directory [/u01/oracle/VIS/11.2.0] :

Do you want to preserve the Display [null] (y/n)  : y

Do you want the target system to have the same port values as the source system (y/n) [y] ? :
Complete port information available at /u01/oracle/VIS/11.2.0/appsutil/clone/bin/out/VIS_ebsdb4/portpool.lst

Creating the new Database Context file from :
/u01/oracle/VIS/11.2.0/appsutil/template/adxdbctx.tmp

The new database context file has been created :
/u01/oracle/VIS/11.2.0/appsutil/VIS_ebsdb4.xml

Completed Apply...
Starting database listener for VIS:

=== Prepare target APP to postclone ===
{{{
# chown applmgr:oinstall /u01
# mv /u01/tmp/oracle /u01/
}}}

Assuming that fs2 is the RUN edition

According to Note 1383621.1 we only need
<APPL_TOP>
<COMMON_TOP>
<OracleAS Tools 10.1.2 ORACLE_HOME>

APPL_TOP   =/u01/oracle/VIS/fs2/EBSapps/appl
COMMON_TOP =/u01/oracle/VIS/fs2/EBSapps/comn
ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2

Cleaning up:
mkdir -p /u01/trash/fs2
mv /u01/oracle/VIS/fs2/FMW_Home /u01/trash/fs2
mv /u01/oracle/VIS/fs2/inst /u01/trash/fs2
mv /u01/oracle/VIS/fs1 /u01/trash
mv /u01/oracle/VIS/fs_ne /u01/trash
mv /u01/oracle/VIS/EBSapps.env /u01/trash

Fix the munged-rsyn links if required
{{{
$ wget http://download.vikis.lt/doc/rsync-3.0.6/support/munge-symlinks
$ chmod 755 munge-symlinks
$ ./munge-symlinks --unmunge
}}}

=== Postclone APP ===
==== Postclone APP run edition ====
{{{
$ cd <COMMON_TOP>/clone/bin
which is if fs2 is run edition
$ cd /u01/oracle/VIS/fs2/EBSapps/comn/clone/bin
$ perl adcfgclone.pl appsTier
}}}

Enter the APPS password :
Enter the Weblogic AdminServer password :

Do you want to add a node (yes/no) [no] :
Target System File Edition type [run] :

Provide the values required for creation of the new APPL_TOP Context file.

Target System Hostname (virtual or normal) [ebs4] :

Target System Database SID : VIS

Target System Database Server Node [ebs4] : ebsdb4

Target System Database Domain Name [remik.org] :

Target System Base Directory : /u01/oracle/VIS

Target System Base Directory set to /u01/oracle/VIS

Target System Current File System Base set to /u01/oracle/VIS/fs2

Target System Other File System Base set to /u01/oracle/VIS/fs1

Target System Fusion Middleware Home set to /u01/oracle/VIS/fs2/FMW_Home

Target System Web Oracle Home set to /u01/oracle/VIS/fs2/FMW_Home/webtier

Target System Appl TOP set to /u01/oracle/VIS/fs2/EBSapps/appl

Target System COMMON TOP set to /u01/oracle/VIS/fs2/EBSapps/comn

Target System Instance Home Directory [/u01/oracle/VIS] :

Target System Instance Top set to /u01/oracle/VIS/fs2/inst/apps/VIS_ebs4

Do you want to preserve the Display [ebs2:0.0] (y/n)  : n

Target System Display [ebs4:0.0] :

Target System Root Service [enabled] :

Target System Web Administration [enabled] :

Target System Web Entry Point Services [enabled] :

Target System Web Application Services [enabled] :

Target System Batch Processing Services [enabled] :

Target System Other Services [disabled] :

Do you want the target system to have the same port values as the source system (y/n) [y] ? :
Complete port information available at /u01/oracle/VIS/fs2/EBSapps/comn/clone/bin/out/VIS_ebs4/portpool.lst

UTL_FILE_DIR on database tier consists of the following directories.

  # /usr/tmp
2. /tmp
3. /u01/oracle/VIS/11.2.0/appsutil/outbound/VIS_ebsdb4
4. /usr/tmp
Choose a value which will be set as APPLPTMP value on the target node [1] : 2

Creating the new APPL_TOP Context file from :
/u01/oracle/VIS/fs2/EBSapps/comn/clone/context/apps/adxmlctx.tmp

The new APPL_TOP context file has been created :
/u01/oracle/VIS/fs2/inst/apps/VIS_ebs4/appl/admin/VIS_ebs4.xml

Do you want to startup the Application Services for VIS? (y/n) [n] :
  *>
Wait a second. First edit:
{{{
$ vi /u01/oracle/VIS/fs2/inst/apps/VIS_ebs4/ora/10.1.2/network/admin/sqlnet.ora
$ vi /u01/oracle/VIS/fs2/inst/apps/VIS_sun4/ora/10.1.2/network/admin/sqlnet.ora
#tcp.validnode_checking = yes
#tcp.invited_nodes = (EBS4.remik.org, EBSDB4.remik.org)
}}}

Then:
Do you want to startup the Application Services for VIS? (y/n) [n] : y

=== Run preclone on the run edition file system ===

{{{
$ source /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
File System Type          : SINGLE
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : NOT APPLICABLE
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}

{{{
$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier
}}}

=== copy from the run edition file system to the patch edition file system ===
Stop MT
{{{
$ . /u01/oracle/VIS/EBSapps.env run
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps
}}}

{{{
$ cd /u01/oracle/VIS
}}}

We need only
APPL_TOP   =/u01/oracle/VIS/fs1/EBSapps/appl
COMMON_TOP =/u01/oracle/VIS/fs1/EBSapps/comn
ORACLE_HOME=/u01/oracle/VIS/fs1/EBSapps/10.1.2

Assuming, that fs2 is RUN edition
{{{
$ mkdir /u01/oracle/VIS/fs1
$ cp -RH /u01/oracle/VIS/fs2/EBSapps /u01/oracle/VIS/fs1
~ 40min
}}}

Check symbolic links after copy
{{{
$ ls -l /u01/oracle/VIS/fs2/EBSapps/10.1.2/precomp/public/SQLDA.H
lrwxrwxrwx 1 applmgr oinstall 7 Jul 13 22:21 /u01/oracle/VIS/fs2/EBSapps/10.1.2/precomp/public/SQLDA.H -> sqlda.h
$ ls -l /u01/oracle/VIS/fs1/EBSapps/10.1.2/precomp/public/SQLDA.H
lrwxrwxrwx 1 applmgr oinstall 7 Jul 13 23:33 /u01/oracle/VIS/fs1/EBSapps/10.1.2/precomp/public/SQLDA.H -> sqlda.h
}}}

=== logon to the patch edition file system and run postclone ===
Relogin, do not source any env, go to patch system clone/bin

Assuming that fs1 is the PATCH edition
{{{
$ cd /u01/oracle/VIS/fs1/EBSapps/comn/clone/bin
$ perl adcfgclone.pl appsTier
}}}

Enter the APPS password :
Enter the Weblogic AdminServer password :
Do you want to add a node (yes/no) [no] :
Target System File Edition type [run] : patch
Enter the full path of Run File System Context file : /u01/oracle/VIS/fs2/inst/apps/VIS_ebs4/appl/admin/VIS_ebs4.xml
Target System Port Pool [0-99] : 2
Choose a value which will be set as APPLPTMP value on the target node [1] :

Looking for incomplete CLONE record in ad_adop_session_patches table
The CLONE record status is no rows selected
Updating incomplete CLONE record to COMPLETED

=== Running fs_clone ===
Relogin, source run edition.

{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}


DB Host: ebsdb2.remik.org  Service/SID: VIS


Sourcing the RUN File System ...

{{{
$ adop phase=fs_clone
Enter the APPS password:
Enter the SYSTEM password:
Enter the WLSADMIN password:
}}}

adop exiting with status = 0 (Success)



== Autoconfig ==
Must Read:
  * Using AutoConfig to Manage System Configurations in Oracle E-Business Suite Release 12 (Doc ID 387859.1)

=== See what will be changed when you run autoconfig ===
(can be run on both app and DB tiers)

adchkcfg.sh contextfile=$CONTEXT_FILE

=== Application tier ===
Stop the application tier services prior to run autoconfig.

Confirmed (see below): Just run autoconfig on RUN fs, during fs_clone he will sync that to PATCH fs.

Run AutoConfig on all application tier nodes
{{{
$ cd $ADMIN_SCRIPTS_HOME
or
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh
}}}

=== Database tier ===
{{{
$ . $HOME/scripto/ebs/db_env
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./adautocfg.sh
}}}

After running autoconfig on DB tier check file sqlnet.ora if it is ok to restrict access to DB. On Developmnet systems it is usually not. Then we need to comment the below lines out.
$ cd $TNS_ADMIN
$ cat sqlnet.ora | grep tcp
tcp.validnode_checking = yes
tcp.invited_nodes=(...)

=== Autoconfig logs ===
MOS:
  * How to find location of Install, Autoconfig, Patching , Clone and other logs in R12 [ID 804603.1]
  * Oracle Application Server Diagnostic Tools and Log Files in Applications Release 12 [ID 454178.1]

Apps:
$INST_TOP/apps/$CONTEXT_NAME/admin/log/$MMDDHHMM/adconfig.log

Db:
$ORACLE_HOME/appsutil/log/$CONTEXT_NAME/<MMDDHHMM>/adconfig.log


=== Running autoconfig as a result of CONTEXT_FILE change ===
Let's assume that we want to change the value of s_applptmp

Shutdown MT

Currently set:
$ env | grep APPLPTMP
APPLPTMP=/tmp
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/tmp</APPLPTMP>

Changing CONTEXT_FILE value to /u01/oracle/tmp
$ vim $CONTEXT_FILE
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/u01/oracle/tmp</APPLPTMP>

Running autoconfig, relogin.
$ env | grep APPLPTMP
APPLPTMP=/u01/oracle/tmp

OK, so he got it. Let's check how is it sen on patch edition.
$ . /u01/oracle/VIS/EBSapps.env patch
$ env | grep APPLPTMP
APPLPTMP=/tmp
  *> the old way.

Lets compare the context files:
Run edition
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/u01/oracle/tmp</APPLPTMP>

Patch edition
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/tmp</APPLPTMP>

Ok, as expected. Lets go through the adop cycle.
$ adop phase=prepare
$ adop phase=cutover

Relogin

Run edition
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/u01/oracle/tmp</APPLPTMP>
$ env | grep APPLPTMP
APPLPTMP=/u01/oracle/tmp

Patch edition
$ cat $CONTEXT_FILE | grep s_applptmp
<APPLPTMP oa_var="s_applptmp" osd="UNIX">/u01/oracle/tmp</APPLPTMP>
$ env | grep APPLPTMP
APPLPTMP=/u01/oracle/tmp

Conclusion: all nice. Change to CONTEXT_FILE has been transfered to patch edition, and autoconfig was run on it which in turn resulted in consistent variable set between patch and run editions.

We make changes to context file on run edition, they will be transfered to patch edition during the next adop cycle.



== Purging out and log dir ==
Just remove
{{{
$ find /u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/log/ -maxdepth 1 -name "*.req" -type f -mtime +60 -print -exec rm {} ;
}}}

Move and gzip
{{{
$ mkdir /u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/log/20141027
$ find /u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/log/ -maxdepth 1 -name "*.req" -type f -mtime +60 -print -exec mv {} /u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/log/20141027 ;
$ tar cvzf 20141027.tar.gz 20141027
$ rm -Rf 20141027
}}}



== troubleschooting ==
MOS:
  * Troubleshooting RapidClone issues with Oracle Applications R12 (Doc ID 603104.1)

=== Control file creation failed ===
During:
{{{
$ perl adcfgclone.pl dbTier
}}}

Seen in log:
ORA-15180: could not open dynamic library odm library, error [open]

MOS:
  * ORA-15180: Could not open dynamic library odm libraryump while doing startup (Doc ID 435826.1)

That is because of rsync!
{{{
$ cd /u01/oracle/VIS/11.2.0/lib
$ ls -l libocci.so
lrwxrwxrwx 1 oracle oinstall        30 Jul 13 11:14 libocci.so -> /rsyncd-munged/libocci.so.11.1
}}}

{{{
$ wget http://download.vikis.lt/doc/rsync-3.0.6/support/munge-symlinks
$ chmod 755 munge-symlinks
$ ./munge-symlinks --unmunge
$ ls -l libocci.so
lrwxrwxrwx 1 oracle oinstall 15 Jul 13 21:30 libocci.so -> libocci.so.11.1
}}}



=== sqlplus: error while loading shared libraries: libclntsh.so.10.1: cannot open shared object file: No such file or directory ===

Fix the blody sym links! See above.



=== ORA-04063: table "CSR.CSR_RULES_B" has errors ===

{{{
> connect apps
> exec fnd_stats.gather_table_stats('CSR','CSR_RULES_B');
ERROR at line 1:
ORA-04063: table "CSR.CSR_RULES_B" has errors
ORA-06512: at "APPS.FND_STATS", line 2905
ORA-06512: at line 1
}}}

{{{
> select count(*) from CSR.CSR_RULES_B;
select count(*) from CSR.CSR_RULES_B
= =
ERROR at line 1:
ORA-04063: table "CSR.CSR_RULES_B" has errors
}}}

CSR_RULES_B                    CSR                  TABLE
CSR_RULE_WINDOWS_B             CSR                  TABLE
CSR_RULES_B#                   CSR                  VIEW

==== Actions from (Doc ID 1221233.1) ====

MOS:
  * Invalid CSR_RULES_B Table And Invalid Objects With CSRRSREG.sql (Doc ID 1221233.1)

{{{
> connect apps
> PURGE RECYCLEBIN;
> ALTER SESSION SET RECYCLEBIN=OFF;
> BEGIN
DBMS_XMLSCHEMA.deleteSchema(
schemaurl => 'http://xmlns.oracle.com/CRM/Scheduler/Rules',
delete_option => DBMS_XMLSCHEMA.DELETE_CASCADE_FORCE);
}}}

COMMIT;

EXCEPTION
WHEN OTHERS THEN
dbms_output.put_line('Encountered ' || SQLERRM ||
' when deleting Scheduler Rules XML Schema');
END;

SELECT *
FROM user_xml_schemas
WHERE schema_url = 'http://xmlns.oracle.com/CRM/Scheduler/Rules';
  *> no rows selected

{{{
> select OWNER, SCHEMA_OWNER, table_name, element_name
from dba_xml_tables
where xmlschema = 'http://xmlns.oracle.com/CRM/Scheduler/Rules';  2    3
}}}

? no rows selected

On app tier:
{{{
$ cd $CSR_TOP/patch/115/sql/
> connect apps
> @csrrsreg.sql apps apps csr csr /u01/oracle/VIS/fs2/EBSapps/appl/csr/12.0.0
}}}

select object_name, owner, status
from all_objects
where object_name like 'spMinTaskLength%_TAB%';

==== nothing is happening ====
{{{
> select count(*) from CSR.CSR_RULES_B;
}}}

COUNT(*)
  *---------
  #

{{{
> drop table CSR.CSR_RULES_B;
> @csrrsreg.sql apps apps csr csr /u01/oracle/VIS/fs2/EBSapps/appl/csr/12.0.0
> select count(*) from CSR.CSR_RULES_B
2  ;
select count(*) from CSR.CSR_RULES_B
= =
ERROR at line 1:
ORA-00942: table or view does not exist
}}}


CSR.CSR_RULES_B - not recreated

How to recreate it?

==== different script ====
Based on SR 3-9803261077: INVALID CSR TABLES - CSR_RULES_B CSR_RULES_WINDOWS_B

{{{
> select count(*) from CSR.CSR_RULES_B;
}}}

COUNT(*)
  *---------
  #

{{{
> create table CSR.CSR_RULES_B_BCK_20141105 as select * from CSR.CSR_RULES_B;
> drop table CSR.CSR_RULES_B;
}}}

{{{
$ cd $CSR_TOP/patch/115/sql/
> connect apps
> @csrxmlebr.sql apps apps csr csr /u01/oracle/VIS/fs2/EBSapps/appl/csr/12.0.0
}}}

Asks for &6/&7

yes that is right - the additional parameters are for the apps_ne schema (which does not exist before 12.2):

the parameters expected by csrxmlebr.sql  are:
&un_apps    --> apps schemaname (standard = APPS)
&pw_apps    --> apps password
&un_csr     --> CSR schema name (standard = CSR)
&pw_csr     --> CSR schema password
&top_csr    --> value of $CSR_TOP
&un_apps_ne --> apps_ne schemaname (standard apps_ne)
&pw_apps_ne --> apps_ne password

{{{
> connect apps
> @csrxmlebr.sql apps apps csr csr /u01/oracle/VIS/fs2/EBSapps/appl/csr/12.0.0 apps_ne apps
}}}

{{{
> select count(*) from CSR.CSR_RULES_B;
}}}

COUNT(*)
  *---------
0

So he did it, but somehow differently.

select s.schema.getclobval()
from user_xml_schemas s
where s.schema_url like 'http://xmlns.oracle.com/CRM/Scheduler/Rules';

select csr.rule_doc.getClobVal() from csr_rules_vl csr where csr.rule_id = 0;



=== ORA-04063: table "AZ.AZ_DIFF_RESULTS" has errors ===
MOS:
  * How to Cleanup Invalid Oracle iSetup (AZ) Tables (Doc ID 832459.1)

{{{
> SELECT username, account_status   FROM dba_users  WHERE username = 'XDB';
USERNAME		       ACCOUNT_STATUS
  *----------------------------- --------------------------------
XDB			       EXPIRED & LOCKED
}}}


{{{
> ALTER USER xdb IDENTIFIED BY xdb ACCOUNT UNLOCK;
}}}

{{{
> SELECT username, account_status   FROM dba_users  WHERE username = 'XDB';
}}}

USERNAME		       ACCOUNT_STATUS
  *----------------------------- --------------------------------
XDB			       OPEN

SELECT 'drop type ' || owner || '.' || type_name || ' force;'
FROM all_types
WHERE type_name LIKE 'AZ%';

drop type APPS_NE.AZ_RPTDATA_H force;
drop type APPS_NE.AZ_RPTDATA_V_COLL force;
drop type APPS_NE.AZ_RPTDATA_V_TAGS force;
drop type APPS_NE.AZ_RPTDIFF_H force;
drop type APPS_NE.AZ_RPTDIFF_V_COLL force;
drop type APPS_NE.AZ_RPTDIFF_V_TAGS force;
drop type APPS_NE.AZ_SELSETS_EXT force;
drop type APPS_NE.AZ_SELSETS_H force;
drop type APPS_NE.AZ_SELSETS_H_COLL force;
drop type APPS_NE.AZ_SELSETS_V1484_T force;
drop type APPS_NE.AZ_SELSETS_V_COLL force;


{{{
$ sqlplus az/az
DROP TABLE AZ_REQUESTS;
DROP TABLE AZ_REPORTER_DATA;
DROP TABLE AZ_DIFF_RESULTS;
exit;
}}}

cd $AZ_TOP/patch/115/xdf

adjava "-mx128m" "-nojit" "oracle.apps.fnd.odf2.FndXdfCmp" "<az-user>" "<az-password>" "<apps-user>" "<apps-password>" "thin" "(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=<database-host>)(PORT=<database-port>))(CONNECT_DATA=(SID=<database-SID>)))"
"table" "az_diff_results.xdf" "$FND_TOP/patch/115/xdf/xsl"

which is by me

adjava "-mx128m" "-nojit" "oracle.apps.fnd.odf2.FndXdfCmp" "az" "az" "apps" "apps" "thin" "(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=ebsdb4)(PORT=1521))(CONNECT_DATA=(SID=VIS)))" "table" "az_diff_results.xdf" "$FND_TOP/patch/115/xdf/xsl"

adjava "-mx128m" "-nojit" "oracle.apps.fnd.odf2.FndXdfCmp" "az" "az" "apps" "apps" "thin" "(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=ebsdb4)(PORT=1521))(CONNECT_DATA=(SID=VIS)))" "table" "az_reporter_data.xdf" "$FND_TOP/patch/115/xdf/xsl"

adjava "-mx128m" "-nojit" "oracle.apps.fnd.odf2.FndXdfCmp" "az" "az" "apps" "apps" "thin" "(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=ebsdb4)(PORT=1521))(CONNECT_DATA=(SID=VIS)))" "table" "az_requests.xdf" "$FND_TOP/patch/115/xdf/xsl"

6. Restore the iSetup XMLDB Schemas by executing the following scripts:

{{{
$ sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhDiffSchema.sql manager
$ sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhRptSchema.sql manager
$ sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhSelSetSchema.sql manager
}}}

7. Restore iSetup specific XMLTYPE columns by executing the following scripts:

sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhAddDiffCol.sql az az
sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhAddDriver.sql az az
sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhAddRptCol.sql az az
sqlplus apps/apps @$AZ_TOP/patch/115/sql/azhAddSelSet.sql az az

8. For 12.2 only
{{{
> connect apps
exec ad_zd_table.patch('AZ','AZ_REQUESTS');
exec ad_zd_table.patch('AZ','AZ_REPORTER_DATA');
exec ad_zd_table.patch('AZ','AZ_DIFF_RESULTS');
}}}

9. Provide appropriate grants with the following script:

{{{
$ sqlplus apps/apps @$AZ_TOP/patch/115/sql/azR12grants.sql manager
}}}

{{{
> @?/rdbms/admin/utlrp.sql
}}}




== Change default passwords ==
Based on MOS:
  * Secure Configuration Guide for Oracle E-Business Suite Release 12 (Doc ID 403537.1)

We need to change the Oracle RDBMS accounts connected with application - users that can be seen in DB view DBA_USERS and application users that can be seen in view APPL.FND_USERS.

=== Change default application passwords ===
To display application users that have default passwords set execute the following script

Login to app node
{{{
$ sqlplus apps
> @$FND_TOP/patch/115/sql/fnddefpw.sql
}}}

Example output:
{{{
USER_WITH_DEFAULT_PASSWORD
  *---------------------------
AME_INVALID_APPROVER
ASGADM
GUEST
IRC_EMP_GUEST
IRC_EXT_GUEST
MOBILEADM
XML_USER
}}}

For the displayed users change the password using the new AFPASSWD utility. Do NOT change the password for user GUEST (the utility will not allow that anyway).

Login to app node
{{{
$ AFPASSWD -f AME_INVALID_APPROVER
$ AFPASSWD -f ASGADM
(...)
}}}

After the change run the test script again
{{{
$ sqlplus apps
> @$FND_TOP/patch/115/sql/fnddefpw.sql
USER_WITH_DEFAULT_PASSWORD
  *---------------------------
GUEST

  #row selected.
}}}

It should show only one GUEST account.

==== Changing APPLSYSPUB ====

Shutdown MT

Change password
$ FNDCPASS APPS/<apps_pwd> 0 Y SYSTEM/<system_pwd> ORACLE APPLSYSPUB <new_pwd>
eg
$ FNDCPASS APPS/apps 0 Y SYSTEM/manager ORACLE APPLSYSPUB ORACLE12

If we run autoconfig now and restart MT we probably bet the following error: The system has encountered an error when servicing the request. If the error persists, please contact the system administrator.

That is why some extra action is needed:

Edit Context file
$ cp $CONTEXT_FILE $CONTEXT_FILE_`date -I`
$ vi $CONTEXT_FILE
Change:
<password oa_var="s_gwyuid_pass">PUB</password>
<GWYUID oa_var="s_gwyuid">APPLSYSPUB/PUB</GWYUID>
To:
<password oa_var="s_gwyuid_pass">NEWPUBPASS</password>
<GWYUID oa_var="s_gwyuid">APPLSYSPUB/NEWPUBPASS</GWYUID>

Run Autoconfig
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh
AutoConfig completed successfully.

Startup MT

===== Going through adop cycle, just as a test =====
$ adop phase=prepare
========================================

SUMMARY OF PATCHES BEING SYNCHRONIZED...

========================================
[1] SINGLE PATCH (DRV=u17999920.drv):  17999920
[2] SINGLE PATCH (DRV=u18054175.drv):  18054175

LOGPATH is set to /u01/oracle/VIS/fs_ne/EBSapps/log/adop/17/prepare_20141210_152057/VIS_sun4/TXK_SYNC_update_Wed_Dec_10_15_25_33_2014/log

AutoPatch error:
ORA-01031: insufficient privileges
ORA-06512: at "SYS.DBMS_SESSION", line 114
ORA-06512: at "APPS.AD_JAR", line 17
ORA-06512: at line 3

  *> aborting prepare, forcing complete fs_sync

$ adop phase=abort
adop exiting with status = 1 (Fail)
AutoPatch error:
ORA-01031: insufficient privileges

OK, lets source patch edition and change context file there too
$ . /u01/oracle/VIS/EBSapps.env patch
  * change context file
  * run autoconfig on patch edition

$ adop phase=abort
adop phase=abort - Completed Successfully
adop exiting with status = 0 (Success)

OK, so that was it. Prepare again.

$ adop phase=prepare
AutoPatch error:
ORA-01031: insufficient privileges
Unable to get passwords from Vault

MOS: Unable To Apply Patch 17023760 - ORA-01031: Insufficient Privileges (Doc ID 1627896.1)
> @$ORACLE_HOME/appsutil/admin/adgrants.sql apps

Prepare again.
$ adop phase=prepare
adop exiting with status = 0 (Success)

And cutover
$ adop phase=cutover

===== Repeating the password change, to make sure where is the problem =====
Shutdown MT

Change password
$ FNDCPASS APPS/apps 0 Y SYSTEM/manager ORACLE APPLSYSPUB AGAIN12

Edit Context file
$ vi $CONTEXT_FILE

Run Autoconfig
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh
AutoConfig completed successfully.

Startup MT

Login work fine.

Patching cycle.
$ adop phase=prepare
adop phase=prepare - Completed Successfully

$ adop phase=cutover
adop phase=cutover - Completed Successfully

Now, the question is: was the contex file synced?
  *> Yes, it was. So no need to change context file on the patch edition.

$ cat /u01/oracle/VIS/fs2/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml | grep -e s_gwyuid -e s_gwyuid_pass
<username oa_var="s_gwyuid_user">APPLSYSPUB</username>
<password oa_var="s_gwyuid_pass">AGAIN12</password>
<GWYUID oa_var="s_gwyuid">APPLSYSPUB/AGAIN12</GWYUID>

$ cat /u01/oracle/VIS/fs1/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml | grep -e s_gwyuid -e s_gwyuid_pass
<username oa_var="s_gwyuid_user">APPLSYSPUB</username>
<password oa_var="s_gwyuid_pass">AGAIN12</password>
<GWYUID oa_var="s_gwyuid">APPLSYSPUB/AGAIN12</GWYUID>








=== Change Oracle Applications Database user ===
Database users related to applications can be changed using the AFPASSWD as well, but with different parameter.

Database provides a view that will list all the users with default passwords.

{{{
$ sqlplus apps
> select USERNAME from DBA_USERS_WITH_DEFPWD;
}}}

Example output:
{{{
(...)
USERNAME
  *-----------------------------
ONT
OPI
PA
PRP
RRS
SI_INFORMTN_SCHEMA
SYS
WSH
WSM

  #6 rows selected.
}}}

To change the password to all database accounts connected with applications we can use AFPASSWD -a, which is equivalent of the old $ FNDCPASS APPS/<apps_pwd> 0 Y SYSTEM/<system_pwd> ALLORACLE <NEW_PWD>

{{{
$ AFPASSWD -a
Enter the ORACLE password of Application Object Library 'APPSUSER':    # this is just to login, the password
Enter the password for your 'SYSTEM' ORACLE schema:                    # this is just to login too
Enter new password for user:                     # that is the new password for accounts like AR, GL, etc.
}}}

After that change we should see substantially less accounts in DBA_USERS_WITH_DEFPWD view
{{{
$ sqlplus apps
> select USERNAME from DBA_USERS_WITH_DEFPWD;
}}}

Example output:
{{{
(...)
USERNAME
  *-----------------------------
DBSNMP
MDDATA
ORDPLUGINS
ORDSYS

35 rows selected.
}}}

For the remaining Database users consult Appendix C: Database Schemas found in Oracle E-Business Suite, in mentioned (Doc ID 403537.1) on page 47.




== Changing tnsnames on DB tier ==
=== Location of TNS_ADMIN ===
Sourcing the env file sets the TNS_ADMIN variable

$ grep TNS_ADMIN /u01/oracle/VIS/11204/VIS_ebsdb4.env
TNS_ADMIN="/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4"

Buth the actual location is set in CONTEXT_FILE

$ grep -i tnsadmin $CONTEXT_FILE
<TNS_ADMIN oa_var="s_db_tnsadmin">/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4</TNS_ADMIN>

If we want to change the location, say to /u01/oracle/VIS/11204/network/admin/VIS_blabla we have to do the following:

Change the value of s_db_tnsadmin $CONTEXT_FILE
$ cp $CONTEXT_FILE ${CONTEXT_FILE}_`date -I`
$ vim $CONTEXT_FILE
$ diff $CONTEXT_FILE ${CONTEXT_FILE}_`date -I`
  #7c157
<          <TNS_ADMIN oa_var="s_db_tnsadmin">/u01/oracle/VIS/11204/network/admin/VIS_blabla</TNS_ADMIN>
  *--
>          <TNS_ADMIN oa_var="s_db_tnsadmin">/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4</TNS_ADMIN>


Probably we need to change the location of ifile as well
$ grep VIS_ebsdb4 $CONTEXT_FILE | grep "network/admin"
<IFILE oa_var="s_ifile">/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4/VIS_ebsdb4_ifile.ora</IFILE>
<LSNR_IFILE oa_var="s_lsnr_ifile">/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4/listener_ifile.ora</LSNR_IFILE>
<SQLNET_IFILE oa_var="s_sqlnet_ifile">/u01/oracle/VIS/11204/network/admin/VIS_ebsdb4/sqlnet_ifile.ora</SQLNET_IFILE>

$ vim $CONTEXT_FILE


Now run autoconfig
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./adautocfg.sh

Relogin, because the env file has been recreated too.
$ exit
$ env | grep TNS
TNS_ADMIN=/u01/oracle/VIS/11204/network/admin/VIS_blabla










== What is installed where ==
Nice links:
  * http://onlineappsdba.com/index.php/2008/08/17/oracle-releaseversion-number-for-apps-forms-jinitiator-oid-sso-portal-ias-oc4j-unix-xxxx/
  * https://community.oracle.com/thread/2131716


  #.2.4
  #919161

R12.AD.C.Delta.6
  #197270

R12.TXK.C.Delta.6
  #330775

R12.AD.C.Delta.5
  #283295

R12.TXK.C.Delta.5
  #288881

=== Basic info ===
select name from v$database;
select * from v$version;
select COMMENTS from  registry$history where COMMENTS like 'PSU%';
select release_name from apps.fnd_product_groups;
select patch_level from apps.fnd_product_installations where patch_level like '%AD%';
select patch_level from apps.fnd_product_installations where patch_level like '%FND%';

=== other ===

What is the patchset level
Applications Manager / Applications Dashboard / Other Links - Products Installed

i expense , Short code is IBY
> select patch_level from apps.fnd_product_installations where patch_level like '%IBY%';

> select patch_level from apps.fnd_product_installations where patch_level like '%AP%';
PATCH_LEVEL
  *-----------------------------
R12.AP.C.3



= Interesting tasks =
== adop: do I have to run cleanup after cutover? ==
Just apply two patches (irrelewant what they do) using only cycle prepare,apply,cutover
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
$ adop phase=prepare
[EVENT]     Calling cleanup since cleanup was not run in previous patching session.
[EVENT]     [START 2015/03/20 12:38:08] Performing Cleanup steps
[EVENT]     [START 2015/03/20 12:40:10] Sync FS of RUN and PATCH
adop exiting with status = 0 (Success)

$ adop phase=apply patches=18668337 patchtop=/STAGING/ebs12patches
adop phase=apply - Completed Successfully

$ adop phase=cutover
adop phase=cutover - Completed Successfully

###### Another adop cycle ######

RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
$ adop phase=prepare
[EVENT]     Calling cleanup since cleanup was not run in previous patching session.
[EVENT]     [START 2015/03/20 14:27:42] Performing Cleanup steps
[EVENT]     [START 2015/03/20 15:03:32] Sync FS of RUN and PATCH
SUMMARY OF PATCHES BEING SYNCHRONIZED...
[1] SINGLE PATCH (DRV=u18668337.drv):  18668337
adop phase=prepare - Completed Successfully

$ adop phase=apply patches=18376908 patchtop=/STAGING/ebs12patches
adop phase=apply - Completed Successfully

$ adop phase=cutover
adop phase=cutover - Completed Successfully
###### Another adop cycle ######

RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
$ adop phase=prepare
[EVENT]     Calling cleanup since cleanup was not run in previous patching session.
[EVENT]     [START 2015/03/20 16:28:50] Performing Cleanup steps
[EVENT]     [START 2015/03/20 16:37:24] Sync FS of RUN and PATCH
SUMMARY OF PATCHES BEING SYNCHRONIZED...
[1] SINGLE PATCH (DRV=u18376908.drv):  18376908
adop phase=prepare - Completed Successfully

Conclusion: No, there is no need to run cleanup manually after cutover. No need to run fs_clone either. The prepare will run cleanup, that will run fs_clone if needed.



== Grnating privileges causes masive invalidations ==
MOS:
  * Granting Privileges On An Object May Cause Invalidations (Doc ID 1987947.1)
  * BUG:19674458 - GRANTING SELECT ON LARGE NUMBER OF OBJECTS TO A ROLE CAUSES MASSIVE INVALIDS

Find some objects to experiment with

set linesize 200
col object_name for a40
select object_name, owner, object_type from dba_objects where object_name like 'FND%' order by object_name;

select object_name, owner, object_type from dba_objects where object_name like 'FND%' and owner = 'APPS' order by object_name;

select object_name, owner, object_type from dba_objects where object_name like 'FND%' and owner = 'APPLSYS' and object_type = 'TABLE' order by object_name;


=== testcase how to cause masive invalidations ===

Current DB invalids
> select sysdate, count(1) from dba_objects where status != 'VALID'
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 12:49:57	    14

> select object_name, owner, object_type from dba_objects where status != 'VALID' order by owner
OBJECT_NAME		       OWNER		    OBJECT_TYPE
  *----------------------------- -------------------- -------------------
FFP55409_01012007	       APPS		    PACKAGE BODY
FFP55409_01012011	       APPS		    PACKAGE BODY
FFP55429_01011900	       APPS		    PACKAGE BODY
FFP60280_01010001	       APPS		    PACKAGE BODY
FFP60342_01010001	       APPS		    PACKAGE BODY
FFP60342_01012006	       APPS		    PACKAGE BODY
FFP61912_01010001	       APPS		    PACKAGE BODY
FFP60342_01012009	       APPS		    PACKAGE BODY
FFP60356_01011951	       APPS		    PACKAGE BODY
FFP61161_01010001	       APPS		    PACKAGE BODY
FFP61867_01010001	       APPS		    PACKAGE BODY
FFP61871_01010001	       APPS		    PACKAGE BODY
FFP61897_01010001	       APPS		    PACKAGE BODY
FFP60342_01012008	       APPS		    PACKAGE BODY

  # rows selected.


=== Giving grant on editioned table to a user, try 1 ===
> connect apps/apps
> grant select on FND_PROFILE to "BOLINF";
ERROR at line 1:
ORA-02225: only EXECUTE and DEBUG privileges are valid for procedures

> select sysdate, count(1) from dba_objects where status != 'VALID'
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 12:55:06	  9503

Conclusion: a grant that has not even succedded caused 9503 - 14 objects to become invalid.

=== Giving grant on editioned table to a user, try 2 ===
Compile all invalids
> exec sys.utl_recomp.recomp_parallel(4);
> select sysdate, count(1) from dba_objects where status != 'VALID'
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 21:52:24	    14


> connect apps/apps
> grant select on FND_TREE_FOLDERS to "BOLINF";
Grant succeeded.

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:02:42	    14


grant select on FND_TRANSLATION_EXCEPTIONS to "BOLINF";

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:13:07	    14


> grant select on FND_OBJECTS to "BOLINF";

Grant succeeded.

> select sysdate, count(1) from dba_objects where status != 'VALID'

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:14:45	   384

> exec sys.utl_recomp.recomp_parallel(4);

> select sysdate, count(1) from dba_objects where status != 'VALID'

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:52:31	    14

> grant select on FND_OBJECTS to "BOLINF";

Grant succeeded.

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:53:56	    14

  *> ok, granting again does not change anything.

> revoke select on FND_OBJECTS from "BOLINF";

Revoke succeeded.

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:55:58	    14

  *> revoke does not change anything

> grant select on FND_OBJECTS to "BOLINF";

Grant succeeded.

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 22:56:36	    14

  *> Granting again does not change anything.


=== Granting using the API ===
==== first test ====
> connect apps/apps
> desc AD_ZD
PROCEDURE GRANT_PRIVS
Argument Name			Type			In/Out Default?
  *----------------------------- ----------------------- ------ --------
X_PERMISSIONS			VARCHAR2		IN
X_OBJECT_NAME			VARCHAR2		IN
X_GRANTEE			VARCHAR2		IN
X_OPTIONS			VARCHAR2		IN     DEFAULT

> exec AD_ZD.GRANT_PRIVS('SELECT','FND_TABLES','BOLINF');
PL/SQL procedure successfully completed.

Invalids:

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 23:14:50	    14

  *> ok, no change in invalids

> connect BOLINF/xxx
> select count(1) from apps.FND_TABLES;

COUNT(1)
  *---------
23393

  *> ok, so this works well

How to revoke them? Don't see the api suitable for that.

> revoke select on FND_TABLES from "BOLINF";

This revoke command created lots of invalids:

SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/12 23:23:32	   318

Again let's try to grant first through API the by regular grant.

> connect BOLINF/xxx
> select count(1) from apps.FND_TABLESPACES;
ORA-00942: table or view does not exist

OK, that is to be expected.

> connect apps/apps
> exec AD_ZD.GRANT_PRIVS('SELECT','FND_TABLESPACES','BOLINF');

No new invalids.

> connect BOLINF/xxx
> select count(1) from apps.FND_TABLESPACES;
COUNT(1)
  *---------
9
OK, the grant works.

Trying to grant through the regular grant.

> connect apps/apps
> grant select on FND_TABLESPACES to "BOLINF";

New invalids appear.

Recompile

> exec sys.utl_recomp.recomp_parallel(4);

Back to 14 invalids.

Adop cycle
$ adop phase=prepare,cutover

Invalids: 14

> connect BOLINF/xxx
> select count(1) from apps.FND_TABLESPACES;
COUNT(1)
  *---------
9

> select edition_name from dba_objects where object_name='FND_TABLESPACES';

EDITION_NAME
  *-----------------------------

V_20150114_2127

$ adop phase=prepare,cutover

Again after an adop cycle

==== Does granting again that what was causing invalidation will create another invalidations? ====
Invalids: 14

> select edition_name from dba_objects where object_name='FND_TABLESPACES';
EDITION_NAME
  *-----------------------------
V_20150114_2127

> connect apps/apps
> grant select on FND_TABLESPACES to "BOLINF";

Invalids: 14

Conclusion -> no change

==== Picking another table to grant select, just to repeat the procedure ====
Invalids: 14

> select edition_name from dba_objects where object_name='FND_SESSIONS';
EDITION_NAME
  *-----------------------------
V_20150114_2127
V_20150114_2127

> connect BOLINF/xxx
> select count(1) from apps.FND_SESSIONS;
ORA-00942: table or view does not exist

> connect apps/apps
> exec AD_ZD.GRANT_PRIVS('SELECT','FND_SESSIONS','BOLINF');

> connect BOLINF/xxx
> select count(1) from apps.FND_SESSIONS;
COUNT(1)
  *---------
28751

Invalids: 14

> connect apps/apps
> grant select on FND_SESSIONS to "BOLINF";

Invalids: 14

==== Picking another table to grant select, just to repeat the procedure ====
Invalids: 14

> select edition_name from dba_objects where object_name='FND_TRACE_LOG';

EDITION_NAME
  *-----------------------------
ORA$BASE

> connect BOLINF/xxx
> select count(1) from apps.FND_TRACE_LOG;
ORA-00942: table or view does not exist

> connect apps/apps
> exec AD_ZD.GRANT_PRIVS('SELECT','FND_TRACE_LOG','BOLINF');

Invalids: 14

> select edition_name from dba_objects where object_name='FND_TRACE_LOG';

EDITION_NAME
  *-----------------------------
ORA$BASE


> connect BOLINF/xxx
> select count(1) from apps.FND_TRACE_LOG;
COUNT(1)
  *---------
0

> connect apps/apps
> grant select on FND_TRACE_LOG to "BOLINF";

Invalids: 14

> select edition_name from dba_objects where object_name='FND_TRACE_LOG';

EDITION_NAME
  *-----------------------------
V_20150215_0032

==== Picking another table to grant select, just to repeat the procedure ====
Invalids: 14

> select edition_name from dba_objects where object_name='FND_COLUMNS';

EDITION_NAME
  *-----------------------------
ORA$BASE

> connect BOLINF/xxx
> select count(1) from apps.FND_COLUMNS;
ORA-00942: table or view does not exist

> connect apps/apps
> exec AD_ZD.GRANT_PRIVS('SELECT','FND_COLUMNS','BOLINF');

Invalids: 14

> select edition_name from dba_objects where object_name='FND_COLUMNS';

EDITION_NAME
  *-----------------------------
ORA$BASE


> connect BOLINF/xxx
> select count(1) from apps.FND_COLUMNS;
COUNT(1)
  *---------
633831

> connect apps/apps
> grant select on FND_COLUMNS to "BOLINF";

Invalids: 14

> select edition_name from dba_objects where object_name='FND_COLUMNS';

EDITION_NAME
  *-----------------------------
V_20150215_0032

=== Giving grant explicitly to an edition ===

select edition_name from dba_objects
where owner = '<owner>'
Â Â Â  and object_name='<object_name>'
Â Â Â  and object_type='<object_type>'


select edition_name from dba_objects where object_name='FND_TABLESPACES';

EDITION_NAME
  *-----------------------------

V_20150114_2127

SQL> select edition_name from dba_objects where object_name='FND_VIEWS';

EDITION_NAME
  *-----------------------------

ORA$BASE

> grant select on FND_VIEWS to "BOLINF";

New invalids appear.

> select edition_name from dba_objects where object_name='FND_VIEWS';

EDITION_NAME
  *-----------------------------

V_20150114_2127

That is why invalidations occur. When we use explicit grant the edition of the object is created.

=== Rollback and test some other scenarius ===
Using vmware snap instead to rollback easily both app and db tiers.

==== Automate testing: ====
Pick 100 tables, 100 packages; grant select/execute. Count the invalids at every step.

select object_name from dba_objects where object_name like 'FND%' and owner = 'APPLSYS' and object_type = 'TABLE';
select object_name from dba_objects where object_name like 'FND%' and owner = 'APPS' and object_type = 'PACKAGE';

==== Test scenarius with: ====
  # adop cycle: cutover complete (no cleanup)
test_invalids_log_.2015-03-17--21:29:38 - 14 to 17 - not much few new invalids

2. adop cycle: cleanup complete
test_invalids_log_.2015-03-18--17:53:21 - 14 to 5614 - lots of invalids

3. adop cycle: prepare complete (started adop cycle)
  # invalids
$ adop phase=prepare
test_invalids_log_.2015-03-18--22:22:50 - 2921 invalids to 2925

$ adop phase=cutover
  # invalids
test_invalids_log_.2015-03-19--09:17:58 - 15 to 25

==== Test 2 scenarius with: ====
  # adop cycle: cutover complete (no cleanup)
test_invalids_log_.2015-03-23--09:49:00 - 2 invalids to 83

2. adop cycle: cleanup complete
62538 rows selected - invalids ?!

=== automated tests ad.5 ===
  # adop cycle: cutover complete (no cleanup)
$ ./test_invalids.sh b_grant_normal_tables
test_invalids_log_b_grant_normal_tables.2015-03-27--11:52:09 14 - 17 invalids
$ ./test_invalids.sh b_grant_normal_packages
test_invalids_log_b_grant_normal_packages.2015-03-27--12:24:23 17 - 33 invalids

2. adop cycle: cleanup complete (no restore)
$ adop phase=cleanup
> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/27 19:01:55	 64722

> @utlrp

> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/29 20:04:32	    14

$ ./test_invalids.sh b_grant_normal_tables
test_invalids_log_b_grant_normal_tables.2015-03-29--20:05:59 14 - 14 invalids
$ ./test_invalids.sh b_grant_normal_packages
test_invalids_log_b_grant_normal_packages.2015-03-29--20:40:36 14 - 14 invalids


3. adop cycle: prepare complete (started adop cycle)
$ adop phase=prepare
> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/29 22:14:38	    14

$ ./test_invalids.sh b_grant_normal_tables
test_invalids_log_b_grant_normal_tables.2015-03-29--22:15:03 14 - 14 invalids
$ ./test_invalids.sh b_grant_normal_packages
test_invalids_log_b_grant_normal_packages.2015-03-30--11:56:45 14 - 14 invalids

4. rollback all changes (back to snapschot)
Done - to snapschot "before_invalids_test"
$ cd scripto/
$ svn update

5. adop cycle: cleanup complete
$ adop phase=cleanup
Check how was it set under the old binaries
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/30 13:30:47	    14

6. Test
$ cd scripto/ebs/test/invalids/
$ ./test_invalids.sh b_grant_normal_tables
test_invalids_log_b_grant_normal_tables.2015-03-30--13:37:35 14 - 17 invalids
> @utlrp
!!! Something is weird !!!
The recompile for 3 invalids took: 9h ?!
2015/03/30 15:27:33
2015/03/31 00:50:46

> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/31 14:42:02	    14

$ ./test_invalids.sh b_grant_normal_packages
test_invalids_log_b_grant_normal_packages.2015-03-31--14:42:44 14 - 28321 invalids


=== automated tests ad.6 ===
  # adop cycle: cutover complete (no cleanup)
> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/31 22:56:44	  2515
> @utlrp
2015/03/31 22:57:08
2015/03/31 23:04:04 - finished in 7min !?

$ cd scripto
$ svn update
$ cd scripto/ebs/test/invalids/
$ ./test_invalids.sh b_grant_normal_tables
test_invalids_log_b_grant_normal_tables.2015-03-31--23:08:54 14 - 24 invalids
$ ./test_invalids.sh b_grant_normal_packages
test_invalids_log_b_grant_normal_packages.2015-03-31--23:27:50 24 - 40 invalids

2. adop cycle: cleanup complete (no restore)
$ adop phase=cleanup
> @vc
SYSDATE 	      COUNT(1)
  *------------------ ----------
2015/03/31 23:55:30	 64724
> @utlrp




== Hostname change on MT ==
MOS:
  * 11i: How to change the hostname of an Applications Tier using AutoConfig (Doc ID 341322.1)

  * Oracle Application Server with Oracle E-Business Suite Release 12 FAQ (Doc ID 415007.1)

  * Adding an Alias Hostname with Oracle E-Business Suite Release 12 (Doc ID 603883.1)
  *> very similar to what I have done

  * How to change the IP Address on a R12 EBusiness Suite Installation (Doc ID 554843.1)

I have conducted the following exercise, which partly looks like cloning:
  # Run preclone
2. Shutdown MT
3. Do the backup
4. Change the hostname
5. Do nothing (simulating the MT backup restore on the new hostname)
6. Perform postclone on MT

=== 1. Run preclone ===
==== Preclone APP ====
Preclone should be done on a properly running DB and APP tiers
{{{
$ source /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
Non-Editioned File System : /u01/oracle/VIS/fs_ne


DB Host: ebsdb2.remik.org  Service/SID: VIS


$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier
}}}

=== 2. Shutdown MT ===
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps
}}}

=== 3. Do the backup ===
  *> post_preclone snapschot

=== 4. Change the hostname ===
Originaly:
{{{
# uname -a
Linux ebs2.remik.org 2.6.32-300.10.1.el5uek #1 SMP Wed Feb 22 17:37:40 EST 2012 x86_64 x86_64 x86_64 GNU/Linux
}}}

{{{
# cat /etc/hosts
  #2.168.1.158 ebs2.remik.org ebs2
  #2.168.1.159 ebsdb2.remik.org ebsdb2
}}}

I will change both the hostname and IP.

After change:
{{{
# uname -a
Linux ebs2new.remik.org 2.6.32-300.10.1.el5uek #1 SMP Wed Feb 22 17:37:40 EST 2012 x86_64 x86_64 x86_64 GNU/Linux
}}}

{{{
# cat /etc/hosts
  #2.168.1.162 ebs2new.remik.org ebs2new
  #2.168.1.159 ebsdb2.remik.org ebsdb2
}}}


Add new line in /etc/hosts on DB tier

=== 5. Do nothing (simulating the backup restore on the new hostname) ===
DB is up and running. Not restored from backup.

Actually there is some cleaning to be done, which mimic what would be done during cloning.

According to Note 1383621.1 we only need
<APPL_TOP>
<COMMON_TOP>
<OracleAS Tools 10.1.2 ORACLE_HOME>

APPL_TOP   =/u01/oracle/VIS/fs2/EBSapps/appl
COMMON_TOP =/u01/oracle/VIS/fs2/EBSapps/comn
ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2

Cleaning up:
mkdir -p /u01/trash/fs2
mv /u01/oracle/VIS/fs2/FMW_Home /u01/trash/fs2
mv /u01/oracle/VIS/fs2/inst /u01/trash/fs2
mv /u01/oracle/VIS/fs1 /u01/trash
mv /u01/oracle/VIS/fs_ne /u01/trash
mv /u01/oracle/VIS/EBSapps.env /u01/trash


And we need to let the cloning to create the global inventory
{{{
$ cat /etc/oraInst.loc
inventory_loc=/u01/oraInventory
$ mv /u01/oraInventory /u01/oraInventory_`date -I`
}}}



=== 6. Perform postclone on DB ===
This step is required to cleanup the node configuration on DB. Without that the DB expects the old MT host to be present and adop fs_clone fails.

This postclone on DB somehow cleans the configuration. There should be other way to do it, but for now this works.

Perform postclone on DB

  * shutdown DB tier
!
! Only if this is the only Oracle product on this host
!
And we need to let the cloning to create the global inventory
{{{
$ cat /etc/oraInst.loc
inventory_loc=/u01/oraInventory
$ mv /u01/oraInventory /u01/oraInventory_`date -I`
}}}

{{{
$ cd /u01/oracle/VIS/11.2.0/appsutil/clone/bin
$ perl adcfgclone.pl dbTier
}}}

Target System Hostname (virtual or normal) [ebsdb4] :

Target Instance is RAC (y/n) [n] :

Target System Database SID : VIS

Target System Base Directory : /u01/oracle/VIS

Target System utl_file_dir Directory List : /tmp

Number of DATA_TOP's on the Target System [1] :

Target System DATA_TOP Directory 1 [/u01/oracle/VIS/data] :

Target System RDBMS ORACLE_HOME Directory [/u01/oracle/VIS/11.2.0] :

Do you want to preserve the Display [null] (y/n)  : y

Target System Port Pool [0-99] : 0

?? sometimes Do you want the target system to have the same port values as the source system (y/n) [y] ? :

Checking the port pool 0

Completed Apply...


=== 7. Perform postclone on MT ===

==== run postclone on RUN edition ====
If DB node is using tcp.validnode_checking disable it, or add new hostname

Login to DB node
{{{
$ cd $ORACLE_HOME/network/admin/$CONTEXT_NAME
$ vim sqlnet.ora
#tcp.validnode_checking = yes
#tcp.invited_nodes=(EBS2.remik.org, EBSDB2.remik.org)
}}}

Go to run edition on new MT perform postclone
{{{
$ cd /u01/oracle/VIS/fs2/EBSapps/comn/clone/bin  (which should be like: $ cd $COMMON_TOP/clone/bin)
$ perl adcfgclone.pl appsTier
}}}

Enter the APPS password :
Enter the Weblogic AdminServer password :
Do you want to add a node (yes/no) [no] :
Target System File Edition type [run] :

Provide the values required for creation of the new APPL_TOP Context file.

Target System Hostname (virtual or normal) [ebs2new] :

Target System Database SID : VIS

Target System Database Server Node [ebs2new] : ebsdb2

Target System Database Domain Name [remik.org] :

Target System Base Directory : /u01/oracle/VIS

Target System Base Directory set to /u01/oracle/VIS

Target System Current File System Base set to /u01/oracle/VIS/fs2

Target System Other File System Base set to /u01/oracle/VIS/fs1

Target System Fusion Middleware Home set to /u01/oracle/VIS/fs2/FMW_Home

Target System Web Oracle Home set to /u01/oracle/VIS/fs2/FMW_Home/webtier

Target System Appl TOP set to /u01/oracle/VIS/fs2/EBSapps/appl

Target System COMMON TOP set to /u01/oracle/VIS/fs2/EBSapps/comn

Target System Instance Home Directory [/u01/oracle/VIS] :

Target System Instance Top set to /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new

Do you want to preserve the Display [ebs2:0.0] (y/n)  : n

Target System Display [ebs2new:0.0] :

Target System Root Service [enabled] :

Target System Web Administration [enabled] :

Target System Web Entry Point Services [enabled] :

Target System Web Application Services [enabled] :

Target System Batch Processing Services [enabled] :

Target System Other Services [disabled] :

Do you want the target system to have the same port values as the source system (y/n) [y] ? : y
Complete port information available at /u01/oracle/VIS/fs2/EBSapps/comn/clone/bin/out/VIS_ebs2new/portpool.lst


UTL_FILE_DIR on database tier consists of the following directories.

  # /usr/tmp
2. /usr/tmp
3. /u01/oracle/VIS/11.2.0/appsutil/outbound/VIS_ebsdb2
4. /usr/tmp
Choose a value which will be set as APPLPTMP value on the target node [1] :

Creating the new APPL_TOP Context file from :
/u01/oracle/VIS/fs2/EBSapps/comn/clone/context/apps/adxmlctx.tmp

The new APPL_TOP context file has been created :
/u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml

  *---

Do you want to startup the Application Services for VIS? (y/n) [n] : n

==== Fix the issue with listener: adalnctl.sh: exiting with status 1 ====

Relogin, source the run env.
{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
File System Type          : SINGLE
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : NOT APPLICABLE
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}


DB Host: ebsdb2.remik.org  Service/SID: VIS

Check if there are some zombie app processes left
{{{
$ ps -ef | grep applmgr
}}}


{{{
$ cp /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora_`date -I`
$ vim /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora
#tcp.validnode_checking = yes
#tcp.invited_nodes = (EBS2.remik.org, EBSDB2.remik.org, EBS2NEW.remik.org)
}}}

Start the app tier.
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstrtal.sh apps/apps
}}}

==== Run adpreclone.pl on the run edition file system ====

{{{
$ source /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
File System Type          : SINGLE
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : NOT APPLICABLE
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}

{{{
$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier
}}}

==== copy from the run edition file system to the patch edition file system ====
see Maintenance cloning: copy from the run edition file system to the patch edition file system

==== logon to the patch edition file system and run postclone ====

see Maintenance cloning: logon to the patch edition file system and run postclone

==== Running fs_clone ====
Relogin, source run edition.

{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}


DB Host: ebsdb2.remik.org  Service/SID: VIS


Sourcing the RUN File System ...

{{{
$ adop phase=fs_clone
Enter the APPS password:
Enter the SYSTEM password:
Enter the WLSADMIN password:
}}}





=== troubleschooting ===
==== Exiting cloning as FMW Home already exists ====
MOS:
  * 12.2.X Rapid Clone fails with error "Exiting cloning as FMW Home already exists." (Doc ID 1900583.1)

  # According to Note 1383621.1--> step 3.2.2.2, copy following directories:

<APPL_TOP>Â 

<COMMON_TOP>

<OracleAS Tools 10.1.2 ORACLE_HOME>

2. The FMW home should not be copied.

3. And for step 3.2.3.2.3 "Copy Oracle E-Business Suite application directories from the run edition file system to the patch edition file system in the Target System", users should copy the same three directories as above. Do not copy the whole fs directory.

  *--
APPL_TOP   =/u01/oracle/VIS/fs2/EBSapps/appl
COMMON_TOP =/u01/oracle/VIS/fs2/EBSapps/comn
ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2

Cleaning up:
mkdir /u01/trash
mv /u01/oracle/VIS/fs2/FMW_Home /u01/trash
mv /u01/oracle/VIS/fs2/inst /u01/trash
mv /u01/oracle/VIS/fs1 /u01/trash
mv /u01/oracle/VIS/fs_ne /u01/trash
mv /u01/oracle/VIS/EBSapps.env /u01/trash

{{{
$ pwd
/u01/oracle/VIS
$ ls
fs2
$ cd fs2
[applmgr@ebs2new fs2]$ ls
EBSapps
$ cd EBSapps/
[applmgr@ebs2new EBSapps]$ ls
  #.1.2  appl  comn
}}}

==== Below Oracle Homes are already registered in the global inventory ====
Below Oracle Homes are already registered in the global inventory:
/u01/oracle/VIS/fs2/FMW_Home/Oracle_EBS-app1
/u01/oracle/VIS/fs2/FMW_Home/webtier
/u01/oracle/VIS/fs2/FMW_Home/oracle_common

Exiting Cloning...

Ensure that the above Oracle Homes are unregistered from the global inventory "/u01/oraInventory/ContentsXML/inventory.xml" and re-run adcfgclone.pl script

  *--
MOS:
  * Troubleshooting RapidClone issues with Oracle Applications R12 (Doc ID 603104.1)

I will let the clone to recreate global inventory

{{{
$ cat /etc/oraInst.loc
inventory_loc=/u01/oraInventory
$ mv /u01/oraInventory /u01/oraInventory_`date -I`
}}}




==== Web Administration         OracleTNSListenerAPPS_VIS_ebs2new       adalnctl.sh                Failed ====
adalnctl.sh version 120.3.12020000.2

Checking for FNDFS executable.
Starting listener process APPS_VIS.

adalnctl.sh: exiting with status 1


adalnctl.sh: check the logfile /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/logs/appl/admin/log/adalnctl.txt for more information ..
.
Connecting to (ADDRESS=(PROTOCOL=TCP)(Host=ebs2new)(Port=1626))
TNS-12541: TNS:no listener
TNS-12560: TNS:protocol adapter error
TNS-00511: No listener
Linux Error: 111: Connection refused

07/10/14-04:46:59 :: adalnctl.sh: Starting listener process APPS_VIS.
TNSLSNR for Linux: Version 10.1.0.5.0 - Production
System parameter file is /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/listener.ora
Log messages written to /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/logs/ora/10.1.2/network/apps_vis.log
Error listening on: (ADDRESS=(PROTOCOL=TCP)(Host=ebs2new)(Port=1626))
TNS-12533: TNS:illegal ADDRESS parameters
TNS-12560: TNS:protocol adapter error
TNS-00503: Illegal ADDRESS parameters

  *--

{{{
$ cp /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora_`date -I`
$ vim /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/ora/10.1.2/network/admin/sqlnet.ora
#tcp.validnode_checking = yes
#tcp.invited_nodes = (EBS2.remik.org, EBSDB2.remik.org, EBS2NEW.remik.org)
$ cd /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/admin/scripts
$ ./adalnctl.sh start
adalnctl.sh: exiting with status 0
}}}

OK, let's restart everything.

==== ERRORMSG: 'fs_clone' is not a valid phase with a single APPL_TOP ====
{{{
$ adop phase=fs_clone
=======FATAL ERROR =======
PROGRAM : (/u01/oracle/VIS/fs2/EBSapps/appl/ad/12.0.0/bin/adzdoptl.pl)
TIME    : Thu Jul 10 06:38:51 2014
FUNCTION: ADOP::GlobalVars::_ValidateArgs [ Level 1 ]
ERRORMSG: 'fs_clone' is not a valid phase with a single APPL_TOP. Valid phases are 'apply' and 'cleanup'.
}}}

adop exiting with status = 2 (Fail)

"The target <s_base> directory will be /d05/test. Copy the source run edition file system into the target /d05/test/fs2 directory to initially act as run edition file system, and into the target /d05/test/fs1 to act as patch edition file system."

So based on source run edition we should create both target run and patch editions.

What if I jus copy from target run to target patch?
{{{
$ mkdir /u01/oracle/VIS/fs1
$ cp -RH /u01/oracle/VIS/fs2/EBSapps /u01/oracle/VIS/fs1
}}}

{{{
$ adop phase=fs_clone
(...)
ERROR: Specified context file not found.
}}}

PATCH file system context file: /u01/oracle/VIS/fs1/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml

(...)

{{{
$ cd /u01/oracle/VIS
$ mv fs1 fs1_copy_from_fs2
$ mv /u01/trash/fs1 .
}}}

But I somehow do not like it.

I repeated everything, leaving fs1 with only EBSapps. Same error.
{{{
$ adop phase=fs_clone
}}}

PATCH file system context file: /u01/oracle/VIS/fs1/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml
ERROR: Specified context file not found.

{{{
$ ls -l /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml
  *rw-r--r-- 1 applmgr oinstall 117487 Jul 10 16:46 /u01/oracle/VIS/fs2/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml
$ ls /u01/oracle/VIS/fs1/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml
ls: /u01/oracle/VIS/fs1/inst/apps/VIS_ebs2new/appl/admin/VIS_ebs2new.xml: No such file or directory
}}}

What if I do:

{{{
$ cp -RH /u01/oracle/VIS/fs2/inst /u01/oracle/VIS/fs1
}}}

Still errors.

Next try:
  * copy run edition to patch edition.
  * make sure which is run edition
  * confirm cd <COMMON_TOP>/clone/bin

  *> you are doing this wrong.
According to: Cloning Oracle E-Business Suite Release 12.2 with Rapid Clone (Doc ID 1383621.1)

Section 3: Standard Cloning Tasks
3.2 Standard Cloning Steps
3. Configure the Target System

  * run post clone on run edition
  * run preclone on run edition
  * copy run to patch edition
  * run post clone on patch edition


==== Current node ebs2new does not contain admin server ====
{{{
$ adop phase=fs_clone
ERRORMSG: Not enough space available on the disk to proceed. Minimum free space required (in GB): 40
}}}

[ERROR]     Current node ebs2new does not contain admin server.

[ERROR]     Current node ebs2new does not contain admin server.

[UNEXPECTED]fs_clone phase completed with errors/warnings. Please check logfiles
Log file: /u01/oracle/VIS/fs_ne/EBSapps/log/adop/6/adop_20140712_072059.log

===== Shutdown everything, kill zombies and try again: =====
Make sure, there is at least 40G free

{{{
$ adop phase=fs_clone
}}}

no luck.

===== trying on new host ebs4 =====

<Jul 14, 2014 2:50:38 PM CEST> <Info> <J2EE Deployment SPI> <BEA-260121> <Initiating update operation for application, forms-c4ws#1.0.0 [archive: null], to forms-c4ws_cluster1 .>
.Completed the update of Application with status completed
Current Status of your Deployment:
Deployment command type: update
Deployment State       : completed
Deployment Message     : [Deployer:149034]An exception occurred for task [Deployer:149026]update application forms-c4ws [Version=1.0.0] on forms-c4ws_cluster1.: .
Updating Application forms with deployment plan /u01/oracle/VIS/fs1/FMW_Home/Oracle_EBS-app1/deployment_plans/forms/plan.xml
Redeploying application forms ...
<Jul 14, 2014 2:50:43 PM CEST> <Info> <J2EE Deployment SPI> <BEA-260121> <Initiating redeploy operation for application, forms#1.0.0 [archive: null], to forms_cluster1 .>
.Completed the redeployment of Application with status completed
Current Status of your Deployment:
Deployment command type: redeploy
Deployment State       : completed
Deployment Message     : [Deployer:149034]An exception occurred for task [Deployer:149026]redeploy application forms [Version=1.0.0] on forms_cluster1.: .
Set JNDI name for data sourceEBSDataSource
=======================================

Connecting Source AdminServer
=============================
Connecting to t3://null.null:null with userid weblogic ...
This Exception occurred at Mon Jul 14 14:50:46 CEST 2014.
javax.naming.ServiceUnavailableException [Root exception is java.net.UnknownHostException: null.null]
Error while connecting Admin Server !!!

Script Executed in 59685 milliseconds, returning status 1
ERROR: Failed to execute /u01/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/adPostDomainCloneCfg.pl
Inside exitClone....

  *--
Main:

[UNEXPECTED]Error occurred while executing "perl /u01/oracle/VIS/fs2/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPPreparePhaseSynchronize.pl -contextfile=/u01/oracle/VIS/fs2/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml -patchcontextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml -promptmsg=hide -console=off -mode=create -sessionid=7 -timestamp=20140714_114713 -outdir=/u01/oracle/VIS/fs_ne/EBSapps/log/adop/7/fs_clone_20140714_114713/VIS_sun4"
[UNEXPECTED]Error occurred while CLONE Patch File System from Run File System using command: "perl /u01/oracle/VIS/fs2/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPPreparePhaseSynchronize.pl -contextfile=/u01/oracle/VIS/fs2/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml -patchcontextfile=/u01/oracle/VIS/fs1/inst/apps/VIS_sun4/appl/admin/VIS_sun4.xml -promptmsg=hide -console=off -mode=create -sessionid=7 -timestamp=20140714_114713 -outdir=/u01/oracle/VIS/fs_ne/EBSapps/log/adop/7/fs_clone_20140714_114713/VIS_sun4".
[ERROR]     Current node sun4 does not contain admin server.

[ERROR]     Current node sun4 does not contain admin server.

[UNEXPECTED]fs_clone phase completed with errors/warnings. Please check logfiles
Log file: /u01/oracle/VIS/fs_ne/EBSapps/log/adop/7/adop_20140714_114713.log

adop exiting with status = 2 (Fail)

  *--

{{{
> lets run the admin server?
}}}

Starting the APP

Repeating, hm jak zapuscilem raz jeszcze to mi sie wywalil ze musi miec 40G miejsca, moze to o to chodzi?

AC-10006: Exception - java.io.FileNotFoundException: /u01/oracle/VIS/fs2/inst/apps/VIS_ebs4/appl/admin/VIS_ebs4.xml (No such file or directory) thrown while creating OAVars object for file: /u01/oracle/VIS/fs2/inst/apps/VIS_ebs4/appl/admin/VIS_ebs4.xml

on caly czas jakims cudem znajduje ebs4, jak juz jest sun4. Moze to przez to, ze baza nie jest ruszana?

===== WIP zrob z klonem na DB, pomimo tego ze nic sie z nim nie dzieje =====

Perform postclone on DB

  * shutdown DB tier
!
! Only if this is the only Oracle product on this host
!
And we need to let the cloning to create the global inventory
{{{
$ cat /etc/oraInst.loc
inventory_loc=/u01/oraInventory
$ mv /u01/oraInventory /u01/oraInventory_`date -I`
}}}

{{{
$ cd /u01/oracle/VIS/11.2.0/appsutil/clone/bin
$ perl adcfgclone.pl dbTier
}}}

Target System Hostname (virtual or normal) [ebsdb4] :

Target Instance is RAC (y/n) [n] :

Target System Database SID : VIS

Target System Base Directory : /u01/oracle/VIS

Target System utl_file_dir Directory List : /tmp

Number of DATA_TOP's on the Target System [1] :

Target System DATA_TOP Directory 1 [/u01/oracle/VIS/data] :

Target System RDBMS ORACLE_HOME Directory [/u01/oracle/VIS/11.2.0] :

Do you want to preserve the Display [null] (y/n)  : y

Target System Port Pool [0-99] : 0

?? sometimes Do you want the target system to have the same port values as the source system (y/n) [y] ? :

Checking the port pool 0

Completed Apply...

Now, back to old procedure.

adop exiting with status = 0 (Success)

YES THAT WAS THAT!!!!







==== RC-50208: Exception  in method TimedProcessProcess.run pasteBinary.sh": error=2, No such file or directory ====

During postclone after changing hostname:
Running /u01/oracle/VIS/fs2/EBSapps/comn/clone/FMW/pasteBinary.sh -javaHome /u01/oracle/VIS/fs2/EBSapps/comn/util/jdk64 -al /u01/oracle/VIS/fs2/EBSapps/comn/clone/FMW/FMW_Home.jar -tl /u01/oracle/VIS/fs2/FMW_Home -invPtrLoc /etc/oraInst.loc -ldl /u01/oracle/VIS/fs2/inst/apps/VIS_sun4/admin/log/clone/fmwT2PApply -silent true -executeSysPrereqs false
RC-50208: Exception  in method TimedProcessProcess.run
Raised by oracle.apps.ad.util.TimedProcess$TimedProcessProcess: java.io.IOException: Cannot run program "/u01/oracle/VIS/fs2/EBSapps/comn/clone/FMW/pasteBinary.sh": error=2, No such file or directory
Script Executed in 100 milliseconds, returning status -1
Script timed out.

MOS:
  * RC-50208 Error results After Cloning R12.2.3 (Doc ID 1904408.1)

To implement the solution, please execute the following steps:

  # Copy FMW_Home.jar file from the source to the target.
2. Execute the pre-clone command again.

But here it has happened during postclone.
{{{
$ cd /u01/oracle/VIS/fs2/EBSapps/comn/clone
$ find ./ | grep -i FMW_Home.jar
  *> nothing.
}}}

I will revert to snapschot and rerun the preclone.

{{{
$ cd /u01/oracle/VIS/fs2/EBSapps/comn/clone
$ find ./ | grep -i FMW_Home.jar
./FMW/FMW_Home.jar
}}}

  *> The only change is that before there was fs_sync run performed. So it looks like fs_sync has deleted my FMW_Home.jar!!! Potential bug.




==== Wrong Weblogic password ====
I do not know why he does not accept my WLS password.
Trying to rest it:
  * How To Change or Reset The WebLogic Administration Password In 12.2 E-Business Suite (Doc ID 1385751.1)
  *> no use
http://oracle-magician.blogspot.com/2010/12/changing-weblogic-admin-password.html

{{{
$ . /u01/oracle/VIS/fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/bin/setDomainEnv.sh
$ java -cp /u01/oracle/VIS/fs2/FMW_Home/wlserver_10.3/server/lib/weblogic.jar:$CLASSPATH weblogic.security.utils.AdminAccount weblogic mypass1 .
$ java weblogic.security.utils.AdminAccount weblogic mypass1 .
}}}

  *> no luck, still reports invalid password

That is the probable cause.

DO NOT RUN THE PRECLONE WITH ONLY DB TIER RUNNING ON DB.



=== check [50%] ===
  * [ ] read it: Configuring Applications Node Services in Oracle E-Business Suite Release 12 (Doc ID 406558.1)
  * [X] try to do standard cloning to another host
it works! along the way with fs_sync
  * [X] if $COMMON_TOP/clone/bin = /u01/oracle/VIS/fs2/EBSapps/comn/clone/bin


== Which WLS is active now? ==
Only one should be activ, but I check.

=== How to check the port pool? ===
http://blog.csdn.net/pan_tian/article/details/8710654

  # How to check used ports in oracle application system
Navigation: System Administrator ->Â  Oracle Application Manager - > Dashboard -> click the link of the apps server in the HOST column -> On the page Oracle Applications Hosts: <your_hostname>, click the "View configuration" button.

???? but I do not find port 7003, under which the WLS admin console is running.

2. There is file portpool.lst
/u01/oracle/VIS/fs1/EBSapps/comn/adopclone_sun4/bin/out/VIS_sun4/portpool.lst

WLS Admin Server Port  :  7002 ?? but mine is running on 7003


=== checking when fs1 is run ===
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl

http://sun4.remik.org:8000 - EBS login page

http://sun4.remik.org:7003/console - WLS admin console
username: weblogic

NameÂ 	ClusterÂ 	MachineÂ 	StateÂ 	HealthÂ 	Listen PortÂ 
AdminServer(admin)		sun4	RUNNING	Â OK	7003
forms-c4ws_server1	forms-c4ws_cluster1	sun4	RUNNING	Â OK	7803
forms_server1	forms_cluster1	sun4	RUNNING	Â OK	7403
oacore_server1	oacore_cluster1	sun4	RUNNING	Â OK	7203
oafm_server1	oafm_cluster1	sun4	RUNNING	Â OK	7603

?? why this 7003, should be rather 7002

{{{
$ ps -ef | grep weblogic | grep -i admin
applmgr   7177  4499  3 09:34 ?        00:02:17 /u01/oracle/VIS/fs1/EBSapps/comn/util/jdk64/bin/java -Dweblogic.Name=oafm_server1 -Djava.security.policy=null -Djava.library.path=/u01/oracle/VIS/fs1/FMW_Home/patch_wls1036/profiles/default/native:/u01/oracle/VIS/fs1/EBSapps/comn/util/jdk32/jre/lib/i386/server:
}}}

  *> so I can see that WLS is running from fs1

http://sun4.remik.org:8000 - main page, yes
http://sun4.remik.org:7002/console - no
http://sun4.remik.org:7003/console - yes

=== ok, now lets do the adop cycle and reverse the fs ===

{{{
$ adop phase=prepare
$ adop phase=cutover
}}}

=== checking when fs2 is run ===

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
Non-Editioned File System : /u01/oracle/VIS/fs_ne

http://sun4.remik.org:8000 - main page, yes
http://sun4.remik.org:7002/console - yes
http://sun4.remik.org:7003/console - no

=== start WLS on the patch fs ===
{{{
$ . /u01/oracle/VIS/EBSapps.env patch
$ cd $ADMIN_SCRIPTS_HOME
$ pwd
/u01/oracle/VIS/fs1/inst/apps/VIS_sun4/admin/scripts
$ ./adadminsrvctl.sh status
The AdminServer is not running
$ ./adadminsrvctl.sh start

Starting from some patch level
$ ./adadminsrvctl.sh start forcepatchfs
}}}


http://sun4.remik.org:8000 - main page, yes
http://sun4.remik.org:7002/console - yes
http://sun4.remik.org:7003/console - yes


== Implementing customisations ==
MOS:
  * Base on Creating a Custom Application in Oracle E-Business Suite Release 12.2 (Doc ID 1577707.1)
  * Developing and Deploying Customizations in Oracle E-Business Suite Release 12.2 (Doc ID 1577661.1)

Following: Base on Creating a Custom Application in Oracle E-Business Suite Release 12.2 (Doc ID 1577707.1)

Section 1: Create A Custom Application Using adsplice

=== a. Download Patch 3636980 "Support Diagnostics (IZU) patch for AD Splice" from My Oracle Support. ===
{{{
$ cd /u01/trash
}}}

Support Diagnostics (IZU) patch for AD Splice (Patch)
p3636980_R12_GENERIC.zip	12.7 KB	(13049 bytes) MD5	A8F9E77BE395F018D8EF0650A1019FBD
{{{
$ md5sum p3636980_R12_GENERIC.zip
a8f9e77be395f018d8ef0650a1019fbd  p3636980_R12_GENERIC.zip
$ unzip p3636980_R12_GENERIC.zip
}}}

=== b. Manually copy the three .txt files from the 3636980izuadmin directory to your own temporary directory. ===

{{{
$ cd $APPL_TOP/admin
$ pwd
/u01/oracle/VIS/fs2/EBSapps/appl/admin
}}}

{{{
$ ls -l /u01/trash/3636980/izu/admin/*.txt
  *rwxr-xr-x 1 applmgr oinstall 4966 Jan  1  2002 /u01/trash/3636980/izu/admin/izuprod.txt
  *rwxr-xr-x 1 applmgr oinstall 2889 Jan  1  2002 /u01/trash/3636980/izu/admin/izuterr.txt
  *rwxr-xr-x 1 applmgr oinstall  365 Jan  1  2002 /u01/trash/3636980/izu/admin/newprods.txt
}}}

{{{
$ cp -i /u01/trash/3636980/izu/admin/*.txt .
}}}

=== c. Rename izuprod.txt to <CUSTOM MODULE>prod.txt. In this example, we will be using "xxmzprod.txt". ===

{{{
$ cp -i izuprod.txt remikprod.txt
}}}

=== d. Rename izterr.txt to <CUSTOM MODULE>terr.txt. In this example, we will be using "xxmzterr.txt". ===

{{{
$ cp -i izuterr.txt remikterr.txt
}}}

=== e. Open newprods.txt in a text editor. ===
{{{
$ cp -i newprods.txt newprods.txt_`date -I`
}}}

i) Change all references of "izu" to <custom module> and all references of "IZU" to <CUSTOM MODULE> (i.e. keep the case sensitivity).

{{{
$ vi newprods.txt
:%s/izu/remik/g
:%s/IZU/REMIK/g
}}}


ii) Modify any other values as appropriate.
To avoid work I use existing TBS
{{{
$ cat newprods.txt
product=remik
base_product_top=*APPL_TOP*
oracle_schema=remik
sizing_factor=100
main_tspace=APPS_TS_TX_DATA
index_tspace=APPS_TS_TX_IDX
temp_tspace=TEMP
default_tspace=APPS_TS_TX_DATA
}}}

=== f) Open xxmzprod.txt in a text editor. ===
i) Change all references of "izu" to <custom module> and all references of "IZU" to <CUSTOM MODULE> (keeping the case sensitivity).

{{{
$ vi remikprod.txt
:%s/izu/remik/g
:%s/IZU/REMIK/g
}}}


ii) Change all references to prodid 278 to your own unique number.

I pick 50001

Check the free number
connect apps/apps
{{{
> select decode(count ,0, 'Selected number is Available', 'Selected number already in use') Status, &&enter_custom_applID selected_number
from
(
select count(*) as count from
(
select 'x' from fnd_oracle_userid
where oracle_id= &&enter_custom_applID
union
select 'x' from fnd_application
where application_id= &&enter_custom_applID
)
);
}}}

STATUS			       SELECTED_NUMBER
  *----------------------------- ---------------
Selected number is Available		 50001

{{{
$ vi remikprod.txt
:%s/278/50001/g
}}}

=== g) Open xxmzterr.txt in a text editor. ===
i) Change all references of "izu" to <custom module> and all references of "IZU" to <CUSTOM MODULE> (keeping the case sensitivity)

{{{
$ vi remikterr.txt
:%s/izu/remik/g
:%s/IZU/REMIK/g
}}}

ii) Change the text "Oracle_Support_Diagnostic_Tools" to be "xxmz_custom_app".
{{{
$ vi remikterr.txt
:%s/Oracle_Support_Diagnostic_Tools/remik_custom_app/g
}}}

=== h. Copy the following text files to the $APPL_TOP/admin directory ===
Done already.

=== i. Change directory to the admin directory under $APPL_TOP ===
{{{
$ cd $APPL_TOP/admin
}}}

=== j. Run adsplice ===

{{{
$ adsplice
AD Splicer is complete.
}}}

Directory will be /u01/oracle/VIS/fs2/EBSapps/appl/remik/12.0.0

=== Checks ===
Statemenst should return one row

connect apps/apps
select * from fnd_application where application_short_name = 'REMIK';
select * from fnd_product_installations where APPLICATION_ID = 50001;
select * from dba_users where username = 'REMIK';

connect remik/remik

Relogin
{{{
$ env | grep -i remik | grep -i top
REMIK_TOP=/u01/oracle/VIS/fs2/EBSapps/appl/remik/12.0.0
}}}

{{{
$ ls $REMIK_TOP
admin  log  mesg  out  sql
}}}

=== Other app tier ===
If shared filesystem just run autoconfig.

=== Propagate Changes to Other File System ===

This was all done on the run filesystem. When you start the next online patching cycle, the prepare phase will run adsplice sync-up actions to synchronize the two file systems.


== Implementing customisations 2 ==
MOS:
  * Developing and Deploying Customizations in Oracle E-Business Suite Release 12.2 (Doc ID 1577661.1)

=== no thinking approach ===

Let's just do it:

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl

{{{
$ cd $JAVA_TOP
$ pwd
/u01/oracle/VIS/fs2/EBSapps/comn/java/classes
}}}

Simulating placing an new jar file
{{{
$ cp /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/glgcs.jar /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
$ ls -l $JAVA_TOP/oracle/apps/gl/jar/remi.jar
  *rw-r--r-- 1 applmgr oinstall 65646 Sep 23 16:34 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
}}}

{{{
$ ls -l /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
  *rw-r--r-- 1 applmgr oinstall 65646 Sep 23 16:34 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
}}}

{{{
$ ls -l /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
No such file or directory
}}}

So, we place some new files on run filesystem, use it... then it comes a time to do some patching.


Simulate adop cycle
{{{
$ adop phase=prepare,cutover
adop exiting with status = 0 (Success)
}}}

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl

{{{
$ ls -l $JAVA_TOP/oracle/apps/gl/jar/remi.jar
ls: /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar: No such file or directory
}}}

  *> so, the run filesystem does not contain the file.

{{{
$ ls -l /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
  *rw-r--r-- 1 applmgr oinstall 65646 Sep 23 16:34 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
}}}

{{{
$ ls -l /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/oracle/apps/gl/jar/remi.jar
No such file or directory
}}}

  *> it is where it was, nothing has changed.

This is what can cause the customisations to work one day and not after the adop patching.


=== think before you do approach ===
Setup new test
{{{
$ echo "ala ma kota" > $JAVA_TOP/customall.jar
$ ls -l $JAVA_TOP/customall.jar
  *rw-r--r-- 1 applmgr oinstall 12 Sep 23 20:15 /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall.jar
}}}

Go through MOS
  * Developing and Deploying Customizations in Oracle E-Business Suite Release 12.2 (Doc ID 1577661.1)

{{{
$ ls -l $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv
/u01/oracle/VIS/fs_ne/EBSapps/appl/ad/custom/adop_sync.drv
}}}

{{{
$ cp $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv_`date -I`
$ less $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv
The actions would be performed during ADOP synchronization phase.
# | Custom synchronization which is called during PREPARE phase of ADOP will use
# | values from RUN context file.
# | All the custom commands used in this driver should have PATHs relative to
# | s_current_base and s_other_base ONLY.
# | -----------------------------------------------------------------------------
}}}

{{{
$ vi $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv
#Begin Customization
}}}

rsync -zr %s_current_base%/EBSapps/comn/java/classes/customall.jar %s_other_base%/EBSapps/comn/java/classes

{{{
#Copy Starts
}}}

Check the files you want to synch
{{{
$ ls $RUN_BASE/EBSapps/comn/java/classes/customall.jar
/u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall.jar
}}}

Do we have rsync?
{{{
$ which rsync
/usr/bin/rsync
}}}

Lets try this rsync command. We can substitute (just for test)
%s_current_base% - $RUN_BASE
%s_other_base%   - $PATCH_BASE

{{{
$ echo "ala ma kota2" > $JAVA_TOP/customall2.jar
$ ls $JAVA_TOP/customall2.jar
/u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall2.jar
$ rsync -zr $RUN_BASE/EBSapps/comn/java/classes/customall2.jar $PATCH_BASE/EBSapps/comn/java/classes
$ ls $RUN_BASE/EBSapps/comn/java/classes/customall2.jar
/u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall2.jar
$ ls $PATCH_BASE/EBSapps/comn/java/classes/customall2.jar
/u01/oracle/VIS/fs2/EBSapps/comn/java/classes/customall2.jar
  *> so this is working fine
}}}

Now the adop cycle
{{{
$ adop phase=prepare,cutover
}}}

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl


Is there somewhere the log file from this rsync?
Yes, check the adop logs
/u01/oracle/VIS/fs_ne/EBSapps/log/adop/10/prepare_20140923_202455/VIS_sun4/TXK_SYNC_update_Tue_Sep_23_20_28_24_2014/txkADOPCustomSyncUp.log

Checking if the rsync has copied the $JAVA_TOP/customall.jar
{{{
$ ls -l $JAVA_TOP/customall.jar
  *rw-r--r-- 1 applmgr oinstall 12 Sep 23 20:29 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/customall.jar
}}}

And the now patch edition:
{{{
$ ls -l /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall.jar
  *rw-r--r-- 1 applmgr oinstall 12 Sep 23 20:15 /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/customall.jar
}}}

  *> OK, so all is correctly copied.

==== sync the whole directories ====

{{{
$ cd $JAVA_TOP
$ pwd
/u01/oracle/VIS/fs2/EBSapps/comn/java/classes
# just a sample directory structure
$ cp -r /home/applmgr/scripto .
}}}

{{{
$ ls -ld $RUN_BASE/EBSapps/comn/java/classes/scripto
drwxr-xr-x 12 applmgr oinstall 4096 Sep 24 10:06 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/scripto
}}}

{{{
$ ls -ld $PATCH_BASE/EBSapps/comn/java/classes/scripto
No such file or directory
}}}

{{{
$ vi $NE_BASE/EBSapps/appl/ad/custom/adop_sync.drv
#Begin Customization
}}}

rsync -zr %s_current_base%/EBSapps/comn/java/classes/scripto %s_other_base%/EBSapps/comn/java/classes

{{{
#Copy Starts
}}}

Now the adop cycle
{{{
$ adop phase=prepare,cutover
}}}

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl


It is on both fs now.
{{{
$ ls -ld $RUN_BASE/EBSapps/comn/java/classes/scripto
drwxr-xr-x 12 applmgr oinstall 4096 Sep 24 10:14 /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/scripto
}}}

{{{
$ ls -ld $PATCH_BASE/EBSapps/comn/java/classes/scripto
drwxr-xr-x 12 applmgr oinstall 4096 Sep 24 10:06 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/scripto
}}}

What is worth noticing is that the rsync is happening during the prepare adop phase (is it because the prepare is implicitly running the fs_clone if it was not previously run?).

=== checking if the sync is happening in prepare phase because of implicit fs_sync ===

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl

{{{
$ cd $JAVA_TOP
$ pwd
/u01/oracle/VIS/fs2/EBSapps/comn/java/classes
# just a sample directory structure
$ cp -r scripto dziobak
}}}

{{{
$ ls -ld $RUN_BASE/EBSapps/comn/java/classes/dziobak
drwxr-xr-x 12 applmgr oinstall 4096 Sep 27 19:25 /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/dziobak
}}}

{{{
$ ls -ld $PATCH_BASE/EBSapps/comn/java/classes/dziobak
No such file or directory
}}}

{{{
$ adop phase=fs_clone
$ ls -ld $RUN_BASE/EBSapps/comn/java/classes/dziobak
drwxr-xr-x 12 applmgr oinstall 4096 Sep 27 19:25 /u01/oracle/VIS/fs1/EBSapps/comn/java/classes/dziobak
}}}

{{{
$ ls -ld $PATCH_BASE/EBSapps/comn/java/classes/dziobak
drwxr-xr-x 12 applmgr oinstall 4096 Sep 27 20:06 /u01/oracle/VIS/fs2/EBSapps/comn/java/classes/dziobak
}}}

  *> so he did it during fs_clone






=== ToDo [100%] ===
  * [X] where is the log file
  * [X] check rsync directories


== Changing apache configuration ==
=== LockFile directive ===
In 11i this type of httpd.conf changes was done through context_file or templates. How is it in R12?

Let's say that we want to make the following change.

The "LockFile" directive in the Apache HTTP server configuration file <FMW HOME>/webtier/instances/<Instance  Name>/config/OHS/EBS_web_<SID>/httpd.conf should be set to "/var/opt/VIS_sun4/Apache/logs/httpd.lock".

==== Lets do it the wrong way to make sure that the httpd.conf is still recreated during the autoconfig ====

{{{
$ ls -l $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/config/OHS/EBS_web_${TWO_TASK}/httpd.conf
  *rw------- 1 applmgr oinstall 37767 Sep 23 16:52 /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
}}}

{{{
$ md5sum httpd.conf
9723fd1d82a216109b0940d7a5d77d8e  httpd.conf
$ cp httpd.conf httpd.conf_`date -I`
$ vim httpd.conf
$ diff httpd.conf httpd.conf_`date -I`
45,46d44
< LockFile "/var/opt/VIS_sun4/Apache/logs/httpd.lock"
<
  #9c157
<         #LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
  *--
>         LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
  #9c177
<         #LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
  *--
>         LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
}}}

{{{
$ md5sum httpd.conf
7357ce83e63c998ef9fa246afb17e291  httpd.conf
}}}


Restart apache
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adapcctl.sh stop
}}}

Does not want to start,
{{{
$ ./adapcctl.sh start
}}}

{{{
$ less /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/diagnostics/logs/OHS/EBS_web_VIS/EBS_web_VIS.log
[2014-10-02T15:31:45.1383+02:00] [OHS] [INCIDENT_ERROR:10] [OHS-9999] [core.c] [host_id: sun4.remik.org] [host_addr: 192.168.1.165] [pid: 25213] [tid: 140692010362672] [user: applmgr] [VirtualHost: main] (2)No such file or directory:  Couldn't create accept lock
}}}

So he needs probably the dir path
{{{
$ cd /var/opt
$ touch ala
touch: cannot touch `ala': Permission denied
$ ls -ld .
drwxr-xr-x 2 root root 4096 Feb 17  2010 .
}}}

Not nice, but I just want to make sure if he is able to create the dir path
{{{
# chmod 777 opt/
}}}

No, he is not.
{{{
$ mkdir -p /var/opt/VIS_sun4/Apache/logs/httpd.lock
}}}

OK, now it works
{{{
$ ./adapcctl.sh start
adapcctl.sh: exiting with status 0
}}}

So now the autoconfig.
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adautocfg.sh
}}}

Hm, weird. untouched.
{{{
$ md5sum httpd.conf
7357ce83e63c998ef9fa246afb17e291  httpd.conf
}}}

===== Ok, lets try the adop patching cycle. =====
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl


{{{
$ ls -l $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/config/OHS/EBS_web_${TWO_TASK}/httpd.conf
  *rw------- 1 applmgr oinstall 37767 Sep 23 16:52 /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
}}}

{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
7357ce83e63c998ef9fa246afb17e291
$ grep LockFile /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
LockFile "/var/opt/VIS_sun4/Apache/logs/httpd.lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/accept.lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
}}}



{{{
$ md5sum /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
9b3613202576eab096a504feb993e690
$ grep LockFile /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/accept.lock"
LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
}}}

{{{
$ adop phase=prepare,cutover
}}}

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl


{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
7357ce83e63c998ef9fa246afb17e291
  *> this is the same
}}}

{{{
$ md5sum /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
453c95eebaaec400c91bf69010326eae
  *> this is new, why?
}}}

Looks like he did all the changes during the adop cycle
{{{
$ grep LockFile /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
LockFile "/var/opt/VIS_sun4/Apache/logs/httpd.lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/accept.lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
#LockFile "${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/http_lock"
}}}

Let's see what is in logs
{{{
$ cd $APPL_TOP_NE/../log/adop
$ cd 13 # my last adop session number
$ grep -R httpd.conf *
Comparing /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf with /u01/oracle/VIS/fs1/inst/apps/VIS_sun4/appl/admin/cutover/OHS/EBS_web_VIS/httpd.conf
HTTP Configuration change detected..
}}}

So he knows... :)

So looks like during the adop cycle he synchronised the httpd.conf file from RUN filesystem to PATCH filesystem, which is rather unusuall.

Just a stupid test to see if the synchronisation is done like this:
  # See if the httpd.conf has been changed, if yes go to 2.
2. replace fs2/fs1 or other way around

{{{
$ cat /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf | sed s/fs2/fs1/g > /tmp/ala.txt
$ md5sum /tmp/ala.txt
7357ce83e63c998ef9fa246afb17e291  /tmp/ala.txt
}}}

And this md5sum is exactly how
{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
7357ce83e63c998ef9fa246afb17e291
}}}

So here is the magic :)



==== Trying to approach the issue with 11i way where you were messing with templates ====

I believe I read somewhere that you do not manage the changes to apache through teplate any more.

And it turns out true. The httpd.conf header:

{{{
# This template is used to seed the initial httpd.conf. After that, AutoConfig does not manage httpd.conf changes.
# It is advisable to perform OHS configuration changes through EM console.
# The default EM console URL is  http://ebs2.remik.org:7001/em
}}}

Trying EM for Oracle Fusion Middleware Control
http://sun4.remik.org:7003/em
Username: weblogic


How to see the template anyway?
{{{
$AD_TOP/bin/adtmplreport.sh contextfile=$CONTEXT_FILE target=/u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
[ FILE NOT FOUND ]
AC-20029: Error: Cannot process the specified Target file - /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
Raised by oracle.apps.ad.tools.configuration.ATTemplateReport
}}}

So it does not work with httpd.conf any more. But works with other files that are still managed by the template, like trusted.conf

{{{
$ $AD_TOP/bin/adtmplreport.sh contextfile=$CONTEXT_FILE target=/u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/trusted.conf
[FND_TOP]
TEMPLATE FILE   : /u01/oracle/VIS/fs1/EBSapps/appl/fnd/12.0.0/admin/template/trusted_conf_FMW.tmp
TARGET FILE     : /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/trusted.conf
}}}


So this note:

MOS:
  * R12: How to Modify an iAS Configuration File? (Doc ID 1483137.1)

is actually wrong in R12.

Conclusion -> this approach does not work.

==== Trying to change the httpd.conf using the approach to eg patch the WLS - first on the patch FS ====

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl

{{{
$ md5sum /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
453c95eebaaec400c91bf69010326eae
}}}

{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
7357ce83e63c998ef9fa246afb17e291
}}}

Starting adop cycle
{{{
$ adop phase=prepare
}}}

Nothing yet in the logs:
{{{
$ less prepare_20141003_105524/VIS_sun4/adConfigChanges.log
Comparing /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf with /u01/oracle/VIS/fs2/inst/apps/VIS_sun4/appl/admin/cutover/OHS/EBS_web_VIS/httpd.conf
  *> no change detected, because there is none (except the fs1/fs2 which this compare handles)
}}}

Changing something on the PATCH filesystem
{{{
$ vim /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
change
Timeout 300
to
Timeout 4000
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
8ecfea7aec95e828243f0025b0dd9d6a
}}}

Now finishing the adop cycle
{{{
$ adop phase=cutover
}}}

E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl


{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
8ecfea7aec95e828243f0025b0dd9d6a
  *> not changed
Timeout 4000
}}}

{{{
$ md5sum /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
453c95eebaaec400c91bf69010326eae
  *> not changed
Timeout 300
}}}

So we have a difference between the two, and one that does not come only from fs1/fs2 string difference.

OK, lets see what will happen if I start fs_clone
{{{
$ adop phase=fs_clone
}}}

{{{
$ md5sum /u01/oracle/VIS/fs1/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
8ecfea7aec95e828243f0025b0dd9d6a
Timeout 4000
}}}

{{{
$ md5sum /u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OHS/EBS_web_VIS/httpd.conf
f9acfa587035de9dd5cb481a824bc8f7
  *> changed
Timeout 4000
}}}

Concusion -> this approach is valid, as fs_clone would be called during next prepare phase if not called here explicitly (this could be tested thou)


=== rotation of the Apache error_log ===
How does the log dir look now?
{{{
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/diagnostics/logs/OHS/EBS_web_${TWO_TASK}
there is only access_log
}}}

Probably configured with this entry in httpd.conf
CustomLog "|${ORACLE_HOME}/ohs/bin/odl_rotatelogs ${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/access_log 43200" common

{{{
$ vi $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/config/OHS/EBS_web_${TWO_TASK}/httpd.conf
ErrorLog "|${ORACLE_HOME}/ohs/bin/rotatelogs ${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/error_log 86400"
}}}

Apache bounce
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adapcctl.sh stop
$ ./adapcctl.sh start
}}}




  *---
done at 11.5.10

ErrorLog "|/dbtc1i/product/iAS/Apache/Apache/bin/rotatelogs /dbtc1i/product/DBTC1I_vmohsbtcp040/iAS/Apache/Apache/logs/error_log 86400"

LogLevel warn


TransferLog "|/dbtc1i/product/iAS/Apache/Apache/bin/rotatelogs /dbtc1i/product/DBTC1I_vmohsbtcp040/iAS/Apache/Apache/logs/access_log 86400"

{{{
# Logging mode is set to odl-text mode by default.
# If you wish to use the apache type log instead then uncomment the
# ErrorLog and LogLevel lines below and set OraLogMode to apache
#
}}}

  *> yes, this is it.

http://docs.oracle.com/cd/E23943_01/web.1111/e10144/man_logs.htm


== Does it bother MT if the listener on DB tier is down for a while? ==
http://sun4.remik.org:8000

Ok, I have opened the forms.

Now I will just shutdown the DB listener.
{{{
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./addlnctl.sh stop $ORACLE_SID
}}}

Forms are working fine in the session that was already open.

Trying to login again:
  * left navigation is missing
  * Error message: You have encountered an unexpected error

Starting the listener
{{{
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./addlnctl.sh start $ORACLE_SID
}}}

Just starting the listener again makes it all work fine.

Conslusion:
  * do not try to shutdown listener, new users will not be able to connect
  * if you did, just start it again, no need to restart the whole stack


== DBCA fails Can not Connect to Database/Instance in Multiple Listener Environment ==
MOS:
  * 11gR2 DBCA Can not Connect to Database/Instance in Multiple Listener Environment (Doc ID 1352890.1)

> show parameter local_listener
NAME				     TYPE	 VALUE
  *----------------------------------- ----------- ------------------------------
local_listener			     string	 VIS1_LOCAL


$ cd $TNS_ADMIN
$ cat tnsnames.ora

VIS1_LOCAL=
(DESCRIPTION=
(ADDRESS=(PROTOCOL=tcp)(HOST=usera1-vip.remik.org)(PORT=1526))
)

$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./addlnctl.sh status VIS
Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=usera1-vip.remik.org)(PORT=1526)(IP=FIRST)))
STATUS of the LISTENER
  *-----------------------
Alias                     VIS
Version                   TNSLSNR for Linux: Version 11.2.0.3.0 - Production
Start Date                13-JAN-2015 14:23:46
Uptime                    0 days 0 hr. 24 min. 56 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/oracle/VIS/11.2.0/network/admin/VIS1_usera1/listener.ora
Listener Log File         /u01/oracle/VIS/11.2.0/log/diag/tnslsnr/usera1/vis/alert/log.xml
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1526)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1526)))
Services Summary...
Service "VIS" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Service "VIS1" has 1 instance(s).
Instance "VIS1", status UNKNOWN, has 1 handler(s) for this service...
Service "ebs_patch" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
The command completed successfully

Checking the Grid listener status
ORACLE_SID: +ASM1
ORACLE_HOME: /u01/app/11.2.0/grid

$ lsnrctl status
Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/usera1/listener/alert/log.xml
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1521)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1521)))
Services Summary...
Service "+ASM" has 1 instance(s).
Instance "+ASM1", status READY, has 1 handler(s) for this service...


So I could use the full descriptor insted:
> alter system set local_listener='(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=usera1-vip.remik.org)(PORT=1526)))' sid='VIS1';

But the advise is to register instance to default listener in GRID_HOME on top of the listeners it's currently registered to

> alter system set local_listener='(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=usera1-vip.remik.org)(PORT=1521))(ADDRESS=(PROTOCOL=TCP)(HOST=usera1-vip.remik.org)(PORT=1526))))' sid='VIS1';
> alter system register;

Checking the GRID listener:
ORACLE_SID: +ASM1
ORACLE_HOME: /u01/app/11.2.0/grid

$ lsnrctl status
Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/usera1/listener/alert/log.xml
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1521)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1521)))
Services Summary...
Service "+ASM" has 1 instance(s).
Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "VIS" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Service "ebs_patch" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
The command completed successfully

Checking DB listener
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./addlnctl.sh status VIS
Listener Parameter File   /u01/oracle/VIS/11.2.0/network/admin/VIS1_usera1/listener.ora
Listener Log File         /u01/oracle/VIS/11.2.0/log/diag/tnslsnr/usera1/vis/alert/log.xml
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1526)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1526)))
Services Summary...
Service "VIS" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Service "VIS1" has 1 instance(s).
Instance "VIS1", status UNKNOWN, has 1 handler(s) for this service...
Service "ebs_patch" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
The command completed successfully


Changing on the second node:
> show parameter local_listener

NAME				     TYPE	 VALUE
  *----------------------------------- ----------- ------------------------------
local_listener			     string	 VIS2_LOCAL

VIS2_LOCAL=
(DESCRIPTION=
(ADDRESS=(PROTOCOL=tcp)(HOST=usera2-vip.remik.org)(PORT=1526))
)

> alter system set local_listener='(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=usera2-vip.remik.org)(PORT=1521))(ADDRESS=(PROTOCOL=TCP)(HOST=usera2-vip.remik.org)(PORT=1526))))' sid='VIS2';
> alter system register;

Shutdown MT






== Can adop cycle be interrupted by MT/DB restart ==
What I have tested and it worked:

  # adop=prepare
2. shutdown MT, DB
3. startup DB
4. adop=apply




= Minor patching exercises =

== Apply patch 18668337:R12.FUN.C ==

=== Start a new patching cycle ===
{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
}}}

So, the RUN edition is now (fs2), the patch edition is now (fs1).

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
ebs2		master		PREPARE     COMPLETED	    05-MAY-14 14:19:07 +02:00	   05-MAY-14 15:21:17 +02:00  1:02:10
APPLY	    COMPLETED	    07-MAY-14 10:41:43 +02:00	   08-MAY-14 00:50:56 +02:00  14:09:13
FINALIZE    COMPLETED	    08-MAY-14 05:40:10 +02:00	   08-MAY-14 05:42:20 +02:00  0:02:10
CUTOVER     COMPLETED	    08-MAY-14 05:44:25 +02:00	   08-MAY-14 06:32:12 +02:00  0:47:47
CLEANUP     COMPLETED	    08-MAY-14 06:37:26 +02:00	   08-MAY-14 15:48:29 +02:00  9:11:03
}}}


{{{
$ adop phase=prepare
}}}

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    22-AUG-14 16:23:06 +02:00	   22-AUG-14 16:43:37 +02:00  0:20:31
APPLY	    NOT STARTED
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED
}}}


=== Apply patch 18668337 ===

ERROR WHEN SETUP INVOICE OPTIONS AT AGIS SETUPS (Patch)
p18668337_R12.FUN.C_R12_GENERIC.zip	13.0 KB	(13288 bytes) MD5	8986420DA6325D77C0516480877CBA84

Check if the patch has not been already applied
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18668337';
no rows selected
}}}

{{{
$ cd $PATCH_TOP
$ md5sum p18668337_R12.FUN.C_R12_GENERIC.zip
8986420da6325d77c0516480877cba84  p18668337_R12.FUN.C_R12_GENERIC.zip
$ unzip p18668337_R12.FUN.C_R12_GENERIC.zip
}}}

{{{
$ adop phase=apply patches=18668337
}}}

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    22-AUG-14 16:23:06 +02:00	   22-AUG-14 16:43:37 +02:00  0:20:31
APPLY	    COMPLETED	    22-AUG-14 16:46:19 +02:00	   22-AUG-14 17:53:04 +02:00  1:06:45
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED
}}}


The patch has been applied to the PATCH edition, it is not yet "seeable".


=== Perform cutover to switch patch file system to run file system ===

This cutover phase will stop services on the current RUN (fs2) edition, replace the (fs1) as the RUN edition and start services from that.

{{{
$ adop phase=cutover
}}}

{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs1/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs2/EBSapps/appl
Non-Editioned File System : /u01/oracle/VIS/fs_ne
}}}


{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18668337';
}}}

BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
935966 18668337			  22-AUG-14


Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    22-AUG-14 16:23:06 +02:00	   22-AUG-14 16:43:37 +02:00  0:20:31
APPLY	    COMPLETED	    22-AUG-14 16:46:19 +02:00	   22-AUG-14 17:53:04 +02:00  1:06:45
CUTOVER     COMPLETED	    22-AUG-14 19:41:42 +02:00	   22-AUG-14 19:54:38 +02:00  0:12:56
FINALIZE    COMPLETED	    22-AUG-14 19:42:00 +02:00	   22-AUG-14 19:42:37 +02:00  0:00:37
CLEANUP     NOT STARTED

This is it, patch has been applied, services are running.

Last phase, the cleanup. Can be done on a running system.

{{{
$ adop phase=cleanup
}}}

Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    22-AUG-14 16:23:06 +02:00	   22-AUG-14 16:43:37 +02:00  0:20:31
APPLY	    COMPLETED	    22-AUG-14 16:46:19 +02:00	   22-AUG-14 17:53:04 +02:00  1:06:45
CUTOVER     COMPLETED	    22-AUG-14 19:41:42 +02:00	   22-AUG-14 19:54:38 +02:00  0:12:56
FINALIZE    COMPLETED	    22-AUG-14 19:42:00 +02:00	   22-AUG-14 19:42:37 +02:00  0:00:37
CLEANUP     COMPLETED	    22-AUG-14 21:22:12 +02:00	   22-AUG-14 22:06:29 +02:00  0:44:17







== Apply both patch 18376908 and 18668337 ==

=== Start a new patching cycle ===
{{{
$ . /u01/oracle/VIS/EBSapps.env run
E-Business Suite Environment Information
  *---------------------------------------
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
}}}

So, the RUN edition is now (fs2), the patch edition is now (fs1).

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
ebs2		master		PREPARE     COMPLETED	    05-MAY-14 14:19:07 +02:00	   05-MAY-14 15:21:17 +02:00  1:02:10
APPLY	    COMPLETED	    07-MAY-14 10:41:43 +02:00	   08-MAY-14 00:50:56 +02:00  14:09:13
FINALIZE    COMPLETED	    08-MAY-14 05:40:10 +02:00	   08-MAY-14 05:42:20 +02:00  0:02:10
CUTOVER     COMPLETED	    08-MAY-14 05:44:25 +02:00	   08-MAY-14 06:32:12 +02:00  0:47:47
CLEANUP     COMPLETED	    08-MAY-14 06:37:26 +02:00	   08-MAY-14 15:48:29 +02:00  9:11:03
}}}


{{{
$ adop phase=prepare
}}}

{{{
$ adop -status
}}}

sun4		master		PREPARE     COMPLETED	    28-AUG-14 14:19:58 +02:00	   28-AUG-14 14:41:00 +02:00  0:21:02
APPLY	    NOT STARTED
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED

=== Apply patch 18376908 and 18668337 ===
==== prepare patch 18376908 ====
  #FF:17731609:TST1223: ENABLE NEGATIVE ACCRUAL TRANSACTION FLAG MISSING IN IMPLE (Patch)
p18376908_R12.PJC.C_R12_GENERIC.zip	144.0 KB	(147415 bytes) MD5	CEADC6899CBABCC8A17D0B195F17FFE4

Check if the patch has not been already applied
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18376908';
no rows selected
}}}

{{{
$ cd $PATCH_TOP
$ md5sum p18376908_R12.PJC.C_R12_GENERIC.zip
ceadc6899cbabcc8a17d0b195f17ffe4  p18376908_R12.PJC.C_R12_GENERIC.zip
$ unzip p18376908_R12.PJC.C_R12_GENERIC.zip
}}}


==== prepare patch 18668337 ====
ERROR WHEN SETUP INVOICE OPTIONS AT AGIS SETUPS (Patch)
p18668337_R12.FUN.C_R12_GENERIC.zip	13.0 KB	(13288 bytes) MD5	8986420DA6325D77C0516480877CBA84

Check if the patch has not been already applied
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18668337';
no rows selected
}}}

{{{
$ cd $PATCH_TOP
$ md5sum p18668337_R12.FUN.C_R12_GENERIC.zip
8986420da6325d77c0516480877cba84  p18668337_R12.FUN.C_R12_GENERIC.zip
$ unzip p18668337_R12.FUN.C_R12_GENERIC.zip
}}}

==== do the combined apply ====
{{{
$ adop phase=apply patches=18376908,18668337
}}}

{{{
$ adop -status
}}}

Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    28-AUG-14 14:19:58 +02:00	   28-AUG-14 14:41:00 +02:00  0:21:02
APPLY	    ACTIVE	    28-AUG-14 15:39:11 +02:00	   28-AUG-14 16:38:39 +02:00  0:59:28
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED


The patch is already visible:

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18668337';
}}}

BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
935967 18668337			  28-AUG-14

{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '18376908';
}}}

BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
935966 18376908			  28-AUG-14

=== Apply patch 18376908 and 18668337 the wrong approach (just for curiosity) ===
{{{
$ adop phase=apply patches=18376908
adop exiting with status = 0 (Success)
}}}

Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    29-AUG-14 21:07:38 +02:00	   29-AUG-14 21:28:50 +02:00	  0:21:12
APPLY	    ACTIVE	    29-AUG-14 21:35:20 +02:00	   29-AUG-14 21:36:40 +02:00	  0:01:20
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED


  *> This works fine.

{{{
$ adop phase=apply patches=18668337
adop exiting with status = 0 (Success)
}}}

Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    29-AUG-14 21:07:38 +02:00	   29-AUG-14 21:28:50 +02:00	  0:21:12
APPLY	    ACTIVE	    29-AUG-14 21:35:20 +02:00	   29-AUG-14 22:44:05 +02:00	  1:08:45
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED
FINALIZE    NOT STARTED

  *> this to my surprise worked as well





=== Perform cutover to switch patch file system to run file system ===

This cutover phase will stop services on the current RUN (fs2) edition, replace the (fs1) as the RUN edition and start services from that.

{{{
$ adop phase=cutover
}}}

{{{
$ adop -status
}}}

Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    28-AUG-14 14:19:58 +02:00	   28-AUG-14 14:41:00 +02:00  0:21:02
APPLY	    COMPLETED	    28-AUG-14 15:39:11 +02:00	   28-AUG-14 16:38:39 +02:00  0:59:28
CUTOVER     COMPLETED	    28-AUG-14 16:46:05 +02:00	   28-AUG-14 17:05:22 +02:00  0:19:17
FINALIZE    COMPLETED	    28-AUG-14 16:46:23 +02:00	   28-AUG-14 16:46:42 +02:00  0:00:19
CLEANUP     NOT STARTED

This is it, patch has been applied, services are running.

Last phase, the cleanup. Can be done on a running system.

{{{
$ adop phase=cleanup
}}}

== applying the same patch again ==

If a patch has to be reapplied, then specify parameters "abandon=no" and "restart=yes".
If a patch has to be reapplied and any of the parameters modified, then specify parameters "abandon=yes" and "restart=no".


= Troubleschooting =
== LsInventorySession failed: OracleHomeInventory gets null oracleHomeInfo ==
{{{
$ opatch lsinventory
Oracle Interim Patch Installer version 11.2.0.3.6
Copyright (c) 2013, Oracle Corporation.  All rights reserved.
}}}


Oracle Home       : /u01/oracle/VIS/11.2.0
Central Inventory : /u01/oraInventory
from           : /u01/oracle/VIS/11.2.0/oraInst.loc
OPatch version    : 11.2.0.3.6
OUI version       : 11.2.0.3.0
Log file location : /u01/oracle/VIS/11.2.0/cfgtoollogs/opatch/opatch2014-09-16_14-37-24PM_1.log

List of Homes on this system:

Inventory load failed... OPatch cannot load inventory for the given Oracle Home.
Possible causes are:
Oracle Home dir. path does not exist in Central Inventory
Oracle Home is a symbolic link
Oracle Home inventory is corrupted
LsInventorySession failed: OracleHomeInventory gets null oracleHomeInfo

OPatch failed with error code 73

{{{
$ ls /u01/oraInventory
logs
}}}

Looks like there is nothing installed here.

MOS:
  * FAQs on Central Inventory and Oracle Home Inventory (Local Inventory) in Oracle RDBMS (Doc ID 564192.1)
  * Steps To Recreate Central Inventory(oraInventory) In RDBMS Homes (Doc ID 556834.1)

{{{
$ cd $ORACLE_HOME/oui/bin
$ ./runInstaller -silent -ignoreSysPrereqs -attachHome ORACLE_HOME="$ORACLE_HOME" ORACLE_HOME_NAME=EBS_DB
}}}

{{{
$ ls /u01/oraInventory
ContentsXML  logs
}}}

{{{
$ opatch lsinventory
  *> looks good.
}}}


== How to access Oracle Applications Manager ==
Login as sysadmin,
System Administration -> Oracle Applications Manager -> Dashboard


== Adop logs ==
Filesystem logs:
{{{
$APPL_TOP_NE/../log/adop
}}}

DB logs:
AD_ZD_LOGS Table
The contents of the table can be obtained by running the following command:
{{{
$ sqlplus apps/apps @$AD_TOP/sql/ADZDSHOWLOG.sql
}}}

Get the contents of ad_adop_session_patches table using the following command
select * from ad_adop_session_patches order by end_date;

=== Troubleshooting Scripts ===

==== System Status ====
ADZDSHOWED.sql
Edition List in historical order, it highlights Run edition and Patch edition (if exists)
ADZDSHOWOBJS.sql
Summary of Editioned Objects per database Edition
ADZDSHOWTS.sql
Summary of Important Tablespaces status
ADZDSHOWLOG.sql
Dump of Statement level Database LOG
ADZDSHOWLOGEVT.sql
Statement level log for a specific event

==== During Patching ====
ADZDSHOWSTATUS.sql
Detailed Summary Status of the Current Patching Cycle, Patches Applied, object difference between last two editions, cross edition triggers, seed data tables prepared
ADZDSHOWTM.sql
Table manager, patching detail like patched indexes, CFET etc
ADZDSHOWSM.sql
Seed Data Tables that were prepared in the current edition and Seed Data synchronization Triggers
ADZDSHOWDDLS.sql
Count of Current DDL Jobs per Phase and Status (Enablement and Cutover)
ADZDSHOWPATCH.sql
Patched/Actual Objects, Patched Columns and Patched Seed Data Tables
ADZDSHOWMV.sql
Shows Materialized Views details for the current patching cycle

==== General Purpose ====
ADZDSHOWAOBJS.sql
Actual Objects for Current Edition
ADZDSHOWCOBJS.sql
Covered Objects per Edition
ADZDSHOWEV.sql
Shows the column mappings of a specific Editioning View
ADZDSHOWTAB.sql
Displays a table's metadata information, which can be used to check the status after enablement
ADZDSHOWINDEX.sql
Index details for a specified table



== Apps 11i Keys shortcut ==

below are 11i keys quick shortcut it will help to save time
{{{
F4 Exit
F5 Clear Field
F6 Clear Record
F7 Clear Block
F8 Clear Form
F11 Query Enter - wyszukiwanie, then Ctrl + F11 to execute the query
F12 Count Query
Ctrl + S Save
Ctrl + L List of Values
Ctrl + F11 Query Run
Ctrl + E Edit
Ctrl + Up Delete Record
Ctrl + Down Insert Record
Ctrl + P Print
Ctrl + U Update Record
Ctrl + B Block Menu
Ctrl + K Display list of Keys
Shift + F5 Duplicate Field
Shift + F6 Duplicate Record
Shift + F8 Next Set of Records (Same as Page Down)
Shift + Page Down Next Block
Shift + Tab Previous Field
Shift + Page Up Previous Block
Shift + Ctrl + E Display Error
Page Down Scroll Down (Same as Shift + F8)
Page Up Scroll Up
Tab Next Field
Down Arrow Next Record
Up Arrow Previous Record
Return Return
}}}



== Apache ==
=== restart ===
cd $SCRIPT_TOP
or
cd $ADMIN_SCRIPTS_HOME
./adapcctl.sh stop
./adapcctl.sh start

=== logs ===
{{{
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/diagnostics/logs/OHS/EBS_web_${TWO_TASK}
}}}

eg
/u01/oracle/VIS/fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/diagnostics/logs/OHS/EBS_web_VIS

=== httpd.conf ===
Apache conf:
{{{
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/config/OHS/EBS_web_${TWO_TASK}
}}}



== oacore_server1 ==
=== restart ===
{{{
$ cd $SCRIPT_TOP
$ admanagedsrvctl.sh status oacore_server1
$ admanagedsrvctl.sh start oacore_server1
}}}

=== logs ===
{{{
$ cd $EBS_DOMAIN_HOME/servers/oacore_server1/logs
$ less oacore_server1.out00517
}}}


=== Datasource password ===
Could not connect to 'oracle.jdbc.OracleDriver'.
The returned message is: ORA-01017: invalid username/password; logon denied

Domain Structure / Services / Data Sources / OAEADatasource / Connection Pool - and proper password






== Where is the request output and logfile ==
output is directly appended in output file in $APPLCSF/$APPLOUT/o<req_id>.out

{{{
> select LOGFILE_NAME, OUTFILE_NAME from apps.fnd_concurrent_requests where request_id = 7455807;
/u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/log/l7455807.req
/u01/oracle/VIS/fs_ne/inst/VIS_sun4/logs/appl/conc/out/o7455807.out
}}}








== how to check what all localizations / product is installed ==
System Administrator -> Oracle Applications Manager, License Manager




== change Profile option ==

System Administrator > Profile > System


== How to restart only selected services, not the whole MT ==
http://onlineappsdba.com/index.php/2007/06/10/start-up-shutdown-scripts-in-oracle-apps-r12/

Concurent manager
{{{
$ ./adcmctl.sh stop
$ ./adcmctl.sh start
}}}


== Concurent managers logs ==

Internal manager
cd $APPLCSF/$APPLLOG
ls -lrt *$TWO_TASK*


== Who is logged to the system ==

SELECT DISTINCT icx.session_id,
icx.user_id,
fu.user_name,
fu.description
FROM icx_sessions icx, fnd_user fu
WHERE     disabled_flag != 'Y'
AND icx.pseudo_flag = 'N'
AND (last_connect +
DECODE (fnd_profile.VALUE ('ICX_SESSION_TIMEOUT'),
NULL, limit_time,
0   , limit_time,
fnd_profile.VALUE ('ICX_SESSION_TIMEOUT')/60) / 24) > SYSDATE
AND icx.counter < limit_connects
AND icx.user_id = fu.user_id;



== Putting requests on hold ==
Meaning of status_code and phase_code in FND_CONCURRENT_REQUESTS table
http://arunrathod.blogspot.com/2008/12/meaning-of-statuscode-and-phasecode-in.html


create table holded_req tablespace APPS_TS_TX_DATA
as select * from fnd_concurrent_requests
where phase_code = 'P'
and status_code in ('Q','I')
and requested_by <> 0
and hold_flag <> 'Y';


== How to start Workflow Notification Mailer ==

Login as sysadmin
System Administrator -> Oracle Applications Manager -> Workflow
Service Components -> Workflow Mailer Service (Container column)
Start what is not started.


== start / stop logs ==

$ cd $LOG_HOME/appl/admin/log/
eg
/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon3/logs/appl/admin/log/adstpall.log


= Upgrading DB to 11.2.0.4 =

MOS:
  * Interoperability Notes E-Business Suite Release 12.2 with Database 11g Release 2 (Doc ID 1623879.1)
  * E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)
  * Database Patch Conflict Resolution (Doc ID 1321267.1)
  * How to Relink Oracle Database Software on UNIX (Doc ID 131321.1)

Following: Interoperability Notes E-Business Suite Release 12.2 with Database 11g Release 2 (Doc ID 1623879.1)

Section 1: Upgrading an R12 Database to Oracle Database 11g Release 2 (11.2.0)

== 1. Verify software versions ==

=== Read the "Determine the Upgrade Path" subsection in Chapter 2 of the Oracle Database Upgrade Guide 11g Release 2 (11.2). Make sure that direct upgrade is supported from your current release. ===

Yes, it is supported to upgrade from 11.2.0.3 to 11.2.0.4 :)

=== Apply EBS patches: (if not already there) ===

Patch 16207672 - 12.2.2
Patch 17999920
Patch 18054175 - Already included in AD.C.delta.4 (17766337)

{{{
> select bug_number,creation_date from apps.ad_bugs where bug_number in ('16207672','17999920','18054175') order by bug_number;
}}}

BUG_NUMBER		       CREATION_DATE
  *----------------------------- ------------------
  #207672		       08-MAY-14

So we need Patch 17999920 and Patch 18054175 to be applied first, before we will do anything with the DB.

p17999920_R12.ONT.C_R12_GENERIC.zip	22.3 KB	MD5	390B01042318B364CFEC28027E4FBE85
(no special pre or post instructions)

  #FF:ONLINE ENABLEMENT FAILS ON 11.2.0.4 DB,DBMS_OBJECTS_UTILS AUTHID CHANGE (Patch)
p18054175_R12.AD.C_R12_GENERIC.zip	66.8 KB	MD5	9DC17CB1EC9F0E32D313895A29B6A1D7
(run recent adgrants)

Readme:

Run the adgrants.sql script as a user that can connect as SYSDBA to grant privileges to selected SYS objects and create PL/SQL profiler objects.

Login to App tier

{{{
$ cd /STAGING/ebs12patches
$ md5sum p17999920_R12.ONT.C_R12_GENERIC.zip
390b01042318b364cfec28027e4fbe85  p17999920_R12.ONT.C_R12_GENERIC.zip
$ md5sum p18054175_R12.AD.C_R12_GENERIC.zip
9dc17cb1ec9f0e32d313895a29b6a1d7  p18054175_R12.AD.C_R12_GENERIC.zip
}}}

{{{
$ unzip p17999920_R12.ONT.C_R12_GENERIC.zip
$ unzip p18054175_R12.AD.C_R12_GENERIC.zip
}}}

Checking which adgrants is more recent
{{{
$ head 18054175/admin/adgrants.sql | grep Header
}}}

{{{
$ head $APPL_TOP/admin/adgrants.sql | grep Header
}}}

The same, no need to run adgrants.

OK, proceeding with the patching.

{{{
$ adop phase=prepare
$ adop phase=apply patches=17999920,18054175 patchtop=/STAGING/ebs12patches
$ adop phase=cutover,cleanup
}}}

{{{
> select bug_number,creation_date from apps.ad_bugs where bug_number in ('16207672','17999920','18054175') order by bug_number;
}}}

BUG_NUMBER		       CREATION_DATE
  *----------------------------- ------------------
  #207672		       08-MAY-14
  #999920		       20-OCT-14
  #054175		       20-OCT-14

=== Implement AutoConfig or upgrade to the latest version. ===
See the Patching AutoConfig subsection of the Technical Configuration section of the Oracle E-Business Suite Setup Guide Release 12.2 for instructions.

Autoconfig implemented.

=== Daylight Saving changes, Minimum version 17 ===
MOS:
  * Complying with Daylight Saving Time (DST) and Time Zone Rule Changes in E-Business Suite 12 (Doc ID 563019.1)


{{{
> select value$ from sys.props$ where name='DST_PRIMARY_TT_VERSION';
VALUE$
  *-------------------------------------------------------------------------------
  #
}}}

  *> Doing nothing now.

=== DirectX ===
Windows customers ONLY

  *> Skipping

== 2. Update application tier context file with new database listener port number (conditional) ==

None of the mentioned parameters will change. Doing nothing.


== 3. Prepare to create the 11.2.0 Oracle home ==
Now the DB binaries are installed under:

ORACLE_HOME=/u01/oracle/VIS/11.2.0

we will install under new home, lets assume it is

ORACLE_HOME=/u01/oracle/VIS/11204

== 4. Install the 11.2.0.4 software ==

{{{
$ cd /STAGING/oracle11.2.0.4_x86-64
$ md5sum p13390677_112040_Linux-x86-64_1of7.zip
  #16f61789891a56eafd40de79f58f28  p13390677_112040_Linux-x86-64_1of7.zip
$ md5sum p13390677_112040_Linux-x86-64_2of7.zip
67ba1e68a4f581b305885114768443d3  p13390677_112040_Linux-x86-64_2of7.zip
}}}

{{{
$ unzip p13390677_112040_Linux-x86-64_1of7.zip
$ unzip p13390677_112040_Linux-x86-64_2of7.zip
}}}

{{{
$ export ORACLE_HOME=/u01/oracle/VIS/11204
$ cd database
$ ./runInstaller
Configure Security Updates -> No
Download Software Updates -> Skip
Installation Option -> Install Database software only
Grid Installation Options -> Single Instance
Product Languages -> Select all used in EBS
Database Edition -> Enterprise Edition
Installation Location -> Oracle Base: /u01, Software Location: /u01/oracle/VIS/11204
Operating System Groups -> dba, oinstall
}}}

You will be asked to run as root:
{{{
# /u01/oracle/VIS/11204/root.sh
}}}

Done.

== 5. Install Oracle Database 11g Products from the 11g Examples CD (mandatory) ==

{{{
$ cd /STAGING/oracle11.2.0.4_x86-64
$ md5sum p13390677_112040_Linux-x86-64_6of7.zip
2db69cd15db335758228d91182263c5e  p13390677_112040_Linux-x86-64_6of7.zip
$ unzip p13390677_112040_Linux-x86-64_6of7.zip
$ cd examples
$ ./runInstaller
Download Software Updates -> Skip
Specify Installation Location -> Software Location: /u01/oracle/VIS/11204
}}}

We are supposed to have all the env variables set to look like we are running form /u01/oracle/VIS/11204

This can be easily set bu using this trick:
{{{
$ echo "DUMMY:/u01/oracle/VIS/11204:N" >> /etc/oratab
$ . oraenv
  *> DUMMY
}}}

And we have
ORACLE_BASE=/u01
ORACLE_HOME=/u01/oracle/VIS/11204
PATH=/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/home/oracle/bin:/u01/oracle/VIS/11204/bin
LD_LIBRARY_PATH=/u01/oracle/VIS/11204/lib

The only thing missing is PERL5LIB
{{{
$ export PERL5LIB=/u01/oracle/VIS/11204/perl/lib/5.10.0:/u01/oracle/VIS/11204/perl/lib/site_perl/5.10.0
}}}

The one that needs some fixing is PATH
{{{
$ which perl
/usr/bin/perl
}}}

And we want to use the one delivered with Oracle binaries

{{{
$ export PATH=$ORACLE_HOME/perl/bin:$PATH
$ which perl
/u01/oracle/VIS/11204/perl/bin/perl
}}}

== 6a. Apply additional 11.2.0.4 RDBMS patches ==
MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)
  * Database Patch Set Update Overlay Patches Required for Use with PSUs and Oracle E-Business Suite (Doc ID 1147107.1)

So, we have an option here:
  # Go with Doc ID 1594274.1 and install only the mention interoperability patches
2. Go with Doc ID 1147107.1 and Apply latest PSU + required interoperability patches

I chose 2.

=== First I will apply 11.2.0.4.3 PSU 18522509 (latest certified with EBS) ===

DATABASE PATCH SET UPDATE 11.2.0.4.3 (INCLUDES CPUJUL2014) (Patch)
p18522509_112040_Linux-x86-64.zip	24.3 MB	MD5	6AE77509E30D8B30A78CE0F837AA3258

Following Patch 18522509 - 11.2.0.4.3 Patch Set Update Readme

{{{
$ cd /STAGING/DB_11.2_patches
$ md5sum p18522509_112040_Linux-x86-64.zip
6ae77509e30d8b30a78ce0f837aa3258  p18522509_112040_Linux-x86-64.zip
}}}

{{{
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
Oracle Interim Patch Installer version 11.2.0.3.4
}}}

Oracle Database 11g                                                  11.2.0.4.0
Oracle Database 11g Examples                                         11.2.0.4.0
There are 2 products installed in this Oracle Home.
There are no Interim patches installed in this Oracle Home.

First we need to patche the opatch :) to version 11.2.0.3.6 or later
p6880880_112000_Linux-x86-64.zip MD5	2AB78CB17174C3A49DF560F05E3352C6
{{{
$ md5sum p6880880_112000_Linux-x86-64.zip
2ab78cb17174c3a49df560f05e3352c6  p6880880_112000_Linux-x86-64.zip
$ mv $ORACLE_HOME/OPatch $ORACLE_HOME/OPatch_`/bin/date +%Y%m%d`
$ unzip -d $ORACLE_HOME p6880880_112000_Linux-x86-64.zip
$ opatch version
OPatch Version: 11.2.0.3.6
}}}



No we can proceed to apply 11.2.0.4.3
{{{
$ cd /STAGING/DB_11.2_patches
$ unzip p18522509_112040_Linux-x86-64.zip
$ cd 18522509
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
Prereq "checkConflictAgainstOHWithDetail" passed.
}}}

{{{
$ opatch apply
Oracle Home       : /u01/oracle/VIS/11204
Composite patch 18522509 successfully applied.
OPatch Session completed with warnings.
}}}

We can ignore the following warnings
ins_emagent.mk:113: warning: overriding commands for target `nmosudo'
ins_emagent.mk:52: warning: ignoring old commands for target `nmosudo'


=== Then I will apply the overlay patches mentioned in Doc ID 1147107.1 ===
To make it faster lets create a response file for this monit about receiving the security mail, so we do not have to answer it every time we run opatch.
{{{
$ cd $ORACLE_HOME/OPatch/ocm/bin
$ pwd
/u01/oracle/VIS/11204/OPatch/ocm/bin
$ ./emocmrsp
}}}

Now the ocm.rsp file should be created in current directory.


{{{
$ ls -1 | grep -v 18522509 | awk '{print "unzip -n "$0 }'
unzip -n p12949905_112040_Linux-x86-64.zip
unzip -n p16989137_112040_Generic.zip
unzip -n p17402822_112040_Linux-x86-64.zip
unzip -n p17429475_112040_Generic.zip
unzip -n p17501296_112040_Generic.zip
unzip -n p17629476_112040_Generic.zip
unzip -n p17944018_112040_Generic.zip
unzip -n p18118982_112041_Linux-x86-64.zip
unzip -n p18419770_112040_Linux-x86-64.zip
unzip -n p18614015_112040_Generic.zip
unzip -n p18665660_112040_Linux-x86-64.zip
unzip -n p18685209_112040_Linux-x86-64.zip
unzip -n p19233888_112043_Linux-x86-64.zip
unzip -n p4189542_112040_Linux-x86-64.zip
unzip -n p4247037_112040_Generic.zip
unzip -n p17912217_112043_Linux-x86-64.zip
}}}

{{{
$ ls -1 | grep -v 18522509 | awk '{print "md5sum "$0 }'
md5sum p12949905_112040_Linux-x86-64.zip
md5sum p16989137_112040_Generic.zip
md5sum p17402822_112040_Linux-x86-64.zip
md5sum p17429475_112040_Generic.zip
md5sum p17501296_112040_Generic.zip
md5sum p17629476_112040_Generic.zip
md5sum p17944018_112040_Generic.zip
md5sum p18118982_112041_Linux-x86-64.zip
md5sum p18419770_112040_Linux-x86-64.zip
md5sum p18614015_112040_Generic.zip
md5sum p18665660_112040_Linux-x86-64.zip
md5sum p18685209_112040_Linux-x86-64.zip
md5sum p19233888_112043_Linux-x86-64.zip
md5sum p4189542_112040_Linux-x86-64.zip
md5sum p4247037_112040_Generic.zip
md5sum p17912217_112043_Linux-x86-64.zip
}}}

{{{
$ md5sum p12949905_112040_Linux-x86-64.zip
f02149beef366559b7c69ebda7a22175  p12949905_112040_Linux-x86-64.zip
$ md5sum p16989137_112040_Generic.zip
0ad30310d8f272ac9abdb90b6e41508c  p16989137_112040_Generic.zip
$ md5sum p17402822_112040_Linux-x86-64.zip
a403e4e4d467a2b45ce9156d820fe3da  p17402822_112040_Linux-x86-64.zip
$ md5sum p17429475_112040_Generic.zip
2c659bf0c1c99ac4458e08018a50dc95  p17429475_112040_Generic.zip
$ md5sum p17501296_112040_Generic.zip
d3eb7063bb456a6bae17b1d458445a12  p17501296_112040_Generic.zip
$ md5sum p17629476_112040_Generic.zip
51108971cdb9b2cb99b664585ee196b6  p17629476_112040_Generic.zip
$ md5sum p17912217_112043_SOLARIS64.zip
d168c8eb891ba0ad8993d7658f954245  p17912217_112043_SOLARIS64.zip
$ md5sum p17944018_112040_Generic.zip
7cc42707f10a1f53e8ee9151c96e1bf3  p17944018_112040_Generic.zip
$ md5sum p18118982_112041_Linux-x86-64.zip
5f978d91237597824db30a5c85e3d97a  p18118982_112041_Linux-x86-64.zip
$ md5sum p18419770_112040_Linux-x86-64.zip
e2f0e86685ec667fe91701ba4ff1f805  p18419770_112040_Linux-x86-64.zip
$ md5sum p18614015_112040_Generic.zip
e3157e2289bef31bda59d91d7e69a384  p18614015_112040_Generic.zip
$ md5sum p18665660_112040_Linux-x86-64.zip
8fc29f69732a60426621f6eb372a2c91  p18665660_112040_Linux-x86-64.zip
$ md5sum p18685209_112040_Linux-x86-64.zip
df97e08ef1085359083aaf27acc23732  p18685209_112040_Linux-x86-64.zip
$ md5sum p19233888_112043_Linux-x86-64.zip
972e419d75321493daf57a37ef52efcb  p19233888_112043_Linux-x86-64.zip
$ md5sum p4189542_112040_Linux-x86-64.zip
06eb1b0039245b92a29fa366188c9a7c  p4189542_112040_Linux-x86-64.zip
$ md5sum p4247037_112040_Generic.zip
e3e864ff687934898600e5d2b67bf93e  p4247037_112040_Generic.zip
$ md5sum p17912217_112043_Linux-x86-64.zip
b99dc0f478991d4d02375c821e7f63a3  p17912217_112043_Linux-x86-64.zip
}}}


==== 4189542 ====
ONLY SYS CAN "ALTER SYNONYM... COMPILE" FOR ANOTHER USERS'S SYNONYM (Patch)
p4189542_112040_Linux-x86-64.zip	MD5	06EB1B0039245B92A29FA366188C9A7C

{{{
$ cd 4189542
$ opatch apply -silent -ocmrf /u01/oracle/VIS/11204/OPatch/ocm/bin/ocm.rsp
}}}

This opatch apply repeat on every following patch.

==== 4247037 ====
RFID-EPC GENERATION FEATURE FROM DATABASE SERVER. TO BE USED WITH APPS WMS R12 (Patch)
p4247037_112040_Generic.zip	MD5	E3E864FF687934898600E5D2B67BF93E

{{{
$ cd 4247037
}}}

==== 12949905 ====
DST-17: DST UPDATE OCTOBER 2011 - TZDATA2011J (Patch)
p12949905_112040_Linux-x86-64.zip	MD5	F02149BEEF366559B7C69EBDA7A22175

{{{
$ cd 12949905
}}}

==== 16989137 ====
DRG-10761 ON SETTING PROCEDURE ATTRIBUTE OF PROCEDURE_FILTER PREFERENCE (Patch)
p16989137_112040_Generic.zip	MD5	0AD30310D8F272AC9ABDB90B6E41508C

{{{
$ cd 16989137
}}}

==== 17402822 ====
ENABLE 3RD PARTY INXIGHT LINGUISTX TECHNOLOGY IN 11.2.0.4 (Patch)
p17402822_112040_Linux-x86-64.zip	MD5	A403E4E4D467A2B45CE9156D820FE3DA

{{{
$ cd 17402822
}}}

==== 18118982 version 11.2.0.4.1 ====
MERGE REQUEST ON TOP OF DATABASE PSU 11.2.0.4.1 FOR BUGS 10019002 10427365 (Patch)
p18118982_112041_Linux-x86-64.zip	MD5	5F978D91237597824DB30A5C85E3D97A

{{{
$ cd 18118982
}}}

==== 17429475 ====
RCONFIG DROPPING TEMPORARY DATA FILES NOT CREATING THEM (Patch)
p17429475_112040_Generic.zip	MD5	2C659BF0C1C99AC4458E08018A50DC95

{{{
$ cd 17429475
}}}

==== 17501296 ====
UNABLE TO DELETE ROWS FROM TABLE WITH TEXT INDEX AFTER UPGRADE TO 11.2.0.4 (Patch)
p17501296_112040_Generic.zip	MD5	D3EB7063BB456A6BAE17B1D458445A12

{{{
$ cd 17501296
}}}

==== 17629476 version 11.2.0.4.0 (no conflict) (NOTE: This Database Patch has an AD code dependency.Â  See 1594274.1 for detail) ====
MERGE REQUEST ON TOP OF 11.2.0.4.0 FOR BUGS 17421340 17487358 (Patch)
p17629476_112040_Generic.zip	MD5	51108971CDB9B2CB99B664585EE196B6

{{{
$ cd 17629476
}}}

==== 17912217 version 11.2.0.4.3 ====
TRACKING BUG FOR LRG 9760292 (Patch)
p17912217_112043_Linux-x86-64.zip	MD5	B99DC0F478991D4D02375C821E7F63A3

{{{
$ cd 17912217
}}}

==== 17944018 ====
MERGE REQUEST ON TOP OF 11.2.0.4.0 FOR BUGS 17654622 17801303 (Patch)
p17944018_112040_Generic.zip	MD5	7CC42707F10A1F53E8EE9151C96E1BF3

{{{
$ cd 17944018
}}}


==== 18419770 ====
KEY-PRESERVED TABLE IN JOIN VIEW NOT RECOGNIZED WHEN JOINED TABLES HAVE UNQ INDX (Patch)
p18419770_112040_Linux-x86-64.zip	MD5	E2F0E86685EC667FE91701BA4FF1F805

{{{
$ cd 18419770
}}}


==== 18614015 ====
UTL_RECOMP DOES NOT COMPILE INVALID OBJECTS MV WITH STATUS 3 (Patch)
p18614015_112040_Generic.zip	MD5	E3157E2289BEF31BDA59D91D7E69A384

{{{
$ cd 18614015
}}}


==== 18665660 ====
HIGH CHILD CURSOR COUNTS DUE TO OPTIMIZER_MISMATCH WITH OFE=920 HINT (Patch)
p18665660_112040_Linux-x86-64.zip	MD5	8FC29F69732A60426621F6EB372A2C91

{{{
$ cd 18665660
}}}


==== 18685209 ====
ORA-600 [KKOGBRO: NO KKOAPTYP] (Patch)
p18685209_112040_Linux-x86-64.zip	MD5	DF97E08EF1085359083AAF27ACC23732

{{{
$ cd 18685209
}}}


==== 19233888 version 11.2.0.4.3 ====
MERGE REQUEST ON TOP OF DATABASE PSU 11.2.0.4.3 FOR BUGS 17608907 17781991 (Patch)
p19233888_112043_Linux-x86-64.zip	MD5	972E419D75321493DAF57A37EF52EFCB

{{{
$ cd 19233888
}}}

== 6b. Apply additional 11.2.0.4 RDBMS patches (review 2015.02.11 to include JAN2015 PSU) ==
Going with the latest 11.2.0.4.5 - JAN2015 PSU Patch 19769489

DATABASE PATCH SET UPDATE 11.2.0.4.5 (INCLUDES CPUJAN2015) (Patch)
p19769489_112040_Linux-x86-64.zip	53.6 MB	MD5	3736762BE873522E0C92E1FFDDD4C857

$ md5sum p19769489_112040_Linux-x86-64.zip
3736762be873522e0c92e1ffddd4c857  p19769489_112040_Linux-x86-64.zip
$ unzip p19769489_112040_Linux-x86-64.zip

$ which opatch
/u01/oracle/VIS/11204/OPatch/opatch
$ opatch lspatches
  #233888;
  #685209;
  #665660;
  #614015;
  #419770;
  #944018;
  #912217;
  #629476;
  #501296;
  #429475;
  #118982;
  #402822;
  #989137;
  #949905;
4247037;
4189542;
  #522509;Database Patch Set Update : 11.2.0.4.3 (18522509)

$ cd 19769489
$ opatch apply -silent -ocmrf /u01/oracle/VIS/11204/OPatch/ocm/bin/ocm.rsp
Composite Patch 19769489 conflicts with installed patch(es)  19233888
$ opatch rollback -id 19233888
$ opatch apply -silent -ocmrf /u01/oracle/VIS/11204/OPatch/ocm/bin/ocm.rsp
Composite patch 19769489 successfully applied.
OPatch Session completed with warnings.
$ cd $ORACLE_HOME/rdbms/admin
> @catbundle.sql psu apply

$ opatch lspatches
  #769489;Database Patch Set Update : 11.2.0.4.5 (19769489)
  #685209;
  #665660;
  #419770;
  #944018;
  #629476;
  #501296;
  #429475;
  #118982;
  #402822;
  #989137;
  #949905;
4247037;
4189542;


EBS Technology Codelevel Checker (Patch) 28-Jan-2015 17:53
p17537119_R12_GENERIC.zip	15.1 KB	MD5	ACBAF219DB11CE3DB2512451DCAC88EC
$ md5sum p17537119_R12_GENERIC.zip
acbaf219db11ce3db2512451dcac88ec  p17537119_R12_GENERIC.zip

$ unzip p17537119_R12_GENERIC.zip
$ ./checkDBpatch.sh
List of missing bug fixes:
  #608907
  #781991
  #393542

==== 17608907 17781991 ====
  #910653 version 11.2.0.4.4
  #608907 version 11.2.0.4.4

(NOTE: If Patch 18241194, 18515145, 18061712 or 19233888 were installed, you should roll them back before installing this patch.)
  *> none of the mentioned patches installed.

===== Found Patch 17781991 for 11.2.0.4.5 =====

DROPPED OBJECTS ARE BEING REFERRED IN DEPENDENCY WHEN CREATE A NEW TABLE (Patch)
p17781991_112045_Linux-x86-64.zip	238.8 KB MD5	B320BA6BF12C3BBBE84B46B74873D723

$ md5sum p17781991_112045_Linux-x86-64.zip
b320ba6bf12c3bbbe84b46b74873d723  p17781991_112045_Linux-x86-64.zip
$ unzip p17781991_112045_Linux-x86-64.zip
$ cd 17781991
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
$ opatch apply

===== Found Patch 17608907 for 11.2.0.4.5 =====

TMDBWWD.DIF IN SDO MAIN (Patch)
p17608907_112045_Linux-x86-64.zip	788.9 KB MD5	047CF97023A68660D2C0108C22A6AF6E
$ md5sum p17608907_112045_Linux-x86-64.zip
047cf97023a68660d2c0108c22a6af6e  p17608907_112045_Linux-x86-64.zip
$ unzip p17608907_112045_Linux-x86-64.zip
$ cd 17608907
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
$ opatch apply

==== Patch 19393542 ====
Patch not visible in note: Database Patch Set Update Overlay Patches Required for Use with PSUs and Oracle E-Business Suite (Doc ID 1147107.1)
as required on top of 11.2.0.4, but reported by Code Checker

TIMESTAMP MISMATCHES ON RULE SET & EVALUATION CONTEXT (Patch)
p19393542_112040_Linux-x86-64.zip	129.2 KB MD5	248284C28C07C6825D1473661BEB3547

$ md5sum p19393542_112040_Linux-x86-64.zip
248284c28c07c6825d1473661beb3547  p19393542_112040_Linux-x86-64.zip
$ unzip p19393542_112040_Linux-x86-64.zip
$ cd 19393542
$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./
$ opatch apply
Applying interim patch '19393542' to OH '/u01/oracle/VIS/11204'
Verifying environment and performing prerequisite checks...
OPatch system modification phase did not start:
Patch "19393542" is not needed since it has no fixes for this Oracle Home. Please see log file for details.
Log file location: /u01/oracle/VIS/11204/cfgtoollogs/opatch/19393542_Feb_11_2015_11_33_54/apply2015-02-11_11-33-54AM_1.log






== 7. Create nls/data/9idata directory ==

With env set to new binaries
{{{
$ env | grep ORACLE_HOME
ORACLE_HOME=/u01/oracle/VIS/11204
$ which perl
/u01/oracle/VIS/11204/perl/bin/perl
}}}

{{{
$ perl $ORACLE_HOME/nls/data/old/cr9idata.pl
Please reset environment variable ORA_NLS10 to /u01/oracle/VIS/11204/nls/data/9idata!
}}}

== 8. Install JRE 6 ==
Install JRE 6 on the $ORACLE_HOME/appsutil/jre directory.

MOS:
  * Using JDK 6.0 Latest Update with Oracle E-Business Suite Release 12.2 (Doc ID 1459546.1)

Section 8: Upgrading to Latest JRE 6.0 on Database Tier Node
=== Step 8.1: Download Latest JRE 6.0 Update ===
Linux	JRE 6.0 Update 17 or higher	Java SE Downloads on My Oracle Support Knowledge Document 1439822.1

A patch that has "JDK" in the description contains both the JDK and the JRE deliverables.

  #138237	Oracle JDK 6 Update 85

Oracle JDK 6 Update 85 (Patch)
p19138237_16085_Linux-x86-64.zip	173.0 MB MD5	E7D195C945158E3C47F7AB38570A2E28

{{{
$ md5sum p19138237_16085_Linux-x86-64.zip
e7d195c945158e3c47f7ab38570a2e28  p19138237_16085_Linux-x86-64.zip
}}}

=== Step 8.2: Replace JRE Home Used With Oracle E-Business Suite Release 12.2 ===

{{{
$ mkdir $ORACLE_HOME/appsutil
$ cp jre-6u85-linux-x64.bin $ORACLE_HOME/appsutil
$ cd $ORACLE_HOME/appsutil
$ pwd
/u01/oracle/VIS/11204/appsutil
$ ./jre-6u85-linux-x64.bin
$ mv jre1.6.0_85 jre
}}}

== 9. Ensure Applications patching cycle is complete ==

Now on app tier.

{{{
$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished		  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE     COMPLETED	    20-OCT-14 16:39:29 +02:00	   20-OCT-14 16:57:48 +02:00	  0:18:19
APPLY	    COMPLETED	    20-OCT-14 17:06:56 +02:00	   20-OCT-14 17:09:28 +02:00	  0:02:32
CUTOVER     COMPLETED	    20-OCT-14 17:14:50 +02:00	   20-OCT-14 17:32:45 +02:00	  0:17:55
FINALIZE    COMPLETED	    20-OCT-14 17:15:09 +02:00	   20-OCT-14 17:15:29 +02:00	  0:00:20
CLEANUP     COMPLETED	    20-OCT-14 17:32:56 +02:00	   20-OCT-14 17:33:52 +02:00	  0:00:56
}}}

The Status should all have COMPLETED value.

== 10. Shut down Applications server processes and database listener ==

On app tier:
{{{
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps
}}}

On DB tier:
{{{
$ cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
$ ./addlnctl.sh stop $ORACLE_SID
}}}

Make sure that you do not have the LOCAL_LISTENER initialization parameter set.

We do not use spfile
{{{
> show parameter spfi
NAME				     TYPE	 VALUE
  *----------------------------------- ----------- ------------------------------
spfile				     string
}}}

And we have
{{{
> show parameter local_listener
NAME				     TYPE	 VALUE
  *----------------------------------- ----------- ------------------------------
local_listener			     string	 VIS_LOCAL
}}}

So I just edit the init file and bounce the DB
{{{
$ cd $ORACLE_HOME/dbs
$ vim initVIS.ora
local_listener  = VIS_LOCAL
to
# local_listener  = VIS_LOCAL
$ sqlplus / as sysdba
> shutdown immediate
> startup
}}}

{{{
> show parameter local_listener
local_listener			     string
}}}

Ok.

== 11. Drop SYS.ENABLED$INDEXES (conditional) ==

{{{
> drop table sys.enabled$indexes;
ORA-00942: table or view does not exist
}}}

== 12. Prepare to upgrade ==
Ensure that the oratab file contains an entry for the database to be upgraded.

{{{
$ cat /etc/oratab
VIS:/u01/oracle/VIS/11204:N
}}}

And this is kind of misleading, because it should be also the DB we want to upgrade, let's change it to:
{{{
$ cat /etc/oratab
VIS:/u01/oracle/VIS/11.2.0:N
DUMMY:/u01/oracle/VIS/11204:N
}}}

== 13. Upgrade the database instance ==
The instructions for the database upgrade are outlined in Oracle Database Upgrade Guide 11g Release 2 (11.2) Chapters 3 and 4.

http://docs.oracle.com/cd/E18283_01/server.112/e17222/upgrade.htm


Perform the steps from the "Run the Pre-Upgrade Information Tool" section to the "Upgrade the Database Using the Database Upgrade Assistant" section of chapter 3 and any step in chapter 4 that is relevant to your environment.

=== Run the Pre-Upgrade Information Tool ===
Login to DB tier and source the current environment.
{{{
$ . /u01/oracle/VIS/11.2.0/VIS_`uname -n | awk -F"." '{print $1}'`.env
$ env | grep ORACLE_HOME
ORACLE_HOME=/u01/oracle/VIS/11.2.0
}}}

{{{
$ sqlplus / as sysdba
> SPOOL upgrade_info.log
> @/u01/oracle/VIS/11204/rdbms/admin/utlu112i.sql
> SPOOL OFF
}}}

Reviewing the results:
  *-> Real Application Clusters	 [upgrade]  INVALID
  *> Ignoring, not using RAC anyway

WARNING: --> Database is using a timezone file greater than version 14.
  *> ok, EBS is using v17

WARNING: --> Database contains INVALID objects prior to upgrade.
  *> ok, some apps packages

WARNING: --> Database contains schemas with objects dependent on DBMS_LDAP package.
  *> ok "Disregard warnings related to Network ACLs. AutoConfig manages all the E-Business Suite Network ACLs."

WARNING: --> JOB_QUEUE_PROCESS value must be updated
  *> this I will change

{{{
> show parameter job_queue_processes
job_queue_processes		     integer	 2
}}}

{{{
$ cd $ORACLE_HOME/dbs
$ vim initVIS.ora
job_queue_processes             = 2
to
job_queue_processes             = 12
> startup force
> show parameter job_queue_processes
job_queue_processes		     integer	 12
}}}


Oracle recommends gathering dictionary statistics prior to upgrading the database.
{{{
> EXECUTE dbms_stats.gather_dictionary_stats;
}}}

Just to summarise
{{{
> @valid
}}}

BANNER
  *-------------------------------------------------------------------------------
Oracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production
PL/SQL Release 11.2.0.3.0 - Production
CORE	11.2.0.3.0	Production
TNS for Linux: Version 11.2.0.3.0 - Production
NLSRTL Version 11.2.0.3.0 - Production


NAME
  *--------
VIS


COMP_NAME			    STATUS	    VERSION
  *---------------------------------- --------------- ---------------
Oracle Database Catalog Views	    VALID	    11.2.0.3.0
JServer JAVA Virtual Machine	    VALID	    11.2.0.3.0
Oracle Real Application Clusters    INVALID	    11.2.0.3.0
Oracle Database Packages and Types  VALID	    11.2.0.3.0
Oracle XML Database		    VALID	    11.2.0.3.0
Oracle Expression Filter	    VALID	    11.2.0.3.0
Oracle Database Java Packages	    VALID	    11.2.0.3.0
Oracle XDK			    VALID	    11.2.0.3.0
OLAP Analytic Workspace 	    VALID	    11.2.0.3.0
Oracle Multimedia		    VALID	    11.2.0.3.0
Spatial 			    VALID	    11.2.0.3.0
Oracle OLAP API 		    VALID	    11.2.0.3.0
OLAP Catalog			    VALID	    11.2.0.3.0
Oracle Text			    VALID	    11.2.0.3.0

  # rows selected.


OBJECT_NAME		       OWNER		    OBJECT_TYPE
  *----------------------------- -------------------- -------------------
FFP55429_01011900	       APPS		    PACKAGE BODY
FFP60280_01010001	       APPS		    PACKAGE BODY
FFP61161_01010001	       APPS		    PACKAGE BODY
FFP60342_01010001	       APPS		    PACKAGE BODY
OZF_EARNING_SUMMARY_MV	       APPS		    MATERIALIZED VIEW
FFP60342_01012008	       APPS		    PACKAGE BODY
FFP60342_01012009	       APPS		    PACKAGE BODY
FFP55409_01012007	       APPS		    PACKAGE BODY
FFP55409_01012011	       APPS		    PACKAGE BODY
FFP60342_01012006	       APPS		    PACKAGE BODY

  # rows selected.

=== Upgrade the Database Using the Database Upgrade Assistant ===

Source the new installed binaries
{{{
$ . oraenv
  *> DUMMY
$ export PERL5LIB=/u01/oracle/VIS/11204/perl/lib/5.10.0:/u01/oracle/VIS/11204/perl/lib/site_perl/5.10.0
$ export PATH=$ORACLE_HOME/perl/bin:$PATH
$ export ORA_NLS10=/u01/oracle/VIS/11204/nls/data/9idata
$ which dbua
/u01/oracle/VIS/11204/bin/dbua
}}}

  *> Make sure it is from the new binaries directory

{{{
$ dbua
Select Database: -> VIS, Oracle Home /u01/oracle/VIS/11.2.0
Do not configure DB with Enterprise Manager
}}}

We can see that the dbua has changed the oratab
{{{
$ cat /etc/oratab
DUMMY:/u01/oracle/VIS/11204:N
VIS:/u01/oracle/VIS/11204:N
}}}


=== After Upgrading to the New Release ===
Upgrade Statistics Tables Created by the DBMS_STATS Package
{{{
> EXECUTE DBMS_STATS.UPGRADE_STAT_TABLE('APPLSYS','FND_STATTAB');
}}}

== 14. Modify initialization parameters ==
MOS:
  * Database Initialization Parameters for Oracle E-Business Suite Release 12 (Doc ID 396009.1)

I am kind of fedup with this Doc. I have been reviewing it several times during 9i->10g ora 10g->11g upgrades, but reviewing it during 11.2.0.3 -> 11.2.0.4 seems too much. It should be done as a script to run anyway.

Skiping this.

|| Real Application Clusters || Oracle_Server.log || Failed ||
|| Oracle Text               || Oracle_Server.log || Failed ||

==== Fixing Oracle Text ====
MOS:
  * The STATUS Of Oracle Text In DBA_REGISTRY=INVALID; CTXSYS.DRIOPT Package Body Is INVALID - Compilation Errors = ORA-942 PLS-364: loop index variable 'COL' use is invalid (Doc ID 1499153.1)
  *  Oracle TEXT Installation is INVALID (Doc ID 1469094.1)

SELECT Comp_ID, Status, Version,Comp_Name FROM DBA_Registry ORDER by 1,2;

select object_name, object_type, status from dba_objects where owner='CTXSYS' and status != 'VALID' order by object_name;

OBJECT_NAME		       OBJECT_TYPE	   STATUS
  *----------------------------- ------------------- ---------------
DRIACC			       PACKAGE BODY	   INVALID

select owner,table_name,grantee,privilege from dba_tab_privs where table_name in ('UTL_FILE','DBMS_LOB','UTL_HTTP', 'DBMS_JOB', 'DBMS_SCHEDULER') order by 2,3;


alter package ctxsys.DRIACC compile body;
LINE/COL ERROR
  *------- -----------------------------------------------------------------
352/7	 PL/SQL: SQL Statement ignored
352/27	 PL/SQL: ORA-00942: table or view does not exist

MOS:
  * Can Not Validate CTXSYS.DRIACC Package (Doc ID 1906873.1)

To resolve this issue, please do the following:

connect /as sysdba

ALTER SESSION SET CURRENT_SCHEMA=SYS;
grant select on SYS.DBA_PROCEDURES to ctxsys;

ALTER SESSION SET CURRENT_SCHEMA=CTXSYS;
SET PAGESIZE 0
SELECT 'Calling ctx/admin/driacc.plb on ' || SYSTIMESTAMP FROM dual;
SET PAGESIZE 10

@@?/ctx/admin/driacc.plb;

@$ORACLE_HOME/rdbms/admin/utlrp.sql

set serveroutput on
execute sys.validate_context;

select comp_name, status, substr(version,1,10) as version from dba_registry where comp_id = 'CONTEXT';

  *--

OK, the last one helped.

{{{
> @valid
COMP_NAME			    STATUS	    VERSION
  *---------------------------------- --------------- ---------------
Oracle Text			    VALID	    11.2.0.4.0
}}}

== 15. Perform patch post-install instructions ==
Now, this is fun. We need to review the readme files of all the additional patches installed on top of 11.2.0.4 and see if there are some scripts that need to be run as post instalation step.

=== 11.2.0.4.3 PSU 18522509 ===
{{{
$ lynx 18522509/README.html
$ cd $ORACLE_HOME/rdbms/admin
$ pwd
/u01/oracle/VIS/11204/rdbms/admin
> @catbundle.sql psu apply
}}}

=== Oneoff patches ===

less 12949905/README.txt
none

less 16989137/README.txt
@?/sqlpatch/16989137/postinstall.sql

less 17402822/README.txt
none

less 17429475/README.txt
none

less 17501296/README.txt
{{{
> @?/sqlpatch/17501296/postinstall.sql
}}}

less 17629476/README.txt
{{{
> @?/sqlpatch/17629476/postinstall.sql
}}}

less 17944018/README.txt
{{{
> @?/sqlpatch/17944018/postinstall.sql
}}}

less 18118982/README.txt
none

less 18419770/README.txt
none

less 18614015/README.txt
{{{
> @?/sqlpatch/18614015/postinstall.sql
}}}

less 18665660/README.txt
none

less 18685209/README.txt
none

less 19233888/README.txt
none

less 4189542/README.txt
none

less 4247037/README.txt
{{{
> @?/md/admin/catmgdidcode
> @?/rdbms/admin/utlrp.sql
}}}

less 17912217/README.txt
none

{{{
> @valid
OBJECT_NAME		       OWNER		    OBJECT_TYPE
  *----------------------------- -------------------- -------------------
AD_ZD_PREP		       APPS		    PACKAGE BODY
FFP55429_01011900	       APPS		    PACKAGE BODY
FFP60280_01010001	       APPS		    PACKAGE BODY
FFP61161_01010001	       APPS		    PACKAGE BODY
FFP55409_01012011	       APPS		    PACKAGE BODY
FFP60342_01012006	       APPS		    PACKAGE BODY
FFP60342_01012008	       APPS		    PACKAGE BODY
FFP60342_01012009	       APPS		    PACKAGE BODY
FFP55409_01012007	       APPS		    PACKAGE BODY
FFP60342_01010001	       APPS		    PACKAGE BODY
}}}

  # rows selected.

What I do not like is the invalid AD_ZD_PREP

{{{
> alter package APPS.AD_ZD_PREP compile body;
Warning: Package Body altered with compilation errors.
}}}

SQL> show err
Errors for PACKAGE BODY APPS.AD_ZD_PREP:

LINE/COL ERROR
  *------- -----------------------------------------------------------------
419/3	 PL/SQL: SQL Statement ignored
419/19	 PL/SQL: ORA-00942: table or view does not exist
423/5	 PL/SQL: SQL Statement ignored
423/21	 PL/SQL: ORA-00942: table or view does not exist
457/5	 PL/SQL: SQL Statement ignored
457/21	 PL/SQL: ORA-00942: table or view does not exist

Looks like some grants are missing.

Copy adgrants.sql from old ORACLE_HOME to new.
OLD - /u01/oracle/VIS/11.2.0/appsutil/admin
NEW - /u01/oracle/VIS/11204/appsutil/admin

{{{
$ mkdir /u01/oracle/VIS/11204/appsutil/admin
$ cp /u01/oracle/VIS/11.2.0/appsutil/admin/adgrants.sql /u01/oracle/VIS/11204/appsutil/admin
> @?/appsutil/admin/adgrants.sql apps
}}}

{{{
> alter package APPS.AD_ZD_PREP compile body;
Package body altered.
}}}

{{{
> @?/rdbms/admin/utlrp.sql
> @valid
}}}

OBJECT_NAME		       OWNER		    OBJECT_TYPE
  *----------------------------- -------------------- -------------------
FFP55429_01011900	       APPS		    PACKAGE BODY
FFP60280_01010001	       APPS		    PACKAGE BODY
FFP61161_01010001	       APPS		    PACKAGE BODY
FFP60342_01010001	       APPS		    PACKAGE BODY
FFP55409_01012011	       APPS		    PACKAGE BODY
FFP60342_01012008	       APPS		    PACKAGE BODY
FFP60342_01012009	       APPS		    PACKAGE BODY
FFP55409_01012007	       APPS		    PACKAGE BODY
FFP60342_01012006	       APPS		    PACKAGE BODY

9 rows selected.

OK, those invalids were from the beginning.

== 16. Revoke ORA$BASE grant ==

{{{
> revoke use on edition ora$base from public;
}}}

== 17. Natively compile PL/SQL code (optional) ==
Not changing anything.

== 18. Start the new database listener (conditional) ==
Make sure that the listener binaries come from the new ORACLE_HOME

{{{
$ which lsnrctl
/u01/oracle/VIS/11204/bin/lsnrctl
}}}

{{{
$ lsnrctl start
> alter system register;
$ lsnrctl status
Service "VIS" has 1 instance(s).
Instance "VIS", status READY, has 1 handler(s) for this service...
}}}

I do not have any listener.ora configured.

== 19. Run adgrants.sql ==
Done already during invalid package troubleschooting.

== 20. Grant create procedure privilege on CTXSYS ==
Copy $AD_TOP/patch/115/sql/adctxprv.sql from the administration server node to the database server node.

From app tier:
{{{
$ scp $AD_TOP/patch/115/sql/adctxprv.sql oracle@ebsdb4:/u01/oracle/VIS/11204/appsutil/admin
}}}

On DB tier
{{{
$ cd /u01/oracle/VIS/11204/appsutil/admin
$ sqlplus apps/apps
> @adctxprv.sql [SYSTEM password] CTXSYS
so in my case
> @adctxprv.sql manager CTXSYS
}}}

== 21. Compile invalid objects ==

{{{
> @?/rdbms/admin/utlrp.sql
}}}

== 22. Set CTXSYS parameter ==

{{{
> exec ctxsys.ctx_adm.set_parameter('file_access_role', 'public');
}}}

== 23. Validate Workflow ruleset ==

I should be possible now to connect from app tier to DB.

On app tier:
{{{
$ sqlplus apps/apps
SQL*Plus: Release 10.1.0.5.0 - Production on Wed Oct 22 12:28:18 2014
Connected to: Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production
}}}

Nice, it works.

{{{
$ cd $FND_TOP/patch/115/sql/
$ sqlplus [APPS user]/[APPS password] @wfaqupfix.sql [APPLSYS user] [APPS user]
so in my case
$ sqlplus apps/apps @wfaqupfix.sql APPLSYS APPS
}}}

== 24. Deregister the current database server (conditional) ==
Not changing port, host, SID, or database name. Doing nothing.

== 25. Implement and run AutoConfig ==

=== Implement and run AutoConfig in the new Oracle home on the database server node. ===

Login to DB tier.

http://docs.oracle.com/cd/V39571_01/current/acrobat/122ebssu.pdf

Section: "Enabling AutoConfig on a New Oracle Home"

==== 1. Copy AutoConfig to the RDBMS ORACLE_HOME ====

On the application tier
{{{
$ perl $AD_TOP/bin/admkappsutil.pl
$ scp /u01/oracle/VIS/fs2/inst/apps/VIS_sun4/admin/out/appsutil.zip oracle@ebsdb4:/u01/oracle/VIS/11204
}}}

On the DB tier
{{{
$ cd /u01/oracle/VIS/11204
$ unzip -o appsutil.zip
}}}

==== 2. Install Java Runtime Environment (JRE) on the Database tier ====
Done already

{{{
$ /u01/oracle/VIS/11204/appsutil/jre/bin/java -version
java version "1.6.0_85"
}}}

==== 3. Generate the Database Context File ====

{{{
$ perl /u01/oracle/VIS/11204/appsutil/bin/adbldxml.pl
Enter Hostname of Database server: ebsdb4
Enter Port of Database server: 1521
Enter SID of Database server: VIS
Enter Database Service Name: VIS
/u01/oracle/VIS/11204/appsutil/VIS_ebsdb4.xml
}}}

==== 4. Run AutoConfig on the Database tier ====

{{{
$ <RDBMS_ORACLE_HOME>/appsutil/bin/adconfig.sh contextfile=<context_file>
}}}

so in my case

{{{
$ /u01/oracle/VIS/11204/appsutil/bin/adconfig.sh contextfile=/u01/oracle/VIS/11204/appsutil/VIS_ebsdb4.xml
}}}

Now what has been created is the env file:
{{{
$ ls /u01/oracle/VIS/11204/VIS_ebsdb4.env
}}}

This can be included i .bash_profile to load the env every time you log in.

And network configuration
{{{
$ cd /u01/oracle/VIS/11204/network/admin/VIS_ebsdb4
}}}

Nice.

Shut down all processes, including the database and the listener, and restart them to load the new environment settings.

Shutting down the usual way.

{{{
$ lsnrctl stop
> shutdown immediate
}}}

Starting up the EBS way.
cd $ORACLE_HOME/appsutil/scripts/$CONTEXT_NAME
{{{
$ pwd
/u01/oracle/VIS/11204/appsutil/scripts/VIS_ebsdb4
}}}

./addbctl.sh start
./addlnctl.sh start $ORACLE_SID

If the database tier node is different from the Applications tier node, after running AutoConfig on the database tier, modify tcp.invited_nodes of the generated [TNS_ADMIN]/sqlnet.ora to include the Applications tier so that the Applications tier can connect to the database.

This
tcp.validnode_checking = yes
tcp.invited_nodes=(EBS2.remik.org, EBSDB2.remik.org)

Is somehow not created any more. And good. It was pissing everybody off.


=== Run AutoConfig on each application tier server node on both the Patch and Run APPL_TOP to update the system with the listener. ===

What has changed with the listener to run that? Anyway, I will do it.

When running AutoConfig on the Patch APPL_TOP, ignore all errors.

Login to app tier.

Run AutoConfig on run fs
{{{
$ . /u01/oracle/VIS/EBSapps.env run
RUN File System           : /u01/oracle/VIS/fs2/EBSapps/appl
PATCH File System         : /u01/oracle/VIS/fs1/EBSapps/appl
Sourcing the RUN File System ...
}}}

{{{
$ cd $ADMIN_SCRIPTS_HOME
$ pwd
/u01/oracle/VIS/fs2/inst/apps/VIS_sun4/admin/scripts
$ ./adautocfg.sh
}}}


{{{
$ . /u01/oracle/VIS/EBSapps.env patch
Sourcing the PATCH File System ...
}}}

{{{
$ cd $ADMIN_SCRIPTS_HOME
$ pwd
/u01/oracle/VIS/fs1/inst/apps/VIS_sun4/admin/scripts
$ ./adautocfg.sh
Ignoring errors.
}}}




== 26. Gather statistics for SYS schema ==

On app tier
{{{
$ scp $APPL_TOP/admin/adstats.sql oracle@ebsdb4:/u01/oracle/VIS/11204/appsutil/admin
}}}

On DB tier
{{{
$ cd /u01/oracle/VIS/11204/appsutil/admin
> alter system enable restricted session;
> @adstats.sql
> alter system disable restricted session;
}}}

== 27. Create Demantra privileges (conditional) ==
Not using Demantra, doing nothing.

== 28. Re-create custom database links (conditional) ==
If the Oracle Net listener in the 11.2.0 Oracle home is defined differently than the one used by the old Oracle home, you must re-create any custom self-referential database links that exist in the Applications database instance.
  *> it was not created differently, links should work fine.

Checking the links.
{{{
> column DB_LINK format a30
> select OWNER, db_link from dba_db_links;
OWNER			       DB_LINK
  *----------------------------- ------------------------------
CN			       ORACLE_APPS
APPS			       APPS_TO_APPS
APPS			       APPS_TO_APPS.REMIK.ORG
APPS			       APPS_TO_APPS.US.ORACLE.COM
APPS			       EDW_APPS_TO_WH
APPS			       EDW_APPS_TO_WH.REMIK.ORG
APPS			       EDW_APPS_TO_WH.US.ORACLE.COM
APPS			       SA0252
}}}

8 rows selected.

{{{
> connect apps
> select 'select * from global_name@'||DB_LINK||';' from user_db_links;
}}}

{{{
> select * from global_name@EDW_APPS_TO_WH;
}}}

GLOBAL_NAME
  *-------------------------------------------------------------------------------
VIS.REMIK.ORG

{{{
> select * from global_name@APPS_TO_APPS;
}}}

GLOBAL_NAME
  *-------------------------------------------------------------------------------
VIS.REMIK.ORG

Links work fine. No need to recreate them.

== WIP 29. Re-create grants and synonyms ==
On app tier.
{{{
$ adadmin
Error: Unable to execute statement <
Begin
ad_jar.get_jripasswords(:l_storepass, :l_keypass);
End;
> len = 63
}}}

AD Administration error:
ORA-01031: insufficient privileges
ORA-06512: at "SYS.DBMS_SESSION", line 114
ORA-06512: at "APPS.AD_JAR", line 17

What is that?

== 30. Restart Applications server processes ==
Login to app tier

cd $ADMIN_SCRIPTS_HOME
./adstrtal.sh apps/apps

== 31. Synchronize Workflow views ==

Log on to Oracle E-Business Suite with the "System Administrator" responsibility. Click Requests > Run > Single Request and the OK button. Enter the following parameters:

Request Name = Workflow Directory Services User/Role Validation
Batch Size = 10000
Fix dangling users = Yes
Add missing user/role assignments = Yes
Update WHO columns in WF tables = No
Click "OK" and "Submit".

http://sun4.remik.org:8000



== 6c. JAN2015 PSU requires some changes on app tier too ==
MOS:
  * Oracle E-Business Suite Releases 11i and 12 Critical Patch Update Knowledge Document (January 2015) (Doc ID 1954250.1)

Section 3: CPU Patches for Oracle E-Business Suite

=== Minimum Required Code Level to Apply CPU Patch ===

  #.2.3 Release Update Patch along with the R12.AD.C.DELTA.5 & R12.TXK.C.DELTA.5 roll-up patches.

=== CPU Patch ===
Before applying the CPU patch you must apply Oracle Database Patch 19393542.

We should have this patch already installed.

Check on DB node
$ $ORACLE_HOME/OPatch/opatch lsinventory | grep 19393542
Patch  19393542     : applied on Thu Feb 05 17:42:36 GMT 2015



==== Apply EBS Patch 19873050 ====
ORACLE APPLICATIONS RELEASE 12.2: CPU PATCH FOR JAN 2015 (Patch)
p19873050_12.2.0_R12_LINUX.zip	10.4 MB	MD5	9D9B07AB1F5357F13FA501F4FA8DD534






==== Run AutoConfig after applying the CPU patch. ====



=== ??? ===
Check:
  * Oracle Recommended Patches -- "Oracle JavaVM Component Database PSU" (OJVM PSU) Patches (Doc ID 1929745.1)




= Upgrading EBS to 12.2.4 patch =
MOS
  * Oracle E-Business Suite Release 12.2.4 Readme (Doc ID 1617458.1)
  * Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)
  * Oracle E-Business Suite Release 12.2: Online Patching FAQ (Doc ID 1583902.1)
  * http://balaoracledba.com/

Following Oracle E-Business Suite Release 12.2.4 Readme (Doc ID 1617458.1)

== Section 1: Preparation ==
OK.

== Section 2: Apply Required Database Patches ==
We just applied the 11.2.0.4 + PSU 11.2.0.4.3 + EBS required oneoff patches, but we can run the codechecker too.

EBS Database Codelevel Checker (Patch)
EBS Technology Codelevel Checker (Patch) Oct 17, 2014 7:39 PM
p17537119_R12_GENERIC.zip	MD5	37B83C8D0670FC419A232B38386636CA

{{{
$ cp p17537119_R12_GENERIC.zip /tmp
$ cd /tmp
$ md5sum p17537119_R12_GENERIC.zip
37b83c8d0670fc419a232b38386636ca  p17537119_R12_GENERIC.zip

$ unzip p17537119_R12_GENERIC.zip
}}}

Source DB env
{{{
$ ./checkDBpatch.sh
Enter ORACLE_HOME value : /u01/oracle/VIS/11204
Enter ORACLE_SID value : VIS

All the required one-offs are present in Oracle Database Home
}}}

OK, then it is fine.

== Section 3: Apply Consolidated Seed Table Upgrade Patch (Required) ==
Note: This step is applicable only for new installation customers and customers upgrading from Oracle E-Business Suite Release 12.2.2 to Release 12.2.4.

As this is an upgrade from 12.2.3 to 12.2.4 this should already been done.

Consolidated Seed Table Upgrade Patch 17204589:12.2.0 already applied
{{{
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17204589'
}}}

BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913913 17204589			  05-MAY-14

Doing nothing.

== Section 4: Apply the Latest AD and TXK Delta Release Update Packs ==
MOS:
  * Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)

Following Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)

=== Section 1: Preparation ===
OK, just bla bla.

=== Section 2: Apply Required Technology Patches ===
MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)

==== Section 1: Introduction ====
OK, usual introduction.

==== Section 2: Database Patches and Bug Numbers ====

I have already applied the PSU 11.2.0.4.3 and required overlay EBS patches by following: Database Patch Set Update Overlay Patches Required for Use with PSUs and Oracle E-Business Suite (Doc ID 1147107.1)

==== Section 3: Application Tier Technology Patches and Bug Numbers ====
Following: Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)

We used startCD RapidWizVersion Version 12.2.0.47

We already have:
R12.AD.C.Delta.4 Patch 17766337
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17766337';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
913966 17766337			  05-MAY-14

R12.TXK.C.Delta.4 Patch 17893964
> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17893964';
BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
914514 17893964			  05-MAY-14

Installed, so we go with Path B (Already using Oracle E-Business Suite Release 12.2 (below AD-TXK Delta 5 codelevel))

=== Section 3.2 Path B - Existing Release 12.2 Customers (Below AD-TXK Delta 5 Codelevel) ===

==== 1. Source the run edition environment file. ====
$ . /u01/oracle/VIS/EBSapps.env run

==== 2. Start new online patching cycle. ====
$ adop phase=prepare

==== 3. Apply the latest embedded application tier technology patches on the patch file system. ====

===== a. From a separate session, source the patch edition environment file. =====
$ . /u01/oracle/VIS/EBSapps.env patch

===== b. On the patch file system, apply the latest application tier technology patches =====
documented in 'Section 3: Application Tier Technology Patches and Bug Numbers' of My Oracle Support Knowledge Document 1594274.1, Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes.

Following: Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes. 1594274.1

====== Section 3.1: Forms and Reports 10.1.2.3 Patches and Bug Numbers ======

Login to app tier
{{{
Variable ORACLE_HOME should already be set to Forms and Reports 10.1.2.3 Home
$ echo $ORACLE_HOME
ORACLE_HOME=/u01/oracle/VIS/fs2/EBSapps/10.1.2
$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
}}}

======= <begin> opatch lsinventory =======
Oracle Interim Patch Installer version 1.0.0.0.64
Copyright (c) 2011 Oracle Corporation. All Rights Reserved..


Oracle recommends you to use the latest OPatch version
and read the OPatch documentation available in the OPatch/docs
directory for usage. For information about the latest OPatch and
other support-related issues, refer to document ID 293369.1
available on My Oracle Support (https://myoraclesupport.oracle.com)

Oracle Home           : /u01/oracle/VIS/fs2/EBSapps/10.1.2
Oracle Home Inventory : /u01/oracle/VIS/fs2/EBSapps/10.1.2/inventory
Central Inventory     : /u01/oraInventory
from               : /etc/oraInst.loc
OUI location          : /u01/oracle/VIS/fs2/EBSapps/10.1.2/oui
OUI shared library    : /u01/oracle/VIS/fs2/EBSapps/10.1.2/oui/lib/linux/liboraInstaller.so
Java location         : /u01/oracle/VIS/fs2/EBSapps/10.1.2/jdk/jre/bin/java
Log file location     : /u01/oracle/VIS/fs2/EBSapps/10.1.2/.patch_storage/<patch ID>/*.log

Creating log file "/u01/oracle/VIS/fs2/EBSapps/10.1.2/.patch_storage/LsInventory__10-22-2014_19-54-36.log"

Result:


Installed Patch List:
=====================
  # Patch  17907988 applied on Wed May 07 16:14:21 CEST 2014
Unique Patch ID:  17187922
[ Bug fixes: 17594101 7121788  ]
2) Patch  17645157 applied on Wed May 07 16:13:23 CEST 2014
Unique Patch ID:  16946372
[ Bug fixes: 17645157  ]
3) Patch  15900214 applied on Wed May 07 16:12:23 CEST 2014
Unique Patch ID:  16188428
[ Bug fixes: 15900214  ]
4) Patch  8943095 applied on Wed May 07 16:11:35 CEST 2014
Unique Patch ID:  12585530
[ Bug fixes: 8943095  ]
5) Patch  5659594 applied on Wed May 07 16:10:57 CEST 2014
Unique Patch ID:  16884798
[ Bug fixes: 5659594  ]
6) Patch  5604120 applied on Mon May 05 00:25:05 CEST 2014
Unique Patch ID:  16679014
[ Bug fixes: 5604120  ]
7) Patch  16778382 applied on Mon May 05 00:24:48 CEST 2014
Unique Patch ID:  16617640
[ Bug fixes: 16778382  ]
8) Patch  8300196 applied on Mon May 05 00:24:32 CEST 2014
[ Bug fixes: 8300196  ]
9) Patch  4047619 applied on Mon May 05 00:23:58 CEST 2014
Unique Patch ID:  16332416
[ Bug fixes: 4047619  ]
  #) Patch  17303472 applied on Mon May 05 00:23:42 CEST 2014
Unique Patch ID:  16746710
[ Bug fixes: 13913713 16181611 17234934 9876954 6166808 14321171 15976866 16052292 16399579 15828839 17065474 14260745 16832700 13864790 16598714 16537869 17064478 14170800 16778210 16300855 9818155  ]
[ This patch overlays patches " 14825718 " ]
[ This patch needs patches " 14825718 "  as prerequisites ]
  #) Patch  16275529 applied on Mon May 05 00:23:21 CEST 2014
Unique Patch ID:  15927809
[ Bug fixes: 10019002 5010130 12574386 12332340 10427365 8604052  ]
  #) Patch  16209520 applied on Mon May 05 00:22:13 CEST 2014
Unique Patch ID:  15910982
[ Bug fixes: 16209520  ]
  #) Patch  14825718 applied on Mon May 05 00:21:57 CEST 2014
Unique Patch ID:  15687652
[ Bug fixes: 9293220 6132689 7231982 12383263 8442155 12433970 7304653 7286928 7573720 8940272 7001328 8808264 5624555 13450923 12842412 9358044 7512736 8359788 7175618 5571663 9499728 6857221 6894576 5375851 14255151 7350891 8339004 7359193 8348570 7319888 5969391 7000696 13613107 7651246 10008235 8319129 11075260 8393944 8342525 7833659 1947595 11668256 9902558 7529909 7126045 7142365 10630609 9913966 6790720 9362676 6078303 6999812 8287889 9436383 12329307 7621923 6683962 9148117 9852403 8781507 10411388 10164084 9084276 9653703 8947375 13652243 8221857 9320023 10381273 5116235 14277452 6251633 7358376 11782681 3213707 8552429 9390538 11673568 6933210 8316127 9200985 8428638 7021759 6502349 8928753 11778609 8486421 12862243 10041239 13438826 5733397 10388906 5950737 9148124 13469105 7442879 6724714 7552880 7369690 8623626 8637879 7215354 9124173 8974551 8272078 14525012 7567072 12533753 8928735 6510297 6722224 13635555 9644309 7170999 12953856 9971961 12627468 13033652 11713521 6821297 6395358 7240862 6025516 7029083 9773298 13712140 6823259 7261996 8988492 8847739 9202767 5155021 14609039 6747939 7114153 4407272 6446152 7595761 14577216 6169108 7171994 9803561 6704955 7526041 8582519 5563375 8866722 11775668 7329300 8755926 8485711 10081297 8242418 11879934 12976004 7497460 6460568 7164050 9254095 8859958 12832774 12898344 13869488 10049103 6770810 14247708 7242694 14559906 7392832 13725522 7123031 6998181 5465339 9463433 6652955 7657973 6391947 8278813 4526825 9368437 6128859  ]
  #) Patch  14353879 applied on Mon May 05 00:20:17 CEST 2014
Unique Patch ID:  15321004
[ Bug fixes: 14353879  ]
  #) Patch  14374587 applied on Mon May 05 00:20:01 CEST 2014
Unique Patch ID:  15378031
[ Bug fixes: 14374587  ]
  #) Patch  10152652 applied on Mon May 05 00:19:17 CEST 2014
Unique Patch ID:  13212735
[ Bug fixes: 6497684 9726201 10152652  ]
  #) Patch  16241466 applied on Mon May 05 00:18:13 CEST 2014
Unique Patch ID:  15939719
[ Bug fixes: 8551790 16234436  ]
  #) Patch  14703419 applied on Mon May 05 00:17:40 CEST 2014
Unique Patch ID:  15916997
[ Bug fixes: 14703419  ]
  #) Patch  16271876 applied on Mon May 05 00:17:06 CEST 2014
Unique Patch ID:  15957907
[ Bug fixes: 16271876  ]
20) Patch  12848228 applied on Fri Nov 16 08:59:32 CET 2012
Unique Patch ID:  14066256
[ Bug fixes: 12848228  ]
21) Patch  12898423 applied on Fri Nov 16 08:52:39 CET 2012
Unique Patch ID:  14066493
[ Bug fixes: 12898423  ]
22) Patch  12887068 applied on Fri Nov 16 08:52:13 CET 2012
Unique Patch ID:  14066157
[ Bug fixes: 12887068  ]
23) Patch  12949905 applied on Fri Nov 16 08:51:30 CET 2012
Unique Patch ID:  14148564
[ Bug fixes: 12949905  ]
24) Patch  7695070 applied on Fri Nov 16 08:50:49 CET 2012
Unique Patch ID:  11489308
[ Bug fixes: 7695070  ]
25) Patch  12379038 applied on Fri Nov 16 08:49:45 CET 2012
Unique Patch ID:  13813443
[ Bug fixes: 12379038  ]
26) Patch  11780669 applied on Fri Nov 16 08:49:04 CET 2012
Unique Patch ID:  13706844
[ Bug fixes: 11780669  ]
27) Patch  9974899 applied on Fri Nov 16 08:46:06 CET 2012
Unique Patch ID:  14106915
[ Bug fixes: 7552946 4692585 6790178 7529830 6526074 9974899 8416899 6018059 6024000 6772953 7514592 7529859 5596834 6844221 9892569 5724681 7430171 6471931 5979883 5155185 6060499 5740055 6134487 6912781 6681624 5985742 4473073 7021360 4685283 4635520 6433471 5902630 9288120 7519011 6237650 7195030 5763122 5999450 6917549 6150541 5562810 6647933 9204863 5453754 6153975 5697416 5932346 5573438 7146872 7574599 6682888 7229577 9195865 6655345 6713795 5025985 9213612 7113141  ]
28) Patch  9273888 applied on Fri Nov 16 08:45:40 CET 2012
Unique Patch ID:  14106915
[ Bug fixes: 9273888  ]
29) Patch  8447875 applied on Fri Nov 16 08:45:14 CET 2012
Unique Patch ID:  14106915
[ Bug fixes: 6490362 8447875 8351021  ]
30) Patch  12828135 applied on Fri Nov 16 08:44:19 CET 2012
Unique Patch ID:  14106915
[ Bug fixes: 5220448 6350565 6079585 5458753 9655023 4175906 5901912 6864078 4486132 5896963 11725035 6647005 5095815 4519477 5347751 4691191 4754900 5861360 8290534 5382595 5071931 6370967 5458543 6607951 5179574 4329444 5029950 5464895 5029952 5029954 5738539 5648727 5352587 5631915 4402808 4871035 6455161 5114396 5091108 5584790 4605877 4751932 5751672 5490845 10080564 6753516 8534394 3345756 5933477 7592360 5094098 10183338 5015557 4679094 5675556 5154689 12828135 5222931 5910829 5754150 5227879 4152843 4661844 6079603 5637094 7044603 6016022 4905112 8290629 4581220 4166537 7120513 5276400 7154097 7154098 5408664 5563256 6395024 4146291 6397568 6854919 12419228 9108675 5901877 4768040 5049074 7022400 5960451 5490935 5049077 4542188 4680009 4593539 4555795 12565867 5406923 4359124 5689908 5258410 4969005 3962946 3743912 5648102 9352208 5057964 8836540 3935623 5014128 4873311 4439469 4331689 6705965 4597251 4903532 6055387 9764906 7576788 5650178 5225797 4047969 4554284 5376215 4874628 5401921 5151518 4458415 4700543 7375686 5226235 4900129 5122955 5095648 4561867 5239126 5869471 4712638 5354517 4925103 4745776 5998987 4939157 6404864 4627335 7300525 5501362 4587572 4969029 9119261 6270140 5055442 7334756 6639839 4492467 5222032 5151675 5242647 6999528 6737308 7137797 6864202 4587431 5605370 6647068 9952279 6826532 4335559 5417371 4671216 5065930 9362645 4575854 6130365 5355257 7173149 5243019 6639553 4966417 5884075 4899479 4610820 3837600 5092688 4528572 4449900 4601861 6009358 4226736 6404447 4348230 8785236 5233111 5644862 4197970  ]
31) Patch  12434128 applied on Fri Nov 16 08:42:23 CET 2012
Unique Patch ID:  14106915
[ Bug fixes: 9357234 7379127 9173023 8265594 7135493 12434128 7135488 8298232 9772332 9765884 7156655 7608327 7156648 8537027 9679852 7379122  ]
32) Patch  8528194 applied on Fri Nov 16 08:40:05 CET 2012
Unique Patch ID:  12333868
[ Bug fixes: 8528194  ]
33) Patch  8557019 applied on Fri Nov 16 08:37:31 CET 2012
Unique Patch ID:  11823436
[ Bug fixes: 8557019  ]
34) Patch  5261796 applied on Fri Nov 16 08:30:46 CET 2012
[ Bug fixes: 5261796 5056864 4598613 3662022  ]
35) Patch  8339196 applied on Fri Nov 16 08:29:45 CET 2012
Unique Patch ID:  11970373
[ Bug fixes: 8339196  ]
36) Patch  6400501 applied on Mon Dec 13 07:26:47 CET 2010
[ Bug fixes: 6400501  ]
37) Patch  5651245 applied on Fri Dec 10 00:03:33 CET 2010
[ Bug fixes: 5651245  ]
38) Patch  5394728 applied on Thu Mar 26 16:42:47 CET 2009
[ Bug fixes: 5394728  ]
39) Patch  3559326 applied on Thu Mar 26 16:42:23 CET 2009
[ Bug fixes: 3559326  ]
40) Patch  7140405 applied on Thu Mar 26 16:42:04 CET 2009
[ Bug fixes: 6116405 6764875  ]
41) Patch  6371228 applied on Thu Mar 26 16:41:41 CET 2009
[ Bug fixes: 6371228  ]
42) Patch  5917053 applied on Thu Mar 26 16:41:08 CET 2009
[ Bug fixes: 5917053  ]
43) Patch  7016961 applied on Thu Mar 26 16:40:17 CET 2009
[ Bug fixes: 7016961  ]




OPatch succeeded.

======= <end> opatch lsinventory =======

So it looks like I have applied some of the patches that are included in more recent RapidWiz 12.2.0.48 than was used during installation - because I did the upgrade to 12.2.3 before.

Just to check:
{{{
$ opatch lsinventory | grep -e 5659594 -e 8528194 -e 8943095 -e 15900214 -e 17645157 -e 17653437 -e 17907988 | grep Patch
  # Patch  17907988 applied on Wed May 07 16:14:21 CEST 2014
2) Patch  17645157 applied on Wed May 07 16:13:23 CEST 2014
3) Patch  15900214 applied on Wed May 07 16:12:23 CEST 2014
4) Patch  8943095 applied on Wed May 07 16:11:35 CEST 2014
5) Patch  5659594 applied on Wed May 07 16:10:57 CEST 2014
32) Patch  8528194 applied on Fri Nov 16 08:40:05 CET 2012
}}}

Missing:
  #653437

And including those currently not included in any startCD
  #186693
  #620223
  #434967

So we have 4 patches to install - we do the installation to patch edition.

======= + 17653437 =======
GETTING JAVA SERVER VM WARNING WITH 10.1.2 ORACLE_HOME EXE AND JDK 1.7.0_40 (Patch)
p17653437_10123_LINUX.zip	61.3 KB	MD5	579D823F4BBD08C09D0B41EC5C51F9D0

$ md5sum p17653437_10123_LINUX.zip
579d823f4bbd08c09d0b41ec5c51f9d0  p17653437_10123_LINUX.zip
$ unzip p17653437_10123_LINUX.zip
$ cd 17653437
$ opatch apply
Patch(es) 14703419,  conflict with the patch currently being installed (17653437).

  #653437 (see Footnote 6 & Footnote 8)
Footnote 8 - If a conflict is reported with 14703419, either roll back 14703419 first (opatch rollback, then apply 17653437), or allow opatch to roll it back when applying Patch 17653437.

OK, proceeding.



Relink the forms.
$ cd $ORACLE_HOME/forms/lib
$ make -f ins_forms.mk sharedlib install

======= + 18186693 =======
MERGE REQUEST ON TOP OF 10.1.2.3.2PSU FOR BUGS 17303472 7711752 16806432 (Patch)
p18186693_101232_LINUX.zip	4.7 MB	MD5	124414E306680C379F1E826C77101756

  #186693 (see Footnote 12)
Footnote 12 - This is the Forms Overlay Patch on 10.1.2.3.2. For a more recent Forms Overlay Patch 19434967 should be applied instead.

$ cd 18186693
$ opatch apply

SPECIAL INSTRUCTION FOR formsapp.ear
  *--------------------------------------------------------
To complete the application of Patch, please follow these instructions
for Application Server middle tier (including Forms/Reports Services):

  # cd $ORACLE_HOME/j2ee/OC4J_BI_Forms/applications/formsapp/formsweb/WEB-INF
2. cp orion-web.xml
(there is no such file, skipping that section.)

$ORACLE_HOME/j2ee/OC4J_BI_Forms/applications/orion-web.xml_pre9282569
3. cp web.xml $ORACLE_HOME/j2ee/OC4J_BI_Forms/applications/web.xml_pre9282569
4. Redeploy formsapp by executing the following command:
dcmctl redeployApplication -f $ORACLE_HOME/forms/j2ee/formsapp.ear -a formsapp
  *co OC4J _BI_Forms
5. Restart OC4J _BI_Forms

======= + 18620223 =======
APPS6: RECORD LOCKING SUSPENDING FIRING OF FORMULA-CALCULATION (Patch)
p18620223_101232_LINUX.zip	13.4 KB	MD5	7C937F34A4DE519F1650985E3EF6A960

$ cd 18620223
$ opatch apply

? Please make sure you have the latest OPATCH 10.1 via bug number 6880880

======= + 19434967 =======
MERGE REQUEST ON TOP OF 10.1.2.3.2PSU FOR BUGS 19059675 6161079 10226288 (Patch)
p19434967_101232_LINUX.zip	4.8 MB	MD5	1265E88888764BF284592833570414FF

$ cd 19434967
$ opatch apply





====== Section 3.2: Patches and bug numbers for Oracle Fusion Middleware (FMW) webtier 11.1.1.6 ======

$ . /u01/oracle/VIS/EBSapps.env patch
$ export ORACLE_HOME=$IAS_ORACLE_HOME
$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ which opatch
/RYBAK/oracle/VIS/fs2/FMW_Home/webtier/OPatch/opatch
/u01/oracle/VIS/fs2/FMW_Home/webtier/OPatch/opatch

$ opatch lsinventory
Oracle Home       : /RYBAK/oracle/VIS/fs2/FMW_Home/webtier
Oracle WebTier and Utilities CD                                      11.1.1.6.0
Interim patches (7)

We already have those from rapid install 46 and 47: 10638758, 13643211, 14616819, 16199894, 17325559

Installing those Not included in any startCD

$ env | grep FILE_EDITION
FILE_EDITION=patch


======= + 13055259 =======
REL6: BIFNDNEPM RUNTIME CUMULATIVE 11.1.1.6.31 PATCH 4 (Patch)
p13055259_111160_Linux-x86-64.zip	968.8 KB MD5	6D1BE19DE35D4575BBCE1355BAC9B41C

$ md5sum p13055259_111160_Linux-x86-64.zip
6d1be19de35d4575bbce1355bac9b41c  p13055259_111160_Linux-x86-64.zip
$ unzip p13055259_111160_Linux-x86-64.zip
$ cd 13055259
$ opatch apply

======= + 17555224 =======
OHSTLS 1.2 WITH CLIENT CERTIFICATE AUTHENTICATION (Patch)
p17555224_111160_Linux-x86-64.zip	1.6 MB	MD5	01191D25D7EEA2D31E6CB42AF34C02FA

$ md5sum p17555224_111160_Linux-x86-64.zip
01191d25d7eea2d31e6cb42af34c02fa  p17555224_111160_Linux-x86-64.zip
$ unzip p17555224_111160_Linux-x86-64.zip
$ cd 17555224
$ opatch apply

======= + 17639414 =======
PASTECONFIG FAILS IF SSL.CONF ENTRY IS COMMENTED IN HTTPD.CONF (Patch)
p17639414_111160_Generic.zip	11.2 KB	MD5	E904927678DB8980FFA2874235D53D52

$ md5sum p17639414_111160_Generic.zip
e904927678db8980ffa2874235d53d52  p17639414_111160_Generic.zip
$ unzip p17639414_111160_Generic.zip
$ cd 17639414
$ opatch apply -jre $ORACLE_HOME/jdk/jre

======= + 19945419 =======
MERGE REQUEST ON TOP OF 11.1.1.6.0 FOR BUGS 13055259 19848621 (Patch)
p19945419_111160_Linux-x86-64.zip	1.1 MB	MD5	49EE4BF830C51032E98D6362EAE12AD6

$ md5sum p19945419_111160_Linux-x86-64.zip
49ee4bf830c51032e98d6362eae12ad6  p19945419_111160_Linux-x86-64.zip
$ unzip p19945419_111160_Linux-x86-64.zip

$ cd 19945419
$ opatch apply -jre $ORACLE_HOME/jdk/jre


====== Section 3.2: Patches and bug numbers for Oracle Fusion Middleware (FMW) oracle_common 11.1.1.6 ======

$ . /u01/oracle/VIS/EBSapps.env patch
$ export ORACLE_HOME=`echo ${IAS_ORACLE_HOME} | sed 's/webtier/oracle_common/'`
$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ which opatch
/u01/oracle/VIS/fs2/FMW_Home/oracle_common/OPatch/opatch
$ opatch lsinventory
Oracle Home       : /u01/oracle/VIS/fs2/FMW_Home/oracle_common
Oracle AS Common Toplevel Component                                  11.1.1.2.0

Those present in 12.2.0.48 already included (installed during 12.2.3 patching)
$ opatch lsinventory | grep -e 9905685 -e 13947608 -e 17394319 | grep Patch
Patch  17394319     : applied on Wed May 07 16:19:59 CEST 2014
Patch  13947608     : applied on Wed May 07 16:19:32 CEST 2014
Patch  9905685      : applied on Wed May 07 16:19:05 CEST 2014

Not included (those from 12.2.0.49 and currently Not included in any startCD) 17284368, 19462638, 13490778, 18989444
======= + 17284368 =======
ORA-12516, TNS:LISTENER COULD NOT FIND AVAILABLE HANDLER WITH MATCHING PROTOCOL (Patch)
p17284368_111160_Generic.zip	180.1 KB	MD5	F08481C52A5DD9E5294BE81D4D3E02D4

$ md5sum p17284368_111160_Generic.zip
f08481c52a5dd9e5294be81d4d3e02d4  p17284368_111160_Generic.zip
$ cd 17284368

$ opatch apply -jre ${IAS_ORACLE_HOME}/jdk/jre



======= + 19462638 =======
MERGE REQUEST ON TOP OF 11.1.1.6.0 FOR BUGS 14588599 15998207 18515906 (Patch)
p19462638_111160_Generic.zip	167.6 KB	MD5	DF191C241BD1BE3C43582C00EEF17BD1

$ md5sum p19462638_111160_Generic.zip
df191c241bd1be3c43582c00eef17bd1  p19462638_111160_Generic.zip
$ cd 19462638
$ opatch apply -jre ${IAS_ORACLE_HOME}/jdk/jre


======= + 13490778 =======
PS5:REF2: INSTANCE STATUS SHOWN INCORRECTLY IN EM WITH RC4-REFRESH-2 (Patch)
p13490778_111160_Generic.zip	50.8 KB	MD5	EEF8916EEACFB5EC69C08B63B28087ED

$ md5sum p13490778_111160_Generic.zip
eef8916eeacfb5ec69c08b63b28087ed  p13490778_111160_Generic.zip
$ cd 13490778
$ opatch apply -jre ${IAS_ORACLE_HOME}/jdk/jre


======= + 18989444 =======

MERGE REQUEST ON TOP OF 11.1.1.6.0 FOR BUGS 13947608 14192016 (Patch)
p18989444_111160_Generic.zip	17.7 KB	MD5	7523E5664ED4908F22F266391464CF23

$ md5sum p18989444_111160_Generic.zip
7523e5664ed4908f22f266391464cf23  p18989444_111160_Generic.zip
$ cd 18989444
$ opatch apply -jre ${IAS_ORACLE_HOME}/jdk/jre


====== Section 3.4: Oracle Weblogic Server 10.3.6.0 Patch and Bug Numbers ======
$ . /u01/oracle/VIS/EBSapps.env patch

$ cd $FMW_HOME/utils/bsu
$ bsu.sh -report -bea_home=$FMW_HOME -output_format=text
Product Version........... 10.3.6.0

  #.2.0.48	17495356 CIH8 - already installed
$ bsu.sh -report -bea_home=$FMW_HOME -output_format=text | grep "Patch ID"
Patch ID.................. 32I2
Patch ID.................. YHJK
Patch ID.................. S9MN
Patch ID.................. LL4G
Patch ID.................. TTEM
Patch ID.................. VFS8
Patch ID.................. D33T
Patch ID.................. YIJF
Patch ID.................. CIH8

Installing those currently Not included in any startCD
$ env | grep FILE_EDITION
FILE_EDITION=patch

======= + 17893334 7FC9 =======
SU Patch [7FC9]: THE <TARGET> PATH IN PATCH-BACKUP.XML FILE DOES NOT CHANGE (Patch)
p17893334_1036_Generic.zip	1.5 MB	MD5	CDEA6178F75BE443C4D8F984D9D8EC78

$ md5sum p17893334_1036_Generic.zip
cdea6178f75be443c4d8f984d9d8ec78  p17893334_1036_Generic.zip
$ cp p17893334_1036_Generic.zip $FMW_HOME/utils/bsu/cache_dir/
$ cd $FMW_HOME/utils/bsu/cache_dir
$ unzip p17893334_1036_Generic.zip
$ rm p17893334_1036_Generic.zip README.txt
$ cd $FMW_HOME/utils/bsu
$ ./bsu.sh -prod_dir=$FMW_HOME/wlserver_10.3 -patchlist=7FC9 -verbose -install


======= + 19600486 Y5AP =======
SU Patch [Y5AP]: PASTECONFIG.SH FAILED AFTER ADDING SETMAXREQUESTPARAMTERCOUNT() ATTRIBUTE (Patch)
p19600486_1036_Generic.zip	7.3 MB	MD5	421FB4FCA21A30209897B8889BCDABEC

$ md5sum p19600486_1036_Generic.zip
421fb4fca21a30209897b8889bcdabec  p19600486_1036_Generic.zip
$ cp p19600486_1036_Generic.zip $FMW_HOME/utils/bsu/cache_dir/
$ cd $FMW_HOME/utils/bsu/cache_dir
$ unzip p19600486_1036_Generic.zip
$ rm p19600486_1036_Generic.zip README.txt
$ cd $FMW_HOME/utils/bsu
$ ./bsu.sh -prod_dir=$FMW_HOME/wlserver_10.3 -patchlist=Y5AP -verbose -install



===== c. Source the run edition environment file. =====

"The latest AD-TXK codelevel has a dependency on Oracle Fusion Middleware Patch 19462638."

Let's check it again.
$ . /u01/oracle/VIS/EBSapps.env patch
$ export ORACLE_HOME=`echo ${IAS_ORACLE_HOME} | sed 's/webtier/oracle_common/'`
$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ which opatch
/u01/oracle/VIS/fs2/FMW_Home/oracle_common/OPatch/opatch
$ opatch lsinventory | grep 19462638
Patch  19462638     : applied on Sun Jan 11 22:14:20 CET 2015

Logout.

Source the run edition environment file.
$ . /u01/oracle/VIS/EBSapps.env run

==== 4. Unzip patches and run adgrants. ====
===== a. Download and unzip the following patches: =====

$ cp p18283295_R12.AD.C_R12_LINUX.zip p20034256_R12.AD.C_R12_LINUX.zip p20075842_R12.AD.C_R12_GENERIC.zip p18288881_R12.TXK.C_R12_GENERIC.zip p20043910_R12.TXK.C_R12_GENERIC.zip p19803392_R12.TXK.C_R12_GENERIC.zip p20158287_R12.TXK.C_R12_GENERIC.zip p19259764_R12.FND.C_R12_GENERIC.zip $PATCH_TOP

$ cd $PATCH_TOP
$ md5sum *
cbb8d2c0bec8fbe9c577efd1814a14ec  p18283295_R12.AD.C_R12_LINUX.zip
b2ab4f599a070b730d4048bb7038003f  p18288881_R12.TXK.C_R12_GENERIC.zip
9b504769ba39378fa47dfa6b95899e04  p19259764_R12.FND.C_R12_GENERIC.zip
c4a6a85cffe9e0c7818b99e9a34f0b88  p19803392_R12.TXK.C_R12_GENERIC.zip
f3187d71bb4255d4854fc4af8f18ffed  p20034256_R12.AD.C_R12_LINUX.zip
8ca68b0148976e9df144aa4100318c96  p20043910_R12.TXK.C_R12_GENERIC.zip
db1f4ce092ebb158ea3ed707620d89ca  p20075842_R12.AD.C_R12_GENERIC.zip
ab01dcc314cb6219e9624228e0b7e119  p20158287_R12.TXK.C_R12_GENERIC.zip

unzip p18283295_R12.AD.C_R12_LINUX.zip
unzip p18288881_R12.TXK.C_R12_GENERIC.zip
unzip p19259764_R12.FND.C_R12_GENERIC.zip
unzip p19803392_R12.TXK.C_R12_GENERIC.zip
unzip p20034256_R12.AD.C_R12_LINUX.zip
unzip p20043910_R12.TXK.C_R12_GENERIC.zip
unzip p20075842_R12.AD.C_R12_GENERIC.zip
unzip p20158287_R12.TXK.C_R12_GENERIC.zip

===== b. Execute adgrants by following the instructions in the readme of Patch 20034256:R12.AD.C. =====
$ cd 20034256/admin
$ scp adgrants.sql oracle@usera1:/u01/oracle/VIS/11.2.0/appsutil/admin
$ scp adgrants.sql oracle@ebsdb4:/u01/oracle/VIS/11204/appsutil/admin

On DB node run adgrants
> @?/appsutil/admin/adgrants.sql apps

==== 5. Apply Patch 18283295:R12.AD.C.Delta.5 merged with Patch 20034256:R12.AD.C and Patch 20075842:R12.AD.C ====

$ env | grep EDITION
FILE_EDITION=run

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes

Failed to generate product JAR files in JAVA_TOP

JarSigner standard output:
jarsigner: Certificate chain not found for: VIS_sun4.  VIS_sun4 must reference a valid KeyStore key entry containing a private key and corresponding public key certificate chain.

MOS:
  * Patch Application Fails With Error: Jarsigner: Certificate Chain Not Found (Doc ID 555636.1)

$ . /u01/oracle/VIS/EBSapps.env patch
$ mv $APPL_TOP/admin/adkeystore.dat $APPL_TOP/admin/adkeystore.dat.org
$ adjkey -initialize

$ . /u01/oracle/VIS/EBSapps.env run
$ adop phase=apply patches=18283295,20034256,20075842 merge=yes
ERRORMSG: Since earlier patching session failed and you are invoking apply again, please specify 'abandon' or 'restart' parameter.

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes restart=yes

AutoPatch error:
Current 'patchtop' command-line argument not same as original value.
Original: "/u01/oracle/VIS/fs1/EBSapps/appl/admin/VIS/log/ADOP_MRG_20150111_1421012325"
Current : "/u01/oracle/VIS/fs1/EBSapps/appl/admin/VIS/log/ADOP_MRG_20150111_1421013171"

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes abandon=no restart=yes
AutoPatch error:
Current 'patchtop' command-line argument not same as original value.
Original: "/u01/oracle/VIS/fs1/EBSapps/appl/admin/VIS/log/ADOP_MRG_20150111_1421012325"
Current : "/u01/oracle/VIS/fs1/EBSapps/appl/admin/VIS/log/ADOP_MRG_20150111_1421013171"

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes abandon=yes restart=no
adop exiting with status = 0 (Success)

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes
This Patch seems to have been applied already.
Would you like to continue anyway  [N] ? N *

MOS:
  * How to bypass the error "This Patch seems to have been applied already. Would you like to continue anyway" when applying a patch via ADOP ? (Doc ID 1920187.1)

http://docs.oracle.com/cd/E26401_01/doc.122/e22954/T202991T531062.htm#5281339

The only way to bypass that is using the forceapply option.

$ adop phase=apply patches=18283295,20034256,20075842 merge=yes options=forceapply
adop exiting with status = 0 (Success)

==== 6. Apply Patch 18288881:R12.TXK.C.Delta.5 merged with Patch 20043910:R12.TXK.C, Patch 19803392:R12.TXK.C, and Patch 20158287:R12.TXK.C ====

$ adop phase=apply patches=18288881,20043910,19803392,20158287 merge=yes
adop exiting with status = 0 (Success)

==== 7. Apply Patch 19259764:R12.FND.C. ====

$ adop phase=apply patches=19259764
adop exiting with status = 0 (Success)

==== 8. Complete the online patching cycle by running the following commands in the order shown. ====

$ . /u01/oracle/VIS/EBSapps.env run
$ adop phase=finalize
$ adop phase=cutover
Relogin
$ . /u01/oracle/VIS/EBSapps.env run
$ adop phase=cleanup

[ERROR]     The EBS Technology Codelevel Checker (available as Patch 17537119) needs to be run on the following nodes: <ebsdb4>.

I believe I did it already, but I will repeat that with the recent version. On DB tier.
$ md5sum p17537119_R12_GENERIC.zip
f5603e3d73efa99f54a347e2aca294eb  p17537119_R12_GENERIC.zip
$ unzip p17537119_R12_GENERIC.zip
$ ./checkDBpatch.sh
Enter ORACLE_HOME value : /u01/oracle/VIS/11204
Is this a RAC environment [y/n] : n
Enter ORACLE_SID value : VIS

List of missing bug fixes:
  #393542

Looks like one additional DB bug has appeard.

Back to app tier.
$ adop phase=cleanup
~ 6h

==== 9. Synchronize file systems ====

$ adop phase=fs_clone
~ 2h

Done with: Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)





== Section 5: Perform Pre-Update Steps (Conditional) ==
Following: Oracle E-Business Suite Release 12.2.4 Readme (Doc ID 1617458.1)

Tasks only for: Supply Chain Management
  *> Skipping

== Section 6: Apply Oracle E-Business Suite 12.2.4 Release Update Pack ==

Chosing: Already using Oracle E-Business Suite Release 12.2.2 or 12.2.3	Path B

== 6.2 PathÂ B - Existing CustomersÂ (Release 12.2.2 or Release 12.2.3)Â upgrading to Oracle E-Business Suite 12.2.4 Release Update Pack ==

=== 1. Source the run edition applications environment ===
$ . /u01/oracle/VIS/EBSapps.env run

=== 2. Start an online patching cycle. ===
$ adop phase=prepare

ORACLE E-BUSINESS SUITE 12.2.4 RELEASE UPDATE PACK (Patchset)
p17919161_R12_LINUX_1of9.zip	402.6 MB	(422148953 bytes)
SHA-1	C4956E8251924BFF40B3ADFAF2A53BBA9F94A62A
MD5	5EDDFA3BCB47652FF236784CBF4A1A8B
p17919161_R12_LINUX_2of9.zip	498.8 MB	(523046115 bytes)
SHA-1	9B4021E26A8FE5D3D0887F9F8616985EEC79C66B
MD5	4AC9F85D6BEC42655F2C40730E5E72A3
p17919161_R12_LINUX_3of9.zip	485.9 MB	(509451855 bytes)
SHA-1	FB7CCC53AC58C882E720A15D596C0496FD856D4A
MD5	007626C25733A998DA413DF93DD4528D
p17919161_R12_LINUX_4of9.zip	520.2 MB	(545468978 bytes)
SHA-1	670D411CDDC359C56B95CA530C9256FE45E25753
MD5	2531E4A825699B992BB895AAAE440D13
p17919161_R12_LINUX_5of9.zip	573.2 MB	(601073495 bytes)
SHA-1	899137AC01C2BAC95F1254722EBC19F91E814DCC
MD5	F482834FA441A62CA771223C09B99981
p17919161_R12_LINUX_6of9.zip	564.2 MB	(591609251 bytes)
SHA-1	0684FD9DC29C4CF222389E04BA8CD6BF3E033ABA
MD5	2D4C5D9D7AC2FEA58CB8680899EF036D
p17919161_R12_LINUX_7of9.zip	498.5 MB	(522726073 bytes)
SHA-1	204CD9F3145C7A45B38296D99F2FEDAC9BFC4C64
MD5	FC8C751E8F2694E8FC4787FBCF711C53
p17919161_R12_LINUX_8of9.zip	544.0 MB	(570439034 bytes)
SHA-1	202160E9922296C0F8523B6C608B5325C55EA2CB
MD5	38C92E3DA5EE47A2B684A3FBC5120BC8
p17919161_R12_LINUX_9of9.zip	97.9 MB	(102613913 bytes)
SHA-1	8140D89B421344D82D83C4848FE90269AD8A9E9C
MD5	9450F037BCEAE901CBAACE3110D28E69

$ md5sum p17919161_R12_LINUX_*
5eddfa3bcb47652ff236784cbf4a1a8b  p17919161_R12_LINUX_1of9.zip
4ac9f85d6bec42655f2c40730e5e72a3  p17919161_R12_LINUX_2of9.zip
007626c25733a998da413df93dd4528d  p17919161_R12_LINUX_3of9.zip
2531e4a825699b992bb895aaae440d13  p17919161_R12_LINUX_4of9.zip
f482834fa441a62ca771223c09b99981  p17919161_R12_LINUX_5of9.zip
2d4c5d9d7ac2fea58cb8680899ef036d  p17919161_R12_LINUX_6of9.zip
fc8c751e8f2694e8fc4787fbcf711c53  p17919161_R12_LINUX_7of9.zip
38c92e3da5ee47a2b684a3fbc5120bc8  p17919161_R12_LINUX_8of9.zip
9450f037bceae901cbaace3110d28e69  p17919161_R12_LINUX_9of9.zip

unzip p17919161_R12_LINUX_1of9.zip
unzip p17919161_R12_LINUX_2of9.zip
unzip p17919161_R12_LINUX_3of9.zip
unzip p17919161_R12_LINUX_4of9.zip
unzip p17919161_R12_LINUX_5of9.zip
unzip p17919161_R12_LINUX_6of9.zip
unzip p17919161_R12_LINUX_7of9.zip
unzip p17919161_R12_LINUX_8of9.zip
unzip p17919161_R12_LINUX_9of9.zip

=== 3. Apply Oracle E-Business Suite Release 12.2.4 Patch 17919161. ===
$ adop phase=apply patches=17919161 patchtop=/STAGING/ebs12patches
~ 28h on both app and db tier on one disk

=== 4. Complete the online patching cycle by running the following commands in the order shown. ===
Weird thing happening on DB:


SID SQL_HASH_VALUE USERNAME	 OS PID

260	714380553		 6005
insert into obj$(owner#,name,namespace,obj#,type#,ctime,mtime,stime,status,remoteowner,linkname,subname,dataobj#,flags,oid$,spare1,spare2,spare3) values(:1,:2,:3,:4,:5,:6,:7,:8,:9,:10,:11,:12,:13,:14,

EVENT				WAIT_TIME USERNAME		SID    SERIAL# SQL_HASH_VALUE

latch free				0			 64	     5	    714380553

  *> Restarting DB after the patch is applied.
That helped :)


$ adop phase=finalize
$ adop phase=cutover
~ 1h on both app and db tier on one disk
$ . <INSTALL_BASE>/EBSapps.env run
$ adop phase=cleanup
~ 12h on both app and db tier on one disk

=== 5. Synchronize file systems ===
$ adop -status
Node Name	Node Type	Phase		Status		Started 		       Finished 		      Elapsed
  *-------------- --------------- --------------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE 	COMPLETED	14-JAN-15 21:26:21 +01:00      14-JAN-15 21:35:26 +01:00      0:09:05
APPLY		COMPLETED	14-JAN-15 22:02:23 +01:00      16-JAN-15 02:17:47 +01:00      28:15:24
FINALIZE	COMPLETED	16-JAN-15 10:06:28 +01:00      16-JAN-15 10:09:47 +01:00      0:03:19
CUTOVER 	COMPLETED	16-JAN-15 10:14:57 +01:00      16-JAN-15 11:13:19 +01:00      0:58:22
CLEANUP 	COMPLETED	16-JAN-15 11:30:43 +01:00      16-JAN-15 23:56:49 +01:00      12:26:06

$ adop phase=fs_clone
~ 2h

It is a good time to do the backp.

== Section 7: Post-Update Steps ==
=== 1. Apply Oracle E-Business Suite Release 12.2.4 Online Help ===

Oracle E-Business Suite Online Help for 12.2.4 Release Update Pack (Patch)
p17919162_R12_GENERIC.zip	31.8 MB	MD5	6E18D17EBF49496BD79BC324C8931496

HELP PATCH FOR ORACLE GRANTS ACCOUNTING USER GUIDE, RELEASE 12.2.4 (Patch)
p19290141_R12_GENERIC.zip	12.0 KB	MD5	337263CECA3D65898471EE6FBDE2B642

$ cd /STAGING/ebs12patches
$ md5sum p17919162_R12_GENERIC.zip p19290141_R12_GENERIC.zip
6e18d17ebf49496bd79bc324c8931496  p17919162_R12_GENERIC.zip
337263ceca3d65898471ee6fbde2b642  p19290141_R12_GENERIC.zip

$ unzip -o p17919162_R12_GENERIC.zip
$ unzip -o p19290141_R12_GENERIC.zip

$ adop phase=apply patches=17919162,19290141 hotpatch=yes merge=yes patchtop=/STAGING/ebs12patches

=== 2. Grant flexfield value set access to specific users (required) ===
  *> leaving that for dev team to decide how to use flexfileds security.

=== 3. Register new products (conditional) ===
New products available:
yms	Oracle Yard Management
cmi	Oracle In-memory Cost Management

If required that can be register them using License Manager.
  *> skipping for now

=== 4. Perform Product-Specific Steps (conditional) ===
Application Technology tasks:
Oracle Application Framework: -> for developers
Oracle E-Business Suite Integrated SOA Gateway -> not using SOA, skipping
Customer Relationship Management tasks: -> not using, skipping
Financials tasks: -> for developers
Human Resources tasks: -> for developers

=== 5. Perform NLS-related Step (conditional) ===
  *> using just default US. Doing nothing.

=== 6. Run the Patch Wizard for current recommended and high priority product patches. ===
MOS:
  * R11i / R12 : Patch Wizard Utility [Video] (Doc ID 976188.1)
  * Document 1400757.1, How to Find Oracle E-Business Suite Recommended Patches.

http://sun4.remik.org:8000

Receiving errors: FDPSTP failed due to ORA-20100

Skipping for now, thich can be checked later.

== Section 8: Apply Additional Critical Patches ==

8.1 Patches to Improve Connection Handling

All Customers

The following critical performance fixes resolve issues with connections not being released for return to the data source connection pool:

Patch 19494816 - Oracle Application Object Library

Patch 19807163 - Oracle Applications Manager

Patch 19858552 - Oracle Application Framework

8.2 Patch to Improve Results Caching

All Customers

Applying the following critical fix resolves an issue with efficiency of the database results cache, and may significantly improve response times.

Patch 19891697

8.3 Patch to Reduce Logging in Oracle Framework

All Customers

Applying the following fix to reduce log generation may improve overall performance:

Patch 18345006 - Oracle Application Framework

Installing in one adop session.

JDBC CONNECTION LEAK IN ORACLE.APPS.FND.COMMON.ERRORSTACK (Patch)
p19494816_R12.FND.C_R12_GENERIC.zip	320.5 KB MD5	4FC1F7ADC1029DAAE644EB977253790D

  #FF:12.2.4:TRANSACTIONSCOPE - CONNECTION LEAK IN 12.2.4 (Patch)
p19807163_R12.OAM.C_R12_GENERIC.zip	50.1 KB	MD5	3C95121B483D78B3A7B1208BDFC9FC14

WEB APPS CONTEXT NOT RELEASED IN OAERRORPAGE.JSP AND OAERRORDETAILPAGE.JSP (Patch)
p19858552_R12.FWK.C_R12_GENERIC.zip	318.5 KB MD5	4B0194FDE602D07808068F51A263DADD

  #FF:12.2:PERFORMANCE PROBLEMS RESULTS SET CACHE (Patch)
p19891697_R12.FND.C_R12_GENERIC.zip	25.3 KB	MD5	BE986CC5FB823F59E07CD6E099008E1A

JBO DEBUG LOGGING ON WITHOUT -D FLAG, NOTICE LEVEL AND PROD MODE=TRUE (Patch)
p18345006_R12.FWK.C_R12_GENERIC.zip	17.7 MB	MD5	A55406A21399C052DADE5A478B64EF1D

$ md5sum p19494816_R12.FND.C_R12_GENERIC.zip p19858552_R12.FWK.C_R12_GENERIC.zip p19807163_R12.OAM.C_R12_GENERIC.zip p19891697_R12.FND.C_R12_GENERIC.zip p18345006_R12.FWK.C_R12_GENERIC.zip
4fc1f7adc1029daae644eb977253790d  p19494816_R12.FND.C_R12_GENERIC.zip
4b0194fde602d07808068f51a263dadd  p19858552_R12.FWK.C_R12_GENERIC.zip
3c95121b483d78b3a7b1208bdfc9fc14  p19807163_R12.OAM.C_R12_GENERIC.zip
be986cc5fb823f59e07cd6e099008e1a  p19891697_R12.FND.C_R12_GENERIC.zip
a55406a21399c052dade5a478b64ef1d  p18345006_R12.FWK.C_R12_GENERIC.zip

$ unzip -o p19494816_R12.FND.C_R12_GENERIC.zip
$ unzip -o p19858552_R12.FWK.C_R12_GENERIC.zip
$ unzip -o p19807163_R12.OAM.C_R12_GENERIC.zip
$ unzip -o p19891697_R12.FND.C_R12_GENERIC.zip
$ unzip -o p18345006_R12.FWK.C_R12_GENERIC.zip

$ adop -status
sun4		master		PREPARE 	NOT APPLICABLE
APPLY		ACTIVE		24-MAR-15 13:26:16 +01:00      24-MAR-15 14:37:25 +01:00      1:11:09
FINALIZE	NOT APPLICABLE
CUTOVER 	NOT APPLICABLE
CLEANUP 	NOT STARTED

  *> that is weird, maybe this is ok if the patch was applied in hotpatch mode? The last one did.

$ adop phase=prepare
adop phase=prepare - Completed Successfully
$ adop -status
Node Name	Node Type	Phase		Status		Started 		       Finished 		      Elapsed
  *-------------- --------------- --------------- --------------- ------------------------------ ------------------------------ ------------
sun4		master		PREPARE 	COMPLETED	25-MAR-15 15:48:50 +01:00      25-MAR-15 17:02:04 +01:00      1:13:14
APPLY		NOT STARTED
FINALIZE	NOT STARTED
CUTOVER 	NOT STARTED
CLEANUP 	NOT STARTED

  *> looks fine now. Proceeding with patching.

$ adop phase=apply patches=19494816,19858552,19807163,19891697,18345006 patchtop=/STAGING/ebs12patches
$ adop phase=cutover

Done with the upgrade based on main Oracle E-Business Suite Release 12.2.4 Readme (Doc ID 1617458.1)



= Installing R12 12.2.4 on multinode MT and 2 node RAC =
http://okon1.remik.org:8005

== Download binaries ==
"File Name"
+ "V46139-01.zip"
+ "V46140-01.zip"
+ "V46243-01_1of3.zip"
+ "V46243-01_2of3.zip"
+ "V46243-01_3of3.zip"
+ "V35231-01_1of5.zip"
+ "V35231-01_2of5.zip"
+ "V35231-01_3of5.zip"
+ "V35231-01_4of5.zip"
+ "V35231-01_5of5.zip"
+ "V35230-01_1of2.zip"
+ "V35230-01_2of2.zip"
+ "V35812-01.zip"
+ "V35811-01.zip"
+ "V35810-01.zip"
+ "V35809-01.zip"
+ "V35808-01.zip"
+ "V35807-01.zip"
+ "V35806-01_1of3.zip"
+ "V35806-01_2of3.zip"
+ "V35806-01_3of3.zip"
+ "V35805-01_1of2.zip"
+ "V35805-01_2of2.zip"
+ "V35802-01.zip"
+ "V35804-01_1of2.zip"
+ "V35804-01_2of2.zip"
+ "V35803-01_1of3.zip"
+ "V35803-01_2of3.zip"
+ "V35803-01_3of3.zip"
+ "V35813-01.zip"
+ "V29856-01.zip"
+ "V29764-01.zip"
+ "V46241-01_1of9.zip"
+ "V46241-01_2of9.zip"
+ "V46241-01_3of9.zip"
+ "V46241-01_4of9.zip"
+ "V46241-01_5of9.zip"
+ "V46241-01_6of9.zip"
+ "V46241-01_7of9.zip"
+ "V46241-01_8of9.zip"
+ "V46241-01_9of9.zip"
+ "V46499-01.zip"
+ "V20223-01.zip"
+ "V29762-01_1of2.zip"
+ "V29762-01_2of2.zip"
+ "V29672-01_1of2.zip"
+ "V29672-01_2of2.zip"
"V36831-01.zip"
"V36830-01.zip"
"V36829-01.zip"
"V36833-01.zip"
"V36828-01.zip"
"V36824-01.zip"
"V36803-01.zip"
"V36827-01.zip"
"V36826-01.zip"
"V36832-01.zip"
"V36823-01.zip"
"V36822-01.zip"
"V36820-01.zip"
"V36819-01.zip"
"V36817-01.zip"
"V36816-01.zip"
"V36815-01.zip"
"V36805-01.zip"
"V36814-01.zip"
"V36813-01.zip"
"V36810-01.zip"
"V36811-01.zip"
"V36809-01.zip"
"V36812-01.zip"
"V36804-01.zip"
"V36801-01.zip"
"V36806-01.zip"
"V36825-01.zip"
"V36818-01.zip"
"V36802-01.zip"
"V36799-01.zip"
"V36800-01.zip"
"V36808-01.zip"
"V36807-01.zip"
"V36821-01.zip"
"V36798-01.zip"
"V46224-01.zip"
"V46223-01.zip"
"V46222-01.zip"
"V46226-01.zip"
"V46221-01.zip"
"V46217-01.zip"
"V46196-01.zip"
"V46220-01.zip"
"V46219-01.zip"
"V46225-01.zip"
"V46216-01.zip"
"V46215-01.zip"
"V46213-01.zip"
"V46212-01.zip"
"V46210-01.zip"
"V46209-01.zip"
"V46208-01.zip"
"V46198-01.zip"
"V46207-01.zip"
"V46206-01.zip"
"V46203-01.zip"
"V46204-01.zip"
"V46202-01.zip"
"V46205-01.zip"
"V46197-01.zip"
"V46194-01.zip"
"V46199-01.zip"
"V46218-01.zip"
"V46211-01.zip"
"V46195-01.zip"
"V46192-01.zip"
"V46193-01.zip"
"V46201-01.zip"
"V46200-01.zip"
"V46214-01.zip"
"V46191-01.zip"

== Setup hosts ==
=== Setup MT ===
  * setup a shared NFS directory between all MT hosts, this is where the binaries will be installed

# rsync -a --progress /STAGING/ebs12patches/*.zip /RYBAK/
Default NFS mount params 13.85MB/s,

nfs rw,bg,intr,hard,timeo=600,wsize=32768,rsize=32768,nfsvers=3,tcp,noacl,nolock
  #.71MB/s

=== Copying RAC nodes ===
/vmfs/volumes/datastore1
RAC_11.2.0.3_SE_OEL6.3_openfiler
RAC_11.2.0.3_SE_OEL6.3_rac1-user1a
RAC_11.2.0.3_SE_OEL6.3_usera2

/vmfs/volumes/piaty_4T

=== various stuff ===

MT
# echo "inventory_loc=/RYBAK/oraInventory" > /etc/oraInst.loc

=== Contents of /etc/hosts ===

=== Perform some sanity net throughput tests ===
Create 1G file

okon1 Local /
$ time dd if=/dev/zero of=./trash bs=1024 count=1048576
real	0m18.024s
  #73741824 bytes (1.1 GB) copied, 17.8473 seconds, 60.2 MB/s

okon1, NFS /RYBAK
$ time dd if=/dev/zero of=./trash bs=1024 count=1048576
  #73741824 bytes (1.1 GB) copied, 95.8137 seconds, 11.2 MB/s
real	1m35.930s
  *> this is too slow, 100Mb card network card used ???

How to check what is the network speed on Synology?

zen (VirtualBox on laptop), NFS /RYBAK
# time dd if=/dev/zero of=./trash bs=1024 count=1048576
skopiowane 1073741824 bajty (1,1 GB), 44,208 s, 24,3 MB/s
real	0m44.289s

okon2 (VirtualBox on laptop), NFS /RYBAK
# time dd if=/dev/zero of=./trash bs=1024 count=1048576
  #73741824 bytes (1.1 GB) copied, 33.5686 seconds, 32.0 MB/s
real	0m33.581s









== Create staging area ==
MOS:
  * Troubleshooting Rapid Install for E-Business Suite Release 12.2 (Doc ID 1378579.1)
  * MD5 Checksums for R12.2 Rapid Install Media (Doc ID 1505510.1)

Download the md5_linux.txt file.
$ md5sum --check md5_startCD_12.2.0.48.txt > md5sum_result.txt
$ cat md5sum_result.txt | grep -v OK
startCD/Disk1/rapidwiz/TechInstallers/DBInstallHome/fnd/admin/template/txkCfgDB11gR2_tmpl.xml: FAILED
(that is OK, we edit this file by hand)



Rapid Install Start Here (PartÂ 1Â ofÂ 3)	V46243-01 PartÂ 1Â ofÂ 3	3.1G
Rapid Install Start Here (PartÂ 2Â ofÂ 3)	V46243-01 PartÂ 2Â ofÂ 3	81M
Rapid Install Start Here (PartÂ 3Â ofÂ 3)	V46243-01 PartÂ 3Â ofÂ 3	97M

$ unzip V46243-01_1of3.zip
$ unzip V46243-01_2of3.zip
$ unzip V46243-01_3of3.zip

Run as root
# cd startCD/Disk1/rapidwiz
# ./RapidWizVersion
Version 12.2.0.48
# cd bin
# ./buildStage.sh
  #     Create new stage area
2.    Linux x86 (64-bit)
Specify the directory containing the zipped installation media:
/STAGING/oracle_EBS_R12.2.4_linux_x86-64
The set of zip files is complete.
  *> this will unzip the files

=== Now, lets see if there are any patches to RapidWiz ===
MOS:
  * Oracle E-Business Suite Release Notes, Release 12.2 (Doc ID 1320300.1)

Oracle recommends using the latest startCD (currently 12.2.0.49 - Patch 19378467) to install or upgrade to the latest Oracle E-Business Suite Release 12.2.0.

RI STARTCD 12.2.0.49 (Patch)
p19378467_R12_GENERIC_1of2.zip	2.0 GB	(2129316845 bytes)
MD5	1E4B1DAE98F72A964BFE67282060FBEF

p19378467_R12_GENERIC_2of2.zip	3.1 GB	(3289152372 bytes)
MD5	0636D61EE3B51FD43791430BA13EB098

$ unzip p19378467_R12_GENERIC_1of2.zip
$ unzip p19378467_R12_GENERIC_2of2.zip

$ cd startCD/Disk1/rapidwiz
$ ./RapidWizVersion
Version 12.2.0.49

# cd bin
# ./buildStage.sh
2.     Copy patches to existing stage area
2.    Linux x86 (64-bit)



# cd /STAGING/startCD/Disk1/rapidwiz
# ./rapidwiz

?? unable to add another app node. I am skipping this patch, more issues below.


== Installing RAC DB ==
=== Pre install check failures ===
==== RW-20013: Error: - Not enough free disk space on system: ====
There is already CRS installed
Now:
$ pwd
/u01
$ ls
app  _inst

Temp Space Check :
test using command: su oracle -c "touch /tmp/test.tst"
TEMP directory has write privileges:
Mount Point = /tmp

RW-20013: Error: - Not enough free disk space on system:
TEMP directory = /tmp
required = 2048.0
actual   = 7.28515625
  *> weird, /tmp is from root
# pwd
/tmp
[root@usera1 tmp]# df -h .
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/vg_rac1-lv_root
22G   14G  6.3G  69% /

==== cluvfy ====

# cat cluvfy_output.10571.lst
You must NOT be logged in as root (uid=0) when running /u01/app/11.2.0/grid/bin/cluvfy.
  *> :)

oracle@usera1
$ /u01/app/11.2.0/grid/bin/cluvfy stage -post crsinst -n usera1,usera2

ERROR:
PRVF-7617 : Node connectivity between "usera1 : 192.168.1.50" and "usera2 : 192.168.1.51" failed

ERROR:
PRVF-7617 : Node connectivity between "usera1 : 192.168.1.50" and "usera2 : 192.168.1.54" failed
TCP connectivity check failed for subnet "192.168.1.0"

$ /u01/app/11.2.0/grid/bin/cluvfy comp nodecon -i eth1 -n usera1,usera2
Verification of node connectivity was successful.

$ /u01/app/11.2.0/grid/bin/cluvfy comp nodecon -i eth0 -n usera1,usera2
ERROR:
PRVF-7617 : Node connectivity between "usera1 : 192.168.1.50" and "usera2 : 192.168.1.51" failed

ERROR:
PRVF-7617 : Node connectivity between "usera1 : 192.168.1.50" and "usera2 : 192.168.1.54" failed
TCP connectivity check failed for subnet "192.168.1.0"

He is trying somehow to reach IP for scan listener
$ crsctl stat res -t

Old Suff
$ srvctl remove database -d test11
$ srvctl remove database -d rac

Disable scan listener
$ crsctl stop res ora.LISTENER_SCAN2.lsnr
$ crsctl stop res ora.LISTENER_SCAN1.lsnr
$ crsctl stop res ora.LISTENER_SCAN3.lsnr

$ crsctl stop res ora.scan2.vip
$ crsctl stop res ora.scan1.vip
$ crsctl stop res ora.scan3.vip

# ifconfig -a
Shows no vip (too much? I wanted only to shutdown scan, not regular VIP??)

Anyway, again the check
$ /u01/app/11.2.0/grid/bin/cluvfy comp nodecon -i eth0 -n usera1,usera2




==== Port 1521 not free ====
Yes, I am running already CRS, which is using scan listener and VIP on 1521

# Private
  #2.168.255.50	usera1-priv.remik.org	usera1-priv
  #2.168.255.51	usera2-priv.remik.org	usera2-priv

# VIP
  #2.168.1.52	usera1-vip.remik.org	usera1-vip
  #2.168.1.53	usera2-vip.remik.org	usera2-vip

$ lsnrctl status

LSNRCTL for Linux: Version 11.2.0.3.0 - Production on 25-DEC-2014 22:41:25

Copyright (c) 1991, 2011, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
  *-----------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 11.2.0.3.0 - Production
Start Date                24-DEC-2014 10:45:53
Uptime                    1 days 11 hr. 55 min. 31 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/usera2/listener/alert/log.xml
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.51)(PORT=1521)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.53)(PORT=1521)))
Services Summary...

  *> Ichose different port pool: 5,6


=== Errors during installation: ===
==== RW-50004: An error has occured ====
$ less /u01/oracle/VIS/11.2.0/appsutil/log/VIS_usera1/12231454.log

Fatal Error: TXK Install Service

oracle.apps.fnd.txk.config.ProcessStateException: OUI process failed : Exit=253 See log for details. CMD= /STAGING/oracle_EBS_R12.2.4_linux_x86-64/TechInstallMedia/database/database/runInstaller -waitForCompletion -ignoreSysPrereqs -force -silent  -responseFile /u01/oracle/VIS/11.2.0/temp/VIS_usera1/cfgHome/response/DB_HOME/txkDB11gR2_11203.rsp

at oracle.apps.fnd.txk.config.OUIPatchActionNode.processState(OUIPatchActionNode.java:160)

at oracle.apps.fnd.txk.config.PatchActionNode.processState(PatchActionNode.java:187)

Cannot install Oracle Database Home

RW-50010: Error: - script has returned an error:   1
RW-50004: Error code received when running external process.  Check log file for details.


MOS:
  * Doc 1590656.1

Additional logs:
/u01/oracle/VIS/11.2.0/temp/VIS_usera1/logs/oracle.apps.fnd.txk.install0.log
CAUSE: The selected Oracle home contained directories or files.
ACTION: To start with an empty Oracle home, either remove its contents or choose another location.

What Oracle homes are installed in inventory?
$ cat /u01/app/oraInventory/ContentsXML/inventory.xml | grep "HOME NAME"
<HOME NAME="Ora11g_gridinfrahome1" LOC="/u01/app/11.2.0/grid" TYPE="O" IDX="1" CRS="true">
<HOME NAME="OraDb11g_home1" LOC="/u01/app/oracle/product/11.2.0/dbhome_1" TYPE="O" IDX="2">
<HOME NAME="Ora10g_rdbms" LOC="/u01/app/oracle/product/10.2.0/db_1" TYPE="O" IDX="3">
<HOME NAME="OraDb11g_home2" LOC="/u01/trash" TYPE="O" IDX="4">


Remove all Oracle Homesexcept the grid infra.
$ cd /STAGING/oracle11.2.0.4_x86-64/deinstall
$ ./deinstall -home /u01/trash
$ ./deinstall -home /u01/app/oracle/product/11.2.0/dbhome_1
$ ./deinstall -home /u01/app/oracle/product/10.2.0/db_1

$ cat /u01/app/oraInventory/ContentsXML/inventory.xml | grep "HOME NAME"
<HOME NAME="Ora11g_gridinfrahome1" LOC="/u01/app/11.2.0/grid" TYPE="O" IDX="1" CRS="true">

Still the same error:


I try tu run the install by hand
oracle.apps.fnd.txk.config.ProcessStateException: OUI process failed : Exit=253 See log for details. CMD= /STAGING/oracle_EBS_R12.2.4_linux_x86-64/TechInstallMedia/database/database/runInstaller -waitForCompletion -ignoreSysPrereqs -force -silent  -responseFile /u01/oracle/VIS/11.2.0/temp/VIS_usera1/cfgHome/response/DB_HOME/txkDB11gR2_11203.rsp

$ /STAGING/oracle_EBS_R12.2.4_linux_x86-64/TechInstallMedia/database/database/runInstaller -responseFile /u01/oracle/VIS/11.2.0/temp/VIS_usera1/cfgHome/response/DB_HOME/txkDB11gR2_11203.rsp
  *> Works fine

$ /STAGING/oracle_EBS_R12.2.4_linux_x86-64/TechInstallMedia/database/database/runInstaller -waitForCompletion -ignoreSysPrereqs -force -silent -responseFile /u01/oracle/VIS/11.2.0/temp/VIS_usera1/cfgHome/response/DB_HOME/txkDB11gR2_11203.rsp
CAUSE: The selected Oracle home contained directories or files.
ACTION: To start with an empty Oracle home, either remove its contents or choose another location.

[FATAL] [INS-13013] Target environment do not meet some mandatory requirements.
CAUSE: Some of the mandatory prerequisites are not met. See logs for details. /u01/app/oraInventory/logs/installActions2014-12-23_11-11-42PM.log
ACTION: Identify the list of failed prerequisite checks from the log: /u01/app/oraInventory/logs/installActions2014-12-23_11-11-42PM.log. Then either from the log file or from installation manual find the appropriate configuration to meet the prerequisites and fix it manually.

OK, so I should worry about the [FATAL]

==== task resolv.conf Integrity Failed ====
RVF-5637 : DNS response time could not be checked on following nodes: usera1,usera2
Cause:Â  An attempt to check DNS response time for unreachable node failed on nodes specified.

MOS:
  * PRVF-5637 : DNS response time could not be checked on following nodes (Doc ID 1480242.1)

==== [FATAL] [INS-13013] Target environment do not meet some mandatory requirements. ====
MOS:
  * config.sh in Silent Mode Fails With INS-13013: Target environment does not meet some mandatory requirements. (Doc ID 1925578.1)

$ /STAGING/oracle_EBS_R12.2.4_linux_x86-64/TechInstallMedia/database/database/runInstaller -waitForCompletion -ignoreSysPrereqs -force -silent -ignorePrereq -responseFile /u01/oracle/VIS/11.2.0/temp/VIS_usera1/cfgHome/response/DB_HOME/txkDB11gR2_11203.rsp

OK, we need to do some hacking
# cd /STAGING/oracle_EBS_R12.2.4_linux_x86-64/startCD/Disk1/rapidwiz
TechInstallers/DBInstallHome/fnd/admin/template/txkCfgDB11gR2_tmpl.xml:   <property name="s_OUIRunOptions"    value="-waitForCompletion -ignoreSysPrereqs -force -silent" instantiate="no" />

# cp TechInstallers/DBInstallHome/fnd/admin/template/txkCfgDB11gR2_tmpl.xml /var/tmp
# vim TechInstallers/DBInstallHome/fnd/admin/template/txkCfgDB11gR2_tmpl.xml
# diff TechInstallers/DBInstallHome/fnd/admin/template/txkCfgDB11gR2_tmpl.xml /var/tmp
  #c12
<    <property name="s_OUIRunOptions"    value="-waitForCompletion -ignoreSysPrereqs -force -silent -ignorePrereq" instantiate="no" />
  *--
>    <property name="s_OUIRunOptions"    value="-waitForCompletion -ignoreSysPrereqs -force -silent" instantiate="no" />

  * restoring scan VIP
  *> yes, that helped!!! With some hacking, but anyway it worked.

==== ora-01102 cannot mount database in exclusive mode ====
$ . VIS_usera1.env
$ env | grep SID
ORACLE_SID=VIS

  *> this should be VIS1?
$ export ORACLE_SID=VIS1


==== ORA-00132: syntax error or unresolved network name 'VIS1_LOCAL' ====
> startup
ORA-00119: invalid specification for system parameter LOCAL_LISTENER
ORA-00132: syntax error or unresolved network name 'VIS1_LOCAL'



==== OPatchActionNode.processState(OPatchActionNode.java:312) ====
oracle.apps.fnd.txk.config.ProcessStateException: OPatch process failed : Exit=1 See log for details. CMD= /u01/oracle/VIS/11.2.0/OPatch/opatch napply -
skip_subset -skip_duplicate -verbose -silent   -ocmrf /u01/oracle/VIS/11.2.0/temp/VIS_usera1/DBInstallHome/fnd/admin/template/txkForms_ocm.rsp  /u01/ora
cle/VIS/11.2.0/temp/VIS_usera1/patches/16342486/16342486/

at oracle.apps.fnd.txk.config.OPatchActionNode.processState(OPatchActionNode.java:312)

When running from hand
$ export ORACLE_HOME=/u01/oracle/VIS/11.2.0
$ /u01/oracle/VIS/11.2.0/OPatch/opatch napply -skip_subset -skip_duplicate -verbose -silent   -ocmrf /u01/oracle/VIS/11.2.0/temp/VIS_usera1/DBInstallHome/fnd/admin/template/txkForms_ocm.rsp  /u01/oracle/VIS/11.2.0/temp/VIS_usera1/patches/16342486/16342486/
/bin/java is not a valid executable for this platform. OPatch cannot proceed!

MOS: R122 installation failes

$ cd /u01/oracle/VIS/11.2.0/OPatch
$ ./opatch lsinventory
/bin/java is not a valid executable for this platform. OPatch cannot proceed!
OPatch returns with error code = 1

# cd /bin/
# ln -s /usr/bin/java

$ ./opatch lsinventory
Oracle Interim Patch Installer version 11.2.0.3.0
Copyright (c) 2012, Oracle Corporation.  All rights reserved.
Oracle Home            : /u01/oracle/VIS/11.2.0
Oracle Home Inventory  : n/a
OPatch version         : 11.2.0.3.0
Product information    : n/a
Log file location      : /u01/oracle/VIS/11.2.0/cfgtoollogs/opatch/opatch2014-12-25_23-27-22PM_1.log

Patch history file: /u01/oracle/VIS/11.2.0/cfgtoollogs/opatch/opatch_history.txt

Lsinventory Output file location : /u01/oracle/VIS/11.2.0/cfgtoollogs/opatch/lsinv/lsinventory2014-12-25_23-27-22PM.txt

  *-------------------------------------------------------------------------------
There are no Interim patches installed in this Oracle Home.

  *-------------------------------------------------------------------------------

OPatch succeeded.

Again the patching:

$ /u01/oracle/VIS/11.2.0/OPatch/opatch napply -skip_subset -skip_duplicate -verbose -silent   -ocmrf /u01/oracle/VIS/11.2.0/temp/VIS_usera1/DBInstallHome/fnd/admin/template/txkForms_ocm.rsp  /u01/oracle/VIS/11.2.0/temp/VIS_usera1/patches/16342486/16342486/




==== RW-50004: An error has occured ====
$ cd /u01/oracle/VIS/11.2.0/appsutil/log/VIS_usera1
$ less 12261002.log

Fatal Error: TXK Install Service

oracle.apps.fnd.txk.config.ProcessStateException: OPatch process failed : Exit=73 See log for details. CMD= /u01/oracle/VIS/11.2.0/OPatch/opatch napply -skip_subset -skip_duplicate -verbose -silent   -ocmrf /u01/oracle/VIS/11.2.0/temp/VIS_usera1/DBInstallHome/fnd/admin/template/txkForms_ocm.rsp  /u01/oracle/VIS/11.2.0/temp/VIS_usera1/patches/16342486/16342486/

at oracle.apps.fnd.txk.config.OPatchActionNode.processState(OPatchActionNode.java:312)

at oracle.apps.fnd.txk.config.PatchActionNode.processState(PatchActionNode.java:187)

  *> He is trying to patch the Oracle Home DB binaries, but there is none now - he did not istall them yet.

This with 49 rapid install.

Trying with 48



==== Cleanup ====
> show parameter db_name
  *> upewnij siÄ, Å¼e to na pewno baza, ktÃ³rÄ chcesz skasowaÄ :)
> alter system set cluster_database=FALSE scope=spfile; # if that is a RAC DB
> shutdown abort
> startup mount restrict
$ rman target /
> delete archivelog all;
> drop database;

$ cd /STAGING/oracle11.2.0.4_x86-64/deinstall
$ ./deinstall -home /u01/oracle/VIS/11.2.0

Remove entry from oratab (both nodes)
# vi /etc/oratab

# cat /u01/app/oraInventory/ContentsXML/inventory.xml | grep "HOME NAME"

Kill local listener if still running
  *> not needed, will be done during binaries deinstall

=== What IS working ===
  * RapidWiz 48 + Single node DB + Port pool 5,6
  * RapidWiz 48 + RAC DB + Port pool 5,6

With port pool different than default he is able to start the listener:
# ps -ef | grep tns
oracle    3072     1  0 Dec24 ?        00:00:01 /u01/app/11.2.0/grid/bin/tnslsnr LISTENER -inherit
oracle    3829     1  0 Dec24 ?        00:00:01 /u01/app/11.2.0/grid/bin/tnslsnr LISTENER_SCAN2 -inherit
oracle    3833     1  0 Dec24 ?        00:00:01 /u01/app/11.2.0/grid/bin/tnslsnr LISTENER_SCAN3 -inherit
oracle   13098     1  0 20:55 ?        00:00:00 /u01/oracle/VIS/11.2.0/bin/tnslsnr VIS -inherit

otherwise the Grid listener running on 1521 is blocking the port.

=== What is NOT working ===
  * RapidWiz 49 + RAC DB + Port pool or default
  * RapidWiz 49 + Single node DB + Port pool 5,6 or default

Issues:
  * He is trying to apply a patch to DB Oracle Home, but the binaries are not there yest
  * It is not possible to add another MT nodes



=== Post install issues ===
==== restart causes ORA-00119: invalid specification for system parameter LOCAL_LISTENER ====
> shutdown abort
ORACLE instance shut down.
SQL> startup mount restrict
ORA-00119: invalid specification for system parameter LOCAL_LISTENER
ORA-00132: syntax error or unresolved network name 'VIS_LOCAL'

$ env | grep TNS
(nothing)

$ . VIS_usera1.env
$ env | grep TNS
TNS_ADMIN=/u01/oracle/VIS/11.2.0/network/admin/VIS_usera1

Conclusion: Set properly the environment, not by just using oraenv.




== Installing MT ==
=== Pre install actions ===
==== + Very large CPu utilisation on DB tier by ologgerd ====
MOS:
  * Node Eviction due to OLOGGERD High CPU (Doc ID 1636942.1)

Apply Patch 13867435 -Â OLOGGERD USING A LOT OF RESOURCES on top of 11.2.0.3.
The bug is fixed in 11.2.0.4 GI PSU.

Checking GI
$ cd /u01/app/11.2.0/grid/OPatch
$ opatch lsinventory
Invoking OPatch 11.2.0.1.7
Oracle Grid Infrastructure                                           11.2.0.3.0
There are no Interim patches installed in this Oracle Home.

Downloading the one for 11.2.0.3.0
OLOGGERD USING A LOT OF RESOURCES (Patch)
p13867435_112030_Linux-x86-64.zip	156.7 MB MD5	6204BEE6197A14AE24A0511E16005938

$ md5sum p13867435_112030_Linux-x86-64.zip
6204bee6197a14ae24a0511e16005938  p13867435_112030_Linux-x86-64.zip
$ cd gi_patch_13867435
$ unzip p13867435_112030_Linux-x86-64.zip


Patching the OPatch
OPatch patch of version 11.2.0.3.6 for Oracle software releases 11.2.0.x (DEC 2013) (Patch)
p6880880_112000_Linux-x86-64.zip	31.5 MB	MD5	2AB78CB17174C3A49DF560F05E3352C6

Source GI env
$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ opatch version
OPatch Version: 11.2.0.1.7

$ cd /STAGING/oracle11.2.0.4_x86-64
$ md5sum p6880880_112000_Linux-x86-64.zip
2ab78cb17174c3a49df560f05e3352c6  p6880880_112000_Linux-x86-64.zip
# chmod g+w /u01/app/11.2.0/grid
$ mv $ORACLE_HOME/OPatch $ORACLE_HOME/OPatch_`/bin/date +%Y%m%d`
$ unzip -d $ORACLE_HOME p6880880_112000_Linux-x86-64.zip
$ opatch version
OPatch Version: 11.2.0.3.6
# chmod g-w /u01/app/11.2.0/grid

Actual patching - auto, as root
$ cd 13867435
$ pwd
/STAGING/oracle11.2.0.4_x86-64/13867435
$ cd /STAGING/oracle11.2.0.4_x86-64
$ /u01/app/11.2.0/grid/OPatch/ocm/bin/emocmrsp

$ which opatch
/u01/app/11.2.0/grid/OPatch/opatch

Run on both RAC nodes
# export PATH=$PATH:/u01/app/11.2.0/grid/OPatch
# opatch auto /STAGING/oracle11.2.0.4_x86-64/gi_patch_13867435 -ocmrf /STAGING/oracle11.2.0.4_x86-64/ocm.rsp


==== + Setup flashback DB ====

Archivelog?
> archive log list
Database log mode	       No Archive Mode
Automatic archival	       Disabled
Archive destination	       /u01/oracle/VIS/11.2.0/dbs/archive

Set archivelog mode
> alter system set log_archive_dest_1='location=+DATA' scope=spfile sid='*';
> shutdown immediate
> startup mount
> alter database archivelog;
> alter database open;

> archive log list
Database log mode	       Archive Mode
Automatic archival	       Enabled
Archive destination	       +DATA


Flashback DB?
> select FLASHBACK_ON from v$database;
FLASHBACK_ON
  *-----------------
NO

Configure flash recovery area
> alter system set DB_RECOVERY_FILE_DEST='+DATA' scope=spfile;
> alter system set DB_RECOVERY_FILE_DEST_SIZE=20000M scope=spfile;

Enable
> STARTUP MOUNT;
> ALTER SYSTEM SET DB_FLASHBACK_RETENTION_TARGET=4320; # 3 days
> ALTER DATABASE FLASHBACK ON;
> alter database open;

Test table
create table skarby (name varchar(50), value number, timestampid date not null, scn_number number) tablespace sysaux;
insert into skarby values ('after DB install',1, sysdate, userenv('commitscn'));
commit;

column name format a30
set linesize 200
column SCN_NUMBER format 999999999999999;
alter session set NLS_DATE_FORMAT = "YYYY/MM/DD HH24:MI:SS";
select * from skarby;

NAME				    VALUE TIMESTAMPID		    SCN_NUMBER
  *----------------------------- ---------- ------------------- ----------------
after DB install			1 2015/01/02 14:00:16	12204575949252


Show earliest SCN in the flashback database window
> SELECT OLDEST_FLASHBACK_SCN, OLDEST_FLASHBACK_TIME FROM V$FLASHBACK_DATABASE_LOG;

Show stats for every hour how much data has the flashback, redo and db to write.
> select * from V$FLASHBACK_DATABASE_STAT;

Creating restore point
> create restore point after_DB_install guarantee flashback database;


===== Going back to SCN =====
column name format a30
set linesize 200
column SCN_NUMBER format 999999999999999;
alter session set NLS_DATE_FORMAT = "YYYY/MM/DD HH24:MI:SS";
select * from skarby;

NAME				    VALUE TIMESTAMPID		    SCN_NUMBER
  *----------------------------- ---------- ------------------- ----------------
after DB install			1 2014/12/29 17:19:42	12204575951690

insert into skarby values ('failed 2 MT install',1, sysdate, userenv('commitscn'));
commit;

> select * from skarby;

NAME				    VALUE TIMESTAMPID		    SCN_NUMBER
  *----------------------------- ---------- ------------------- ----------------
after DB install			1 2014/12/29 17:19:42	12204575951690
failed 2 MT install			1 2015/01/02 13:08:07	12204580463127

Actuall rollback to SCN
> startup mount
> flashback database to restore point BEFORE_FAILOVER;
or
> flashback database to SCN 12204575951690;



==== I Prevent RW-50016: Error - {0} Was Not Created ====
MOS:
  * EBS R12.2.0 Installation on Oracle Linux 6 --Post Install Checks Error RW-50016: Error - {0} Was Not Created (Doc ID 1921643.1)

On DB odes, which are OEL 6

# vi /etc/security/limits.d/90-nproc.conf
# cat /etc/security/limits.d/oracle-ebs-server-R12-preinstall.conf
  *> here this is set correctly

The cause of the error is that there are not enough of resources devoted to app tiers (mainly RAM). See below, the same error is analysed.


=== Actuall install ===
During the DB installation the follwing messages were displayed:
# Configuration file written to: /u01/oracle/VIS/11.2.0/appsutil/conf_VIS.txt

Do this on all 3 MT nodes.
# vncserver
# cd /STAGING/oracle_EBS_R12.2.4_linux_x86-64/startCD/Disk1/rapidwiz
# ./rapidwiz

Provide configuration:


Weblogic Server Password: invent new password for Weblogic user
Apps OS User Password: this the Linux password for user applmgr.
Apps DB User Password: this the database password for user APPS, which is by default apps.

# Second File System logfile - /RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/logs/12262127.log


=== Cleanup (if there is a need to repeat the installation) ===

$ cd /RYBAK
$ mkdir trash_failed2_MT_install
$ mv oracle trash_failed2_MT_install/
$ mkdir oracle
$ mv oraInventory trash_failed2_MT_install/
$ mkdir oraInventory
$ chmod 777 oraInventory



=== Post install checks fails ===
==== First Install, 3 fails ====
Turns out that all the below failures are the result of too little resources for MT node.

I tried with 2500M for RAM, 1 CPU and it fails.

Works with min 5GB for RAM.

===== Virtual Directory =====
Virtual Directory
checking URL = http://okon1.remik.org:8005/OA_MEDIA/FNDLOGOL.gif
RW-50016: Error: - {0} was not created:
File = {1}   checking URL = http://okon1.remik.org:8005/OA_JAVA/oracle/apps/fnd/admin/server/server.xml
RW-50016: Error: - {0} was not created:
File = {1}   checking URL = http://okon1.remik.org:8005/OA_CGI/FNDWRR.exe
RW-50016: Error: - {0} was not created:
File = {1}

MOS:
  * Troubleshooting Rapid Install for E-Business Suite Release 12.2 (Doc ID 1378579.1)
  * EBS R12.2.0 Installation on Oracle Linux 6 --Post Install Checks Error RW-50016: Error - {0} Was Not Created (Doc ID 1921643.1)	To Bottom



===== Login Page =====
Login Page
checking URL = http://okon1.remik.org:8005/OA_HTML/AppsLogin
RW-50016: Error: - {0} was not created:
File = {1}

MOS:
  * Rapidwiz fails with RW-50016: Error: - {0} was not created: File = {1} (Doc ID 1491399.1)

Make sure that time is in sync on DB and MT tiers

===== JSP =====
JSP
checking URL = http://okon1.remik.org:8005/OA_HTML/jtfTestCookie.jsp
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.
JSP is not responding, waiting 15 seconds and retesting.




==== Second install, 1 fail ====
Only Login Page fails.

This time I used 5G RAM, 2 CPU for one MT node.

It was because of the time it took to generate the login page for the first time. Open a browser, let it generate and retest the issue. It should be fine.

http://okon1.remik.org:8005/OA_HTML/AppsLogin

=== Post install issues ===
==== + sqlplus VIS gives ORA-12505: TNS:listener ====
On MT okon1:

$ tnsping VIS
Attempting to contact (DESCRIPTION= (ADDRESS=(PROTOCOL=tcp)(HOST=usera1)(PORT=1526)) (CONNECT_DATA=(SID=VIS)))
OK (0 msec)

$ sqlplus apps@VIS
ORA-12505: TNS:listener does not currently know of SID given in connect

This is what autoconfig tries to use:

(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=YES)(FAILOVER=YES)(ADDRESS=(PROTOCOL=tcp)(HOST=usera-scan)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=VIS)))

#scan
# 192.168.1.54 192.168.1.55 192.168.1.56 usera-scan

Scan listener stopped working
$ ping usera-scan
$ nslookup usera-scan
$ nslookup usera-scan.remik.org
(all hangs)

Checking DNS (separate server)
# /etc/init.d/named restart

$ nslookup usera-scan
Server:		192.168.1.10
Address:	192.168.1.10#53

Name:	usera-scan.remik.org
Address: 192.168.1.54
Name:	usera-scan.remik.org
Address: 192.168.1.55
Name:	usera-scan.remik.org
Address: 192.168.1.56

  *> OK, works again, issue caused by DNS






==== - missing EBSApps.env ====
  *> Run autoconfig

$ ls /RYBAK/oracle/VIS
fs1  fs2  fs_ne

$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon1.env
$ env | grep FILE_EDITION
FILE_EDITION=run

$ . /RYBAK/oracle/VIS/fs2/EBSapps/appl/APPSVIS_okon1.env
$ env | grep FILE_EDITION
FILE_EDITION=patch

Running autoconfig.
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh

  *> Still nothing.

Repeating the MT installation. Because of the bug 13867435 the RAC DB was crashed somewehre during last node installation. All the post install MT checks were OK, but it looked weird.

==== + $ adop -status ORA-06550: line 6, column 2 ====

$ adop -status

Enter the APPS username: apps
Enter the APPS password:

where adop_session_id=;
= =
ERROR at line 6:
ORA-06550: line 6, column 23:
PL/SQL: ORA-00936: missing expression
ORA-06550: line 4, column 1:
PL/SQL: SQL Statement ignored

adop exiting with status = 1 (Fail)

Do not worry, looks like no adop cycle was run yet.

This will be corrected with first patch, or if you really want to you can run "empty" adop cycle:
$ adop phase=prepare
$ adop phase=cutover
$ adop phase=cleanup

$ adop -status
Node Name	Node Type	Phase	    Status	    Started			   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
okon1		master		PREPARE     RUNNING	    29-DEC-14 12:58:37 +01:00
APPLY	    NOT STARTED
CLEANUP     NOT STARTED
CUTOVER     NOT STARTED

okon2		slave		PREPARE     RUNNING	    29-DEC-14 12:58:37 +01:00
APPLY	    NOT STARTED
CLEANUP     NOT STARTED
CUTOVER     NOT STARTED

okon3		slave		PREPARE     RUNNING	    29-DEC-14 12:58:37 +01:00
APPLY	    NOT STARTED
CUTOVER     NOT STARTED
CLEANUP     NOT STARTED

==== + $ adop phase=prepare failed to create node-cmd.txt file Permission denied ====

To

$ adop phase=prepare
Fils on:
$ perl  /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl  verifyssh -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -hosts=okon1,okon2,okon3
ERROR DESCRIPTION:
(
failed to create node-cmd.txt file Permission denied
)

$ find ./ > file_list.txt
$ grep node-cmd.txt file_list.txt
./oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/node-cmd.txt
./oracle/VIS/fs1/inst/apps/VIS_okon2/logs/appl/rgf/TXK/node-cmd.txt
./oracle/VIS/fs1/inst/apps/VIS_okon3/logs/appl/rgf/TXK/node-cmd.txt

$ ls -l ./oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/node-cmd.txt
  *rw-r--r-- 1 root root 28 Dec 27 22:13 ./oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/node-cmd.txt

# chown -R applmgr:oinstall /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK
# chown -R applmgr:oinstall /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon2/logs/appl/rgf/TXK
# chown -R applmgr:oinstall /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon3/logs/appl/rgf/TXK

$ perl  /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl  verifyssh -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -hosts=okon1,okon2,okon3

Setup passwordless login from main MT node to all the others.

$ perl  /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkRunSSHSetup.pl  verifyssh -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -hosts=okon1,okon2,okon3
Logfile location /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/verifyssh.log
xml output = /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/out.xml
$ cat /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/logs/appl/rgf/TXK/verifyssh.log
  *> SSH equivalence setup verification completed successfully


==== Error while executing FS config clone on slave nodes ====



==== + Unable to open forms: FRM-92101: There was a failure in the Forms Server during startup ====
no response from runtime process

MOS:
  * R12: "FRM-92101:There was a failure in the Forms Server during startup" Error When Attempting to Launch Forms (Doc ID 454427.1)

$ pwd
/RYBAK/oracle/VIS/fs1/FMW_Home/webtier/lib32
$ ls -l ldflags
  *rw-r----- 1 applmgr oinstall 111 Dec 29 19:53 ldflags
$ diff /RYBAK/oracle/VIS/fs1/FMW_Home/webtier/lib/ldflags ldflags

  *> looks fine

MOS:
  * R12: "FRM-92101: There Was a Failure in the Forms Server During Startup" Error After Fresh R12 Installation (Doc ID 429627.1)

$ pwd
/RYBAK/oracle/VIS/fs1/EBSapps/10.1.2/forms/lib
$ make -f ins_forms.mk install

  *> This helps.

$ cd /RYBAK/oracle/VIS/fs2/EBSapps/10.1.2/forms/lib
$ make -f ins_forms.mk install

==== ORA-20008: No Concurrent Manager is defined that can run concurrent program ADZDPATCH ====
$ adop phase=prepare

SQL> SQL> Connected.
SQL> select AD_ZD_ADOP.WAIT_FOR_CP_TO_RUN(7437014) from dual
= =
ERROR at line 1:
ORA-20008: No Concurrent Manager is defined that can run concurrent program
ADZDPATCH
ORA-06512: at "APPS.AD_ZD_ADOP", line 248


MOS:
  * Oracle E-Business Suite Technology Stack and Applications DBA Release Notes for Release 12.2.3 (Doc ID 1606170.1)

In the adop prepare phase, an error message may state:
ORA-20008: No Concurrent Manager is defined that can run concurrent program ADZDPATCH.

Error details:This error does not appear consistently.
Related bug: 1004803
Workaround: Log in to the Concurrent Program Define form and ensure the executable is of "SQL*Plus" method. You can pick up the correct executable from the LOV, and save the correct definition

==== MOS: Enter the RUN file system context file name ====
Nice links:
  * Sharing The Application Tier File System in Oracle E-Business Suite Release 12.2 (Doc ID 1375769.1)
  * How To Automatically Set the Current Run or Patch Edition / File System for EBS 12.2 (Doc ID 1545584.1)
  * How To Avoid Entering The Apps Password For Every Autoconfig Run? (Doc ID 1546336.1)
  * Cloning Oracle E-Business Suite Release 12.2 with Rapid Clone (Doc ID 1383621.1)

Why I can not find the EBSenv file?

/RYBAK/oracle/VIS/EBSapps.env run

On last R12.2.2 install and upgrade to 12.2.3 this file came with

R12.TXK.C.DELTA.4 (Patchset)


==== adop cycle ====
$ adop phase=prepare
Failed.

Resart all the MT
$ adop phase=prepare
adop exiting with status = 0 (Success)
$ adop -status
Node Name	Node Type	Phase	    Status	    Started		   Finished			  Elapsed
  *-------------- --------------- ----------- --------------- ------------------------------ ------------------------------ ------------
okon1	master	PREPARE     COMPLETED	    01-JAN-15 07:34:03 +01:00	   01-JAN-15 09:07:28 +01:00	  1:33:25
okon2	slave	PREPARE     COMPLETED	    01-JAN-15 07:34:03 +01:00	   01-JAN-15 09:07:28 +01:00	  1:33:25
okon3	slave	PREPARE     RUNNING	    01-JAN-15 07:34:03 +01:00	   01-JAN-15 09:07:28 +01:00	  1:33:25

$ adop phase=cutover
[ERROR]     First run the tool for prepare and apply phases

That is probably because of the RUNNING status on okon3 node
$ adop -status
okon3	slave	PREPARE     FAILED	    01-JAN-15 07:34:03 +01:00	   01-JAN-15 09:07:28 +01:00	  1:33:25

Looking at adop logs
/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/3/prepare_20150101_193156/VIS_okon3/TXK_SYNC_migrate_Thu_Jan_1_20_55_28_2015$ less txkADOPPreparePhaseSynchronize_Thu_Jan_1_20_55_28_2015.log
=======FATAL ERROR =======
PROGRAM : (/RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPPreparePhaseSynchronize.pl)
TIME    : Thu Jan  1 20:58:36 2015
FUNCTION: main::migrateCloneComponentStage [ Level 1 ]
ERRORMSG: /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/bin/adclone.pl did not go through successfully.

Inreasing RAM to 4G


===== admanagedsrvctl.sh: exiting with status 1 =====
http://okon1.remik.org:7006/console
Username: weblogic

ERROR: Unable to start up the managed server oacore_server3
oacore_server3, State ADMIN
Control, Resume
oacore_server3, State RUNNING

===== Back to prepare =====
$ adop phase=prepare
adop exiting with status = 0 (Success)

$ adop -status
okon1		master		PREPARE     COMPLETED
okon2		slave		PREPARE     COMPLETED
okon3		slave		PREPARE     RUNNING

[STATEMENT] Node: <okon3>  Status: <failed>
$ less /RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/3/prepare_20150101_232959/VIS_okon3/TXK_SYNC_migrate_Thu_Jan_1_23_59_42_2015/wlsTechStack_FSCloneStageAppsTier_01020000.log

Copying /RYBAK/oracle/VIS/fs1/FMW_Home/webtier/inventory/Scripts to /RYBAK/oracle/VIS/fs1/EBSapps/comn/clone//prereq/webtier
Could not generate new Clone stage base area
RC-50007: Could not create cloning stage area at /RYBAK/oracle/VIS/fs1/EBSapps/comn/clone/
Raised by oracle.apps.ad.clone.util.CreateCloningStage

Looks like he tries to run a preclon and it fails.

===== Trying to run preclone =====

$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier

okon1 - ok
okon2 - ok
okon3 - ok

===== Again looking at logs from preclone, Failed to copy OUI library =====
$ less /RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/3/prepare_20150101_232959/VIS_okon3/TXK_SYNC_migrate_Thu_Jan_1_23_59_42_2015/wlsTechStack_FSCloneStageAppsTier_01020000.log

Testing if this home is s_weboh_oh...
This home is not s_weboh_oh...will procede with getOUI method...
Copy OUI from /RYBAK/oracle/VIS/fs1/EBSapps/10.1.2/oui/jlib to /RYBAK/oracle/VIS/fs1/EBSapps/comn/clone//jlib/oui/
RC-00012: Error while creating cloning stage area.
Failed to copy OUI library /RYBAK/oracle/VIS/fs1/EBSapps/10.1.2/oui/jlib to /RYBAK/oracle/VIS/fs1/EBSapps/comn/clone//jlib/oui/
Raised by oracle.apps.ad.clone.util.CreateCloningStage

Copy OUI from /RYBAK/oracle/VIS/fs1/EBSapps/10.1.2/oui/jlib to /RYBAK/oracle/VIS/fs1/EBSapps/comn/clone//jlib/oui/

And it looks like beeing copied.

MOS:
  * Oracle E-Business Suite Technology Stack and Applications DBA Release Notes for Release 12.2.3 (Doc ID 1606170.1)

Manually run the prepare phase on the slave node using the command:
$ adop phase=prepare allnodes=no action=nodb

Errors...

I will run the prepare manually on each node now.
$ adop phase=abort
okon1		master		PREPARE     SESSION ABORTED
okon2		slave		PREPARE     SESSION ABORTED
okon3		slave		PREPARE     SESSION ABORTED

okon1
$ adop phase=prepare allnodes=no action=db
fails
$ adop phase=abort

$ adop phase=prepare

No idea. Reinstalling everything. Now chosing all the same services on all the nodes.




=== Post install 3 ===
  * + $ adop phase=prepare failed to create node-cmd.txt file Permission denied
shutdown all MT
startup all MT

==== Error occurred while executing txkADOPEvalSrvStatus.pl ====
$ less /RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/2/adop_20150102_230602.log

$ perl /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPEvalSrvStatus.pl -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -patchcontextfile=/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -phase=prepare -promptmsg=hide -nodelist=okon1 -console=off -sessionid=2 -timestamp=20150102_230602 -outdir=/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/2/prepare_20150102_230602/VIS_okon1

$ perl /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPEvalSrvStatus.pl -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -patchcontextfile=/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -phase=prepare -nodelist=okon1 -sessionid=2 -timestamp=20150102_230602 -outdir=/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/2/prepare_20150102_230602/VIS_okon1

Program :  completed @ Sat Jan  3 00:39:24 2015
Returning FAILURE

  *> no errors in logs, just returning failure

Someone has similar issue
https://community.oracle.com/thread/3591770?start=0&tstart=0

$ adop phase=abort

This is still bothering me: Why I can not find the EBSenv file?

/RYBAK/oracle/VIS/EBSapps.env run

On last R12.2.2 install and upgrade to 12.2.3 this file came with

R12.TXK.C.DELTA.4 (Patchset)

I will try to install latest R12.TXK.C


==== Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 ====
MOS:
  * Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Doc ID 1617461.1)
  * Oracle E-Business Suite Release 12.2: Now Available - Essential Bundle Fixes for AD Delta 5 and TXK Delta 5 (Doc ID 1934471.1)

Path A: Installing a new Oracle E-Business Suite system

===== 1. Source the run edition environment file. =====
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon1.env
$ env | grep FILE_EDITION
FILE_EDITION=run

===== 2. Apply the latest application tier technology patches to the run file system. =====
Used rapid install 48, should be pretty current.

To avoid: [ERROR]     The EBS Technology Codelevel Checker needs to be installed on this instance. It is available as Patch 17537119.

I will run Codelevel Checker

On DB tier
$ cp /STAGING/ebs12patches/p17537119_R12_GENERIC.zip /tmp
$ cd /tmp

$ md5sum p17537119_R12_GENERIC.zip
f5603e3d73efa99f54a347e2aca294eb  p17537119_R12_GENERIC.zip

$ unzip p17537119_R12_GENERIC.zip

Source DB env
$ ./checkDBpatch.sh
Enter ORACLE_HOME value : /u01/oracle/VIS/11.2.0
on first node
Enter ORACLE_SID value : VIS1
on second node
Enter ORACLE_SID value : VIS2


===== 3. Start up only the Weblogic AdminServer service on the run edition application tier file system. =====
$ sh $ADMIN_SCRIPTS_HOME/adadminsrvctl.sh start

===== 4. Unzip patches and run adgrants. =====


AD R12.AD.C.DELTA.5 (Patchset)
p18283295_R12.AD.C_R12_LINUX.zip	3.2 MB	MD5	CBB8D2C0BEC8FBE9C577EFD1814A14EC

November Bundle Patches for AD Delta 5 (Patch)
p20034256_R12.AD.C_R12_LINUX.zip	1.3 MB	MD5	F3187D71BB4255D4854FC4AF8F18FFED

ADOP IS NOT DROPPING THE OLD INDEX IF A NEW INDEX IS PRESENT ON THE SAME COLUMNS (Patch)
p20075842_R12.AD.C_R12_GENERIC.zip	28.5 KB	MD5	DB1F4CE092EBB158EA3ED707620D89CA

R12.TXK.C.DELTA.5 (Patchset)
p18288881_R12.TXK.C_R12_GENERIC.zip	57.5 MB	MD5	B2AB4F599A070B730D4048BB7038003F

November Bundle Patches for TXK Delta 5 (Patch)
p20043910_R12.TXK.C_R12_GENERIC.zip	26.9 MB	MD5	8CA68B0148976E9DF144AA4100318C96

TST1226: ADD NODE PICKED EXISTING OHS INSTEAD OF CREATING NEW (Patch)
p19803392_R12.TXK.C_R12_GENERIC.zip	54.0 KB	MD5	C4A6A85CFFE9E0C7818B99E9A34F0B88

TST1226:FEW MANAGED SERVERS STARTED IN 'ADMIN' MODE (Patch)
p20158287_R12.TXK.C_R12_GENERIC.zip	16.8 KB	MD5	AB01DCC314CB6219E9624228E0B7E119

ERROR WHEN OPENING FORMS IN IE8 ON MULTI-NODE EBS 12.2.3 (Patch)
p19259764_R12.FND.C_R12_GENERIC.zip	316.0 KBMD5	9B504769BA39378FA47DFA6B95899E04

$ cp p18283295_R12.AD.C_R12_LINUX.zip p20034256_R12.AD.C_R12_LINUX.zip p20075842_R12.AD.C_R12_GENERIC.zip p18288881_R12.TXK.C_R12_GENERIC.zip p20043910_R12.TXK.C_R12_GENERIC.zip p19803392_R12.TXK.C_R12_GENERIC.zip p20158287_R12.TXK.C_R12_GENERIC.zip p19259764_R12.FND.C_R12_GENERIC.zip /RYBAK/oracle/VIS/fs_ne/EBSapps/patch

$ cd /RYBAK/oracle/VIS/fs_ne/EBSapps/patch
$ md5sum *
cbb8d2c0bec8fbe9c577efd1814a14ec  p18283295_R12.AD.C_R12_LINUX.zip
b2ab4f599a070b730d4048bb7038003f  p18288881_R12.TXK.C_R12_GENERIC.zip
9b504769ba39378fa47dfa6b95899e04  p19259764_R12.FND.C_R12_GENERIC.zip
c4a6a85cffe9e0c7818b99e9a34f0b88  p19803392_R12.TXK.C_R12_GENERIC.zip
f3187d71bb4255d4854fc4af8f18ffed  p20034256_R12.AD.C_R12_LINUX.zip
8ca68b0148976e9df144aa4100318c96  p20043910_R12.TXK.C_R12_GENERIC.zip
db1f4ce092ebb158ea3ed707620d89ca  p20075842_R12.AD.C_R12_GENERIC.zip
ab01dcc314cb6219e9624228e0b7e119  p20158287_R12.TXK.C_R12_GENERIC.zip

unzip p18283295_R12.AD.C_R12_LINUX.zip
unzip p18288881_R12.TXK.C_R12_GENERIC.zip
unzip p19259764_R12.FND.C_R12_GENERIC.zip
unzip p19803392_R12.TXK.C_R12_GENERIC.zip
unzip p20034256_R12.AD.C_R12_LINUX.zip
unzip p20043910_R12.TXK.C_R12_GENERIC.zip
unzip p20075842_R12.AD.C_R12_GENERIC.zip
unzip p20158287_R12.TXK.C_R12_GENERIC.zip

Execute adgrants by following the instructions in the readme of Patch 20034256:R12.AD.C.
$ cd /RYBAK/oracle/VIS/fs_ne/EBSapps/patch/20034256/admin

Copy that to db node
$ scp adgrants.sql oracle@usera1:/u01/oracle/VIS/11.2.0/appsutil/admin

On DB node run adgrants
> @?/appsutil/admin/adgrants.sql apps

===== 5. On the run edition application tier file system, use hotpatch mode to apply Patch 18283295:R12.AD.C.Delta.5 =====
This is performed outside of the usual adop patching cycle.

$ adop phase=apply patches=18283295,20034256,20075842 hotpatch=yes merge=yes
adop exiting with status = 0 (Success)


===== 6. On the run edition application tier file system, use hotpatch mode to apply Patch 18288881:R12.TXK.C.Delta.5 =====

$ adop phase=apply patches=18288881,20043910,19803392,20158287 hotpatch=yes merge=yes
adop exiting with status = 0 (Success)

And now!!! Finally we have
/RYBAK/oracle/VIS/EBSapps.env

===== 7. Apply Patch 19259764:R12.FND.C (conditional). =====
Skip this step if you are a new installation customer.
  *> Skipping

===== Source the run edition environment file. =====
$ . /RYBAK/oracle/VIS/EBSapps.env run


==== Again adop cycle ====
$ adop phase=prepare

Executing "txkADOPValidation" action in all nodes
[ERROR]     Node: "okon1"  Status: "failed"

ERROR: The following required ports are in use:
  *----------------------------
7007 : WLS Admin Server Port
Corrective Action: Free the listed ports and retry the adop operation.


$ telnet okon1 7007
Connected

Stop MT

$ telnet okon1 7007
Connected

?? What is listeneing on that port?
$ netstat -tulpn | grep 7007
tcp        0      0 192.168.1.29:7007           0.0.0.0:*                   LISTEN      13540/java
$ ls -l /proc/13540/exe
lrwxrwxrwx 1 applmgr oinstall 0 Jan  3 23:58 /proc/13540/exe -> /RYBAK/oracle/VIS/fs2/EBSapps/comn/util/jdk64/bin/java

Killed the processes.

Again.
$ adop phase=prepare
Data Dictionary Corruption Details - TS Mismatch

==== Data Dictionary Corruption Details - TS Mismatch ====
Data Dictionary Corruption Details - TS Mismatch
OWBSYS          HAB_RT_EXEC_PROC_RUN_METRICS                   OWBSYS          WB_RT_VERSION                                  TS mismatch: 16-SEP-10 09:13:44 26-NOV-12 18:48:19
OWBSYS          WB_RTI_OBJECT_CATALOG                          OWBSYS          WB_RT_VERSION                                  TS mismatch: 16-SEP-10 09:13:44 26-NOV-12 18:48:19
(...)
[HINT] Follow the instructions in "Fix data dictionary corruption"
section of My Oracle Support Knowledge Document 1531121.1 .

MOS:
  * Using the Online Patching Readiness Report in Oracle E-Business Suite Release 12.2 (Doc ID 1531121.1)

$ sqlplus apps/apps @$AD_TOP/patch/115/sql/adzddtsfix.sql
$ sqlplus apps/apps
> exec dbms_utility.invalidate(332021,NULL,0);
(...)
exec sys.utl_recomp.recomp_parallel

==== [UNEXPECTED]Error occurred while executing txkADOPPreparePhaseSynchronize.pl ====
[UNEXPECTED]Error occurred while executing "perl /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0
/patch/115/bin/txkADOPPreparePhaseSynchronize.pl -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/
admin/VIS_okon1.xml -patchcontextfile=/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -pro
mptmsg=hide -console=off -mode=migrate -sessionid=4 -timestamp=20150104_093934 -outdir=/RYBAK/oracle/VIS/fs_n
e/EBSapps/log/adop/4/prepare_20150104_093934/VIS_okon1"

/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/4/adop_okon1_20150104_093934.log

$ less /RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/4/prepare_20150104_093934/VIS_okon1/TXK_SYNC_migrate_Sun_Jan_4_11_06_46_2015/txkADOPPreparePhaseSynchronize_Sun_Jan_4_11_06_46_2015.log
=======FATAL ERROR =======
PROGRAM : (/RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPPreparePhaseSynchronize.pl)
TIME    : Sun Jan  4 11:10:25 2015
FUNCTION: main::migrateCloneComponentStage [ Level 1 ]

START: Creating WLS config archive.
Script Executed in 25922 milliseconds, returning status 255
ERROR: Script failed, exit code 255

MOS: START: Creating WLS config archive. ERROR: Script failed, exit code 255
  * R12.2 Adpreclone Fails When Creating WLS Config Archive : Exit Code 255 (Doc ID 1942015.1)

Restarting everything.

column HOST format a10
column DOMAIN format a10
> select NODE_NAME, NODE_MODE, NODE_ID, HOST, DOMAIN from apps.fnd_nodes order by NODE_NAME;
NODE_NAME		       N    NODE_ID HOST       DOMAIN
  *----------------------------- - ---------- ---------- ----------
AUTHENTICATION		       O      33105
OKON1			       O      33102 okon1      remik.org
OKON2			       O      33103 okon2      remik.org
OKON3			       O      33104 okon3      remik.org
USERA1			       O      32101 usera1     remik.org
USERA2			       O      32102 usera2     remik.org

Looks fine.

MOS: Adpreclone Errors On Patch Edition in 12.2.3 With Script failed, exit code 255 (Doc ID 1924636.1)

$ mkdir /RYBAK/temp

Add in profile:
export T2P_JAVA_OPTIONS="-Djava.io.tmpdir=/RYBAK/temp"

Again.
$ adop phase=prepare

perl /RYBAK/oracle/VIS/fs1/EBSapps/appl/ad/12.0.0/patch/115/bin/txkADOPPreparePhaseSynchronize.pl -contextfile=/RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -patchcontextfile=/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/appl/admin/VIS_okon1.xml -mode=migrate -sessionid=4 -timestamp=20150104_132716 -outdir=/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/4/prepare_20150104_132716/VIS_okon1

Still the same error:

START: Creating WLS config archive.
Script Executed in 37830 milliseconds, returning status 255
ERROR: Script failed, exit code 255


Checking the Admin Server logs
$ less /RYBAK/oracle/VIS/fs1/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/AdminServer/logs/AdminServer.out

<Jan 4, 2015 1:21:03 PM CET> <Notice> <WebLogicServer> <BEA-000360> <Server started in RUNNING mode>
oracle.as.management.opmn.optic.OpticBadConnectException: Could not get secure socket for host okon3.remik.org and port 6205
at oracle.as.management.opmn.optic.OpmnSSL.getSecureSocket(OpmnSSL.java:52)


MOS:
  * 12.2.3 Rapid Clone Fails With: Script failed, exit code 255 During WLS domain creation (Doc ID 1920683.1)

  # Remove the /tmp/.ovdlock.tmp file.
$ ls -l /tmp/.ovdlock.tmp
  *rw-r----- 1 applmgr oinstall 0 Dec 26 23:23 .ovdlock.tmp
$ rm /tmp/.ovdlock.tmp

Still the same error:

Trying autoconfig on all the MT nodes
$ . /RYBAK/oracle/VIS/EBSapps.env run
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh
AutoConfig completed successfully. - on all MT nodes

Starting MT on all the nodes

Aborting adop cycle
$ adop phase=abort
$ rm /tmp/.ovdlock.tmp

Trying to run preclone on all MT tiers
$ cd $INST_TOP/admin/scripts
$ perl adpreclone.pl appsTier
  *> All ok

Again
$ adop phase=prepare
Node okon2: COMPLETED
  * Prepare Status:    COMPLETED
Node okon1: COMPLETED
  * Prepare Status:    COMPLETED
Node okon3: COMPLETED
  * Prepare Status:    COMPLETED

adop exiting with status = 0 (Success)

OMG!!! Finally.

$ adop -status
okon1	master	PREPARE COMPLETED 04-JAN-15 17:38:30 +01:00      04-JAN-15 18:14:36 +01:00      0:36:06
okon2	slave	PREPARE COMPLETED 04-JAN-15 16:41:49 +01:00      04-JAN-15 17:27:35 +01:00      0:45:46
okon3	slave	PREPARE COMPLETED 04-JAN-15 17:40:47 +01:00      04-JAN-15 18:25:09 +01:00      0:44:22

$ adop phase=cutover
adop exiting with status = 0 (Success)

$ adop -status
Node Name	Node Type	Phase		Status		Started 		       Finished 	      Elapsed
  *-------------- --------------- --------------- --------------- ------------------------------ ------------------------------ ------------
okon1		master		PREPARE 	COMPLETED	04-JAN-15 17:38:30 +01:00      04-JAN-15 18:14:36 +01:00      0:36:06
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 18:36:54 +01:00      04-JAN-15 19:22:39 +01:00      0:45:45
CLEANUP 	NOT STARTED

okon2		slave		PREPARE 	COMPLETED	04-JAN-15 16:41:49 +01:00      04-JAN-15 17:27:35 +01:00      0:45:46
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 17:37:00 +01:00      04-JAN-15 18:22:12 +01:00      0:45:12
CLEANUP 	NOT STARTED

okon3		slave		PREPARE 	COMPLETED	04-JAN-15 17:40:47 +01:00      04-JAN-15 18:25:09 +01:00      0:44:22
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 18:36:56 +01:00      04-JAN-15 19:23:06 +01:00      0:46:10
CLEANUP 	NOT STARTED


$ adop phase=cleanup
$ adop -status

Current Patching Session ID: 5

Node Name	Node Type	Phase		Status		Started 		       Finished 	      Elapsed
  *-------------- --------------- --------------- --------------- ------------------------------ ------------------------------ ------------
okon1		master		PREPARE 	COMPLETED	04-JAN-15 17:38:30 +01:00      04-JAN-15 18:14:36 +01:00      0:36:06
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 18:36:54 +01:00      04-JAN-15 19:22:39 +01:00      0:45:45
CLEANUP 	COMPLETED	04-JAN-15 20:12:58 +01:00      04-JAN-15 20:13:45 +01:00      0:00:47

okon2		slave		PREPARE 	COMPLETED	04-JAN-15 16:41:49 +01:00      04-JAN-15 17:27:35 +01:00      0:45:46
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 17:37:00 +01:00      04-JAN-15 18:22:12 +01:00      0:45:12
CLEANUP 	COMPLETED	04-JAN-15 20:12:58 +01:00      04-JAN-15 20:13:45 +01:00      0:00:47

okon3		slave		PREPARE 	COMPLETED	04-JAN-15 17:40:47 +01:00      04-JAN-15 18:25:09 +01:00      0:44:22
APPLY		COMPLETED
FINALIZE	COMPLETED	04-JAN-15 18:37:15 +01:00      04-JAN-15 18:37:41 +01:00      0:00:26
CUTOVER 	COMPLETED	04-JAN-15 18:36:56 +01:00      04-JAN-15 19:23:06 +01:00      0:46:10
CLEANUP 	COMPLETED	04-JAN-15 20:12:58 +01:00      04-JAN-15 20:13:45 +01:00      0:00:47






==== Time to take a backup ====


==== Forms are not opening ====
I can login fine as sysadmin, but after going to
System Administrator / Requests /View
Just new window is opening with image Oracle E-businesssuite and that is it.

And it happens on browser that is able top open forms. Usually case is with end user client browser, as per:
  * Recommended Browsers for Oracle E-Business Suite Release 12 Doc ID 389422.1

http://okon1.remik.org:8005

What logs should I check?

First Apache logs:
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/diagnostics/logs/OHS/EBS_web_${TWO_TASK}

  *> Nothing.

Lets see weblogic console

http://okon1.remik.org:7006/console
http://okon1.remik.org:7007/console

  *> all servers running fine

Nice list to check on: http://tk-appsdba.blogspot.com/2011/02/oracle-apps-r12-forms-not-opening.html


===== Always check the DB, and alert log. =====
OK.
===== Check file system space. =====
OK.
===== Check Apache and Forms log. $LOG_HOME/10.1.3/Apache/Apache/logs and $LOG_HOME/10.1.2/forms/logs =====

I can find $LOG_HOME/ora/10.1.2/forms which is empty

===== If you are using R12 with IE8 then check Metalink doc 1069497.1, =====
for Cross Site Scripting(XSS) settings (make it to relevant tab of your internet options). Also check 389422.1 for recommended browsers and settings.

My browser was working already with R12


===== Check timestamp for files like $AU_TOP/resource/CUSTOM. , =====
this will tell you if someone has modified the pll and then the changes should be reverted back.

$ cd $AU_TOP/resource/
  *> nothing new

===== Try checking the form sessions from your server as below =====
$ ps -ef | grep frm

$ ps -ef | grep frm
applmgr   9066  3065  0 16:25 pts/1    00:00:00 grep frm
  *> Nothing

This will show the frmsrv and frmweb processes. If it doesn't then the issue is in spawning form session.

You can check the timestamp for frmsrv/frmweb executable, if this has got changed. You can relink this by below.
a. Source the Application environment
b. from location $ORACLE_HOME/forms/lib
run :- make -f ins_forms.mk install

  *--
How to restart only forms?
$ cd $ADMIN_SCRIPTS_HOME
$ ./adformsrvctl.sh start
Forms Connect Mode is set to Servlet. Please Change Forms Mode to socket and then run this script.

Checking the statup logs
$ cd $LOG_HOME/appl/admin/log/
$ less adstrtal.log
Web Application Services   oacore_server1                        admanagedsrvctl.sh         Started
Web Application Services   forms_server1                         admanagedsrvctl.sh         Started
Web Application Services   oafm_server1                          admanagedsrvctl.sh         Started
Web Application Services   forms-c4ws_server1                    admanagedsrvctl.sh         Started

$ cd $ADMIN_SCRIPTS_HOME
$ admanagedsrvctl.sh status forms_server1
Validated the passed arguments for the option ebs-get-serverstatus
forms_server1 is in RUNNING mode.

$ admanagedsrvctl.sh stop forms_server1
$ admanagedsrvctl.sh start forms_server1
$ ps -ef | grep frm
  *> nothing

Relink
$ cd $ORACLE_HOME/forms/lib
$ pwd
/RYBAK/oracle/VIS/fs2/EBSapps/10.1.2/forms/lib
$ make -f ins_forms.mk install

Restart
$ cd $ADMIN_SCRIPTS_HOME
$ admanagedsrvctl.sh stop forms_server1
$ admanagedsrvctl.sh start forms_server1
$ ps -ef | grep frm
  *> nothing

All MT restart
  *> nothing



===== In other case if from sessions are there and you are not able to open the form, then check the direct form login as below. =====
http://server:port/forms/frmservlet - for servlet mode
http://server:port/OA_HTML/frmservlet - for socket mode

http://okon1.remik.org:8005/forms/frmservlet - URL validation failed.
http://okon1.remik.org:8005/OA_HTML/frmservlet - URL validation failed.

http://okon1.remik.org:8005/forms/
Oracle Application Server 10g Forms Services
The Forms Listener servlet is up and running.

===== If above works then you can go to adadmin and compile jsps, or can have clear cache bounce. =====

$ adadmin
?? which option

$ $FND_TOP/patch/115/bin/ojspCompile.pl --compile --flush -p 2

===== If step 6 doesn't work then check for dbc file present at $FND_SECURE. =====
a. The file should have correct entries for Application Server Id, as it is in FND_NODES table.
b. All the passwords guest,applsyspub etc are ok, or change the guest password using FNDCPASS
c. You can correct the dbc file manually, or regenerate using  $COMMON_TOP/admin/install/adgendbc.sh
  *--

$ cd $FND_SECURE
  *> all seams fine

===== Bounce forms server and retry. =====

http://okon1.remik.org:8005/OA_HTML/jsp/fnd/aoljtest.jsp
Error 404--Not Found
Works after jsp recompilation!!!

http://okon1.remik.org:8005/OA_HTML/
WSRP Producer Test Page

MOS:
  * Oracle E-Business Suite R12 â Login Page showing a blank page Occuring Intermittently [ID 1491845.1]

Restart forms
$ cd $ADMIN_SCRIPTS_HOME
$ admanagedsrvctl.sh stop forms_server1
$ admanagedsrvctl.sh start forms_server1
  *> nothing

Shutdown MT

Relink
$ cd $ORACLE_HOME/forms/lib
$ make -f ins_forms.mk install

Startup MT
  *> nothing

===== There has got to be some logs about it =====
Apache
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/diagnostics/logs/OHS/EBS_web_${TWO_TASK}

MOS:
  * Troubleshooting Forms Applet issues in E-Business Suite (Doc ID 1300317.1)

This is bothering me
$ ps -ef | grep frm
  *> Nothing

Forms run-time process (11i - frmweb60 / R12 - frmweb) started by the Forms Server/Servlet and 'assigned' to the Forms Applet. Forms Server/Servlet not able to spawn a new Forms run-time child process [SERVER side issue].

I am using forms servlet now.

===== Applied all the required patches to DB and Forms and Reports =====
As advised by: Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1) - described in separate section.

The problem still remains.

MOS:
  * Troubleshooting Forms Applet issues in E-Business Suite (Doc ID 1300317.1)
  * How To Collect And Use Forms Trace (FRD) in Oracle Applications Release 12 (Doc ID 373548.1)

$ cp $FORMS_WEB_CONFIG_FILE /var/tmp
$ vi $FORMS_WEB_CONFIG_FILE
serverURL=/forms/lservlet
to
serverURL=/forms/lservlet/session

Latest file(s) in directory (recursively)
$ find . -type f -printf '%T@ %pn' | sort -n | tail -1 | cut -f2- -d" "

./fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/AdminServer/logs/AdminServer.log
./fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/oacore_server2/logs/oacore_server2.log
./fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/config/OPMN/opmn/states/.opmndat
./fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/diagnostics/logs/OHS/EBS_web_VIS/dms_metrics_29518_0.shm
./fs2/FMW_Home/webtier/instances/EBS_web_VIS_OHS1/diagnostics/logs/OHS/EBS_web_VIS/access_log
./fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/forms_server1/logs/forms_server1.log
./fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/forms-c4ws_server1/logs/forms-c4ws_server1.log
./fs_ne/inst/VIS_okon3/logs/appl/conc/log/VIS_0105.mgr
./fs_ne/inst/VIS_okon1/logs/appl/conc/log/FNDCPGSC2728674.txt
./fs_ne/inst/VIS_okon1/logs/appl/conc/log/FNDCPGSC2728673.txt

Nothing. Lets swich to socket mode

MOS:
  * Using Forms Socket Mode with Oracle E-Business Suite Release 12 (Doc ID 384241.1)

Section 2: Enabling Forms Socket Mode

Stop MT

$ cat $CONTEXT_FILE | grep s_formsport
<forms_port oa_var="s_formsport" oa_type="PORT" base="9000" step="1" range="-1" label="Forms Port">9006</forms_port>


Run the following command to enable Forms Socket Mode:
$ $FND_TOP/bin/txkrun.pl -script=ChangeFormsMode -contextfile=$CONTEXT_FILE -mode=socket -port=9006 -runautoconfig=No

Autoconfig
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh

Start MT

Check whether Forms Server is running:
$ cd $ADMIN_SCRIPTS_HOME
$ ./adformsrvctl.sh status
You are running adformsrvctl.sh  version 120.19.12020000.5
Checking status of FORMS Server (Socket Mode) ...
Forms Server (Socket) is running as PID  9514

So it looks I am running Forms in Server mode
$ ps -ef | grep frm
applmgr   9514     1  0 00:46 pts/1    00:00:00 frmsrv host okon1 port 9006 pool 1 exe frmweb log /RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/logs/ora/10.1.2/forms/socket.log em 1
applmgr   9526  9514  0 00:46 pts/1    00:00:00 frmweb webfile=5,0,okon1_9006,/RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/logs/ora/10.1.2/forms/socket.log

But the problem remains the same.

====== Enable some apache debugging ======

$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/config/OHS/EBS_web_${TWO_TASK}
$ vim httpd.conf
ErrorLog "|${ORACLE_HOME}/ohs/bin/rotatelogs ${ORACLE_INSTANCE}/diagnostics/logs/${COMPONENT_TYPE}/${COMPONENT_NAME}/error_log 86400"
LogLevel debug
OraLogMode apache

restart Apache
$ cd $ADMIN_SCRIPTS_HOME
./adapcctl.sh stop
./adapcctl.sh start

Checking logs
$ cd $FMW_HOME/webtier/instances/EBS_web_${TWO_TASK}_OHS1/diagnostics/logs/OHS/EBS_web_${TWO_TASK}

[Tue Jan 06 10:44:33 2015] [debug] mod_proxy_balancer.c(1012): proxy: Entering byrequests for BALANCER (balancer://oacorecluster_oajava)

Looks like this apache mode is spreading connections all over the MT nodes.

[Tue Jan 06 11:19:05 2015] [debug] proxy_util.c(2011): proxy: HTTP: has acquired connection for (okon3.remik.org)
[Tue Jan 06 11:19:05 2015] [debug] proxy_util.c(2067): proxy: connecting http://okon3.remik.org:7207/OA_HTML/classes/oracle/apps/fnd/jar/fndctx.jar to okon3.remik.org:7207
[Tue Jan 06 11:19:05 2015] [debug] proxy_util.c(2193): proxy: connected /OA_HTML/classes/oracle/apps/fnd/jar/fndctx.jar to okon3.remik.org:7207


http://okon1.remik.org:8005/OA_JAVA/oracle/apps/fnd/jar/fndforms.jar

====== Trying to troubleschoot the socket mode again ======
MOS:
  * How To Check If The Forms Server Is Configured In Servlet Or Socket Mode On 11i Or R12 (Doc ID 417216.1)

okon1
$ cat $CONTEXT_FILE | grep -i s_frmConnectMode
<forms_connect oa_var="s_frmConnectMode">socket</forms_connect>

okon2, okon3
$ cat $CONTEXT_FILE | grep -i s_frmConnectMode
<forms_connect oa_var="s_frmConnectMode">servlet</forms_connect>

So I got this confused. Changin it everywhere for consistency

Shutdown all MT

On okon2, okon3

Run the following command to enable Forms Socket Mode:
$ $FND_TOP/bin/txkrun.pl -script=ChangeFormsMode -contextfile=$CONTEXT_FILE -mode=socket -port=9006 -runautoconfig=No

Autoconfig
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh

On okon1, okon2, okon3
$ cat $CONTEXT_FILE | grep -i s_frmConnectMode
<forms_connect oa_var="s_frmConnectMode">socket</forms_connect>

Start all MT

MOS:
  * R12: Forms Runtime Diagnostics (FRD), Tracing And Logging For Forms In Oracle Applications (Doc ID 438652.1)

On all MT nodes
$ grep -e connectMode -e serverURL ./oracle/VIS/fs2/inst/apps/VIS_okon1/ora/10.1.2/forms/server/appsweb.cfg
serverURL=
connectMode=socket

Enabling tracing

$ vi /RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon1/ora/10.1.2/forms/server/appsweb.cfg
$ vi /RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon2/ora/10.1.2/forms/server/appsweb.cfg
$ vi /RYBAK/oracle/VIS/fs2/inst/apps/VIS_okon3/ora/10.1.2/forms/server/appsweb.cfg
# Sub argument for otherparams
from
record=
to
record=collect

Page with menu visible after loging:
http://okon1.remik.org:8005/OA_HTML/OA.jsp?OAFunc=OAHOMEPAGE

====== Going back to servlet mode ======
MOS:
  * Using Forms Socket Mode with Oracle E-Business Suite Release 12 (Doc ID 384241.1)

Section 3: Enabling Forms Servlet Mode

$ $FND_TOP/bin/txkrun.pl -script=ChangeFormsMode -contextfile=$CONTEXT_FILE -mode=servlet -runautoconfig=no

Autoconfig
$ cd $INST_TOP/admin/scripts
$ ./adautocfg.sh

Start MT

Page with menu visible after loging:
http://okon1.remik.org:8005/OA_HTML/OA.jsp?OAFunc=OAHOMEPAGE

Apache error log:
[Tue Jan 06 20:26:03 2015] [debug] proxy_util.c(2067): proxy: connecting http://okon3.remik.org:7207/OA_HTML/classes/oracle/apps/fnd/jar/fndctx.jar to okon3.remik.org:7207
[Tue Jan 06 20:26:03 2015] [debug] proxy_util.c(2193): proxy: connected /OA_HTML/classes/oracle/apps/fnd/jar/fndctx.jar to okon3.remik.org:7207
[Tue Jan 06 20:26:03 2015] [debug] mod_proxy_http.c(1851): proxy: header only
[Tue Jan 06 20:26:03 2015] [debug] mod_headers.c(756): headers: ap_headers_output_filter()
[Tue Jan 06 20:26:03 2015] [debug] proxy_util.c(2029): proxy: HTTP: has released connection for (okon3.remik.org)
[Tue Jan 06 20:26:03 2015] [debug] mod_proxy_balancer.c(622): proxy_balancer_post_request for (balancer://oacorecluster_oajava)



The same problem. No error, just nothing happens.

MOS:
  * How To Diagnose: Workflow Monitor Status Diagram Failure to Display in Release 11i and 12 (Doc ID 956416.1)
  *> no luck
./oracle/VIS/fs2/EBSapps/10.1.2/j2ee/home/config/oc4j.properties

====== Checking weblogic logs ======
$ tail -f /RYBAK/oracle/VIS/fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/oacore_server1/logs/oacore_server1.log

Nothing, which means that it does not come to oacore_server1 yet. The problem is somehere else.

But I can see logs appearing in
$ less /RYBAK/oracle/VIS/fs2/FMW_Home/user_projects/domains/EBS_domain_VIS/servers/forms_server1/logs/forms_server1.log

Which means that it is comming here!!!

####<Jan 6, 2015 9:42:41 PM CET> <Info> <ServletContext-/forms> <okon1.remik.org> <forms_server1> <[ACTIVE] ExecuteThread: '6' for queue: 'weblogic.kernel.Default (self-tuning)'> <<anonymous>> <> <005307P9mw2Fg4WFLzATOA0002NV00000z> <1420576961306> <BEA-000000> <oracle.apps.fnd.security.AppsFrmservletFilter.getConnection:Adding validation ticket = fsvt=1.14099685895608624548497309535728517491E38>

MOS:
  * FRM-92050 or FRM-92101 When Re-Opening Forms using Internet Explorer 8 On 12.2.3 (Doc ID 1932415.1)

Not exactly the same issue, but what the hell.

ERROR WHEN OPENING FORMS IN IE8 ON MULTI-NODE EBS 12.2.3 (Patch)
p19259764_R12.FND.C_R12_GENERIC.zip	316.0 KB	(323597 bytes)
SHA-1	F8487F0C61D7F04BE23D9C4D2591C15D72B2F48E
MD5	9B504769BA39378FA47DFA6B95899E04

I skipped this patch before.
"Skip this step if you are a new installation customer."

I will install it anyway.

I do not want to go through all the adop cycle (time) I go with the not supported, but available option of applying patch to running edition, as it was done in 11i.

$ cd /RYBAK/oracle/VIS/fs_ne/EBSapps/patch
$ adop phase=apply apply_mode=downtime patches=19259764
adop exiting with status = 0 (Success)

The same issue on the beginning, now after login the same login page appears.

====== After login the same login page appears. ======

This is weird. Lets check if this is 12.2.4

Does it have 12.2.3 patch installed?

> select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '17020683';
no rows selected

That is kind of disappointment.






Looks like someone is having similar issue:
Forms applet not opening in R12.2
https://community.oracle.com/thread/3632312?start=0&tstart=0

==== Consolidated List of Patches and Technology Bug Fixes ====
MOS:
  * Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes (Doc ID 1594274.1)

===== Section 2: Database Patches and Bug Numbers =====
I have used Rapid install 12.2.0.48, applying those named "Not included in any startCD"

$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ opatch lsinventory
$ opatch apply -silent -ocmrf /STAGING/oracle11.2.0.4_x86-64/ocm.rsp

====== + 16989137 ======
DRG-10761 ON SETTING PROCEDURE ATTRIBUTE OF PROCEDURE_FILTER PREFERENCE (Patch)
p16989137_112030_Generic.zip	11.6 KB	MD5	1E1E104D439529DB17B539B76D0308D1
$ md5sum p16989137_112030_Generic.zip
  #1e104d439529db17b539b76d0308d1  p16989137_112030_Generic.zip

$ cd /STAGING/DB_11.2_patches/16989137
$ opatch apply -ocmrf /STAGING/oracle11.2.0.4_x86-64/ocm.rsp
For a RAC environment, perform these steps on only one node.
> @?/sqlpatch/16989137/postinstall.sql

====== + 17875948 ======
MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 16587934 17654622 (Patch)
p17875948_112030_Linux-x86-64.zip	570.2 KB MD5	F7FD987FC9BA4BADACD0E2BB3EC592A9
$ md5sum p17875948_112030_Linux-x86-64.zip
f7fd987fc9ba4badacd0e2bb3ec592a9  p17875948_112030_Linux-x86-64.zip

$ cd /STAGING/DB_11.2_patches
$ opatch apply


====== + 17912217 ======
TRACKING BUG FOR LRG 9760292 (Patch)
p17912217_112030_Linux-x86-64.zip	130.1 KB MD5	0C5329CBC9F13FD39B8A4523140EF0E7
$ md5sum p17912217_112030_Linux-x86-64.zip
0c5329cbc9f13fd39b8a4523140ef0e7  p17912217_112030_Linux-x86-64.zip


$ opatch apply

====== + 18419770 ======
KEY-PRESERVED TABLE IN JOIN VIEW NOT RECOGNIZED WHEN JOINED TABLES HAVE UNQ INDX (Patch)
p18419770_112030_Linux-x86-64.zip	48.7 KB	MD5	C2CDA21D8CB8ECA41634946574B3D270

$ md5sum p18419770_112030_Linux-x86-64.zip
c2cda21d8cb8eca41634946574b3d270  p18419770_112030_Linux-x86-64.zip

$ opatch apply

====== + 18614015 ======
UTL_RECOMP DOES NOT COMPILE INVALID OBJECTS MV WITH STATUS 3 (Patch)
p18614015_112030_Generic.zip	16.1 KB	MD5	EE491C41F86BA4265DB9A78A3CC0DC4B
$ md5sum p18614015_112030_Generic.zip
ee491c41f86ba4265db9a78a3cc0dc4b  p18614015_112030_Generic.zip

$ opatch apply

====== + 18685209 ======
ORA-600 [KKOGBRO: NO KKOAPTYP] (Patch)
p18685209_112030_Linux-x86-64.zip	42.3 KB	MD5	2071A4D8EAC8AF8256B9FAE2BE5C9EEB
$ md5sum p18685209_112030_Linux-x86-64.zip
2071a4d8eac8af8256b9fae2be5c9eeb  p18685209_112030_Linux-x86-64.zip

$ opatch apply

====== + 19078951 ======
MERGE REQUEST ON TOP OF 11.2.0.3.0 FOR BUGS 19063027 14751895 (Patch)
p19078951_112030_Linux-x86-64.zip	1.7 MB	MD5	FCEEF7DF6E4EA76FE0068181A2397553
$ md5sum p19078951_112030_Linux-x86-64.zip
fceef7df6e4ea76fe0068181a2397553  p19078951_112030_Linux-x86-64.zip

$ opatch apply

====== 19393542 ======
TIMESTAMP MISMATCHES ON RULE SET & EVALUATION CONTEXT (Patch)
p19393542_112030_Linux-x86-64.zip	129.1 KB MD5	BFC7972C63F215355EBDA2297751F9F1
$ md5sum p19393542_112030_Linux-x86-64.zip
bfc7972c63f215355ebda2297751f9f1  p19393542_112030_Linux-x86-64.zip

$ opatch apply

====== Back to ../ ======
There were relinks on remote nodes.  Remember to check the binary size and timestamp on the nodes 'usera2' .
$ ls -l $ORACLE_HOME/bin/oracle
  *rwsr-s--x 1 oracle oinstall 232837794 Jan  5 22:32 /u01/oracle/VIS/11.2.0/bin/oracle
  *rwsr-s--x 1 oracle oinstall 232837794 Jan  5 22:32 /u01/oracle/VIS/11.2.0/bin/oracle

Post install sql run (only in one patch)

For a RAC environment, perform these steps on only one node.
> @?/sqlpatch/16989137/postinstall.sql



Technology Codelevel Checker needs to be installed on this instance. It is available as Patch 17537119.
Source DB env
$ ./checkDBpatch.sh
Enter ORACLE_HOME value : /u01/oracle/VIS/11.2.0
Enter ORACLE_SID value : VIS1
Enter ORACLE_SID value : VIS2
All the required one-offs are present in Oracle Database Home






===== Section 3: Application Tier Technology Patches and Bug Numbers =====
We used startCD RapidWizVersion Version 12.2.0.48

====== Section 3.1: Forms and Reports 10.1.2.3 Patches and Bug Numbers ======
Start an online patching cycle.
{{{
$ adop phase=prepare
}}}

Apply the patches to patch edition.

Here we have patches for versions 10.1.2.3.0 or 10.1.0.5.0. Which is the one I need?

We have 10.1.2.3

Decide on patch edition
{{{
$ export ORACLE_HOME=/RYBAK/oracle/VIS/fs1/EBSapps/10.1.2
$ export ORACLE_HOME=/RYBAK/oracle/VIS/fs2/EBSapps/10.1.2
}}}

$ . /RYBAK/oracle/VIS/EBSapps.env patch
$ env | grep ^ORACLE_HOME
ORACLE_HOME=/RYBAK/oracle/VIS/fs2/EBSapps/10.1.2

$ export PATH=$PATH:$ORACLE_HOME/OPatch
$ opatch lsinventory
43) Patch-es installed

======= + 18186693 =======
MERGE REQUEST ON TOP OF 10.1.2.3.2PSU FOR BUGS 17303472 7711752 16806432 (Patch)
p18186693_101232_LINUX.zip	4.7 MB	MD5	124414E306680C379F1E826C77101756
$ cd /STAGING/ebs12patches/18186693
$ opatch apply

======= + 18620223 =======
APPS6: RECORD LOCKING SUSPENDING FIRING OF FORMULA-CALCULATION (Patch)
p18620223_101232_LINUX.zip	13.4 KB	MD5	7C937F34A4DE519F1650985E3EF6A960
$ md5sum p18620223_101232_LINUX.zip
7c937f34a4de519f1650985e3ef6a960  p18620223_101232_LINUX.zip

$ opatch apply

======= + 19434967 =======
MERGE REQUEST ON TOP OF 10.1.2.3.2PSU FOR BUGS 19059675 6161079 10226288 (Patch)
p19434967_101232_LINUX.zip	4.8 MB	MD5	1265E88888764BF284592833570414FF
$ md5sum p19434967_101232_LINUX.zip
  #65e88888764bf284592833570414ff  p19434967_101232_LINUX.zip

$ opatch apply

======= cd ../ =======
?? SPECIAL INSTRUCTION FOR formsapp.ear ??

$ opatch lsinventory | grep -e 18186693 -e 18620223 -e 19434967
  # Patch  19434967 applied on Mon Jan 05 23:22:02 CET 2015

2) Patch  18620223 applied on Mon Jan 05 23:20:29 CET 2015
[ Bug fixes: 18620223  ]

?? Patch 18186693 not reported ?

$ opatch lsinventory



====== Section 3.2: Patches and bug numbers for Oracle Fusion Middleware (FMW) 11.1.1.6 ======

$ export ORACLE_HOME=$IAS_ORACLE_HOME
$ export PATH=$ORACLE_HOME/OPatch:$PATH
$ which opatch
/RYBAK/oracle/VIS/fs2/FMW_Home/webtier/OPatch/opatch

$ opatch lsinventory
Oracle Home       : /RYBAK/oracle/VIS/fs2/FMW_Home/webtier
Oracle WebTier and Utilities CD                                      11.1.1.6.0

We already have those from rapid install 46 and 47: 10638758, 13643211, 14616819, 16199894, 17325559

Installing those Not included in any startCD
======= 13055259 =======
WIP

======= 17555224 =======

======= 17639414 =======

======= 19945419 =======

======= ../ =======




=== Something is too slow ===
Sequential test
$ time dd if=/dev/zero of=/RYBAK/testfile bs=16k count=56384
$ time dd if=./testfile of=/dev/null bs=16k

Random test
https://www.binarylane.com.au/support/articles/1000055889-how-to-benchmark-disk-i-o

$ fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75

==== MT1 ====
Sequential test on NFS shared storage
$ time dd if=/dev/zero of=/RYBAK/testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 28.7702 seconds, 32.1 MB/s
real	0m28.845s

$ time dd if=./testfile of=/dev/null bs=16k
923795456 bytes (924 MB) copied, 23.838 seconds, 38.8 MB/s
real	0m23.859s

Random test on NFS shared storage
$ fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75
read : io=784996KB, bw=737876B/s, iops=180, runt=1089391msec
write: io=263580KB, bw=247758B/s, iops=60, runt=1089391msec


==== MT2 ====
Sequential test on NFS shared storage
$ time dd if=/dev/zero of=./testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 27.6094 seconds, 33.5 MB/s
real	0m27.868s

$ time dd if=./testfile of=/dev/null bs=16k
923795456 bytes (924 MB) copied, 19.0143 seconds, 48.6 MB/s
real	0m19.031s

Random test on NFS shared storage
read : io=784996KB, bw=754412B/s, iops=184, runt=1065512msec
write: io=263580KB, bw=253311B/s, iops=61, runt=1065512msec


==== MT3 ====
Sequential test on NFS shared storage
$ time dd if=/dev/zero of=./testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 90.1964 seconds, 10.2 MB/s
real	1m30.468s

$ time dd if=./testfile of=/dev/null bs=16k
923795456 bytes (924 MB) copied, 32.4462 seconds, 28.5 MB/s
real	0m32.456s

Random test on NFS shared storage
read : io=784996KB, bw=758551B/s, iops=185, runt=1059698msec
write: io=263580KB, bw=254700B/s, iops=62, runt=1059698msec

  *---
This 10.2 MB/s is suspicious and suggests network card that is using 100Mb and not 1000Mb. Turns out this was true, that was actually an ESX VM machine that was converted from VirtualBox and network card was in "Flexible" mode which turned out to be slow. Changed to VMXNET 3 and now it looks better.

$ time dd if=/dev/zero of=./testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 25.5814 seconds, 36.1 MB/s
real	0m25.769s

$ time dd if=./testfile of=/dev/null bs=16k
923795456 bytes (924 MB) copied, 0.149666 seconds, 6.2 GB/s - this is too good to be true, some cache
real	0m0.159s

$ fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75
test: (g=0): rw=randrw, bs=4K-4K/4K-4K/4K-4K, ioengine=libaio, iodepth=64
read : io=784996KB, bw=1088.2KB/s, iops=272, runt=721418msec
write: io=263580KB, bw=374132B/s, iops=91, runt=721418msec









==== on DB ====
Sequential test on Local FS
$ time dd if=/dev/zero of=./testfile bs=16k count=56384
923795456 bytes (924 MB) copied, 9.99278 s, 92.4 MB/s  (probably some cache)
real	0m16.974s

$ time dd if=./testfile of=/dev/null bs=16k
923795456 bytes (924 MB) copied, 34.0162 s, 27.2 MB/s
real	0m34.068s

Random test on Local FS
$ fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75
read : io=436944KB, bw=394880B/s, iops=96, runt=1133079msec
write: io=146428KB, bw=132331B/s, iops=32, runt=1133079msec

Test on ASM, probably with ORION but now I want something trivial
> create tablespace USERS datafile '+DATA' size 2G autoextend on maxsize 20G;
Fri Jan 09 15:24:05 2015
create tablespace USERS datafile '+DATA' size 2G autoextend on maxsize 20G
Fri Jan 09 15:24:57 2015
Completed: create tablespace USERS datafile '+DATA' size 2G autoextend on maxsize 20G

set timing on
create table perf tablespace users
as select * from (
select * from dba_objects union all
select * from dba_objects union all
select * from dba_objects union all
select * from dba_objects union all
select * from dba_objects union all
select * from dba_objects
);
Elapsed: 00:00:39.78


create table perf2 tablespace users
as select * from (
select * from perf union all
select * from perf union all
select * from perf union all
select * from perf union all
select * from perf union all
select * from perf union all
select * from perf union all
select * from perf
);
Elapsed: 00:02:00.52

create table perf3 tablespace users
as select * from (
select * from perf2 union all
select * from perf2 union all
select * from perf2 union all
select * from perf2 union all
select * from perf2 union all
select * from perf2 union all
select * from perf2 union all
select * from perf2
);

Elapsed: 00:22:37.64


This is weird, I see something like this:
sdc       97%   15.4   15.8|RRRRRRRRRRRRRRRRRRRRRRRRRWWWWWWWWWWWWWWWWWWWWWWW>|â
âsdc1      97%   15.4   15.8|RRRRRRRRRRRRRRRRRRRRRRRRRWWWWWWWWWWWWWWWWWWWWWWW>|â
âsdd       16%    0.5    0.0|RRRRRRRRW  >                                     |â
âsdd1      16%    0.5    0.0|RRRRRRRRW  >

Disk /dev/sdc: 256.0 GB, 255986761728 bytes
Disk /dev/sdd: 5268 MB, 5268045824 bytes

# /usr/sbin/oracleasm listdisks
DATA1
DATA2

# /usr/sbin/oracleasm querydisk -p DATA1
Disk "DATA1" is a valid ASM disk
/dev/sdd1: LABEL="DATA1" TYPE="oracleasm"

# /usr/sbin/oracleasm querydisk -p DATA2
Disk "DATA2" is a valid ASM disk
/dev/sdc1: LABEL="DATA2" TYPE="oracleasm"

  *> so it is OK.

After changing all the patchcords to Cat 6:

> create table perf2 tablespace users (...)
Elapsed: 00:01:41.96

> create table perf3 tablespace users (...)
Elapsed: 00:13:53.54 - 148430208 rows

ORION test (just reads, not to destroy data on disks)

$ mkdir orion_test
$ cd orion_test
$ vi orion.lun
/dev/sdd1
/dev/sdc1
$ which orion
/u01/oracle/VIS/11.2.0/bin/orion
# /u01/oracle/VIS/11.2.0/bin/orion -run simple
Maximum Small IOPS=91 @ Small=1 and Large=0
Small Read Latency: avg=10870 us, min=129 us, max=136578 us, std dev=6348 us @ Small=1 and Large=0

Minimum Small Latency=10870 usecs @ Small=1 and Large=0
Small Read Latency: avg=10870 us, min=129 us, max=136578 us, std dev=6348 us @ Small=1 and Large=0
Small Read / Write Latency Histogram @ Small=1 and Large=0
Latency:		# of IOs (read) 	 # of IOs (write)
0 - 1		us:		0			0
2 - 4		us:		0			0
4 - 8		us:		0			0
8 - 16		us:		0			0
  # - 32		us:		0			0
32 - 64		us:		0			0
64 - 128		us:		0			0
  #8 - 256		us:		171			0
256 - 512		us:		270			0
512 - 1024	us:		2			0
  #24 - 2048	us:		0			0
2048 - 4096	us:		21			0
4096 - 8192	us:		1244			0
8192 - 16384	us:		3403			0
  #384 - 32768	us:		338			0
32768 - 65536	us:		65			0
65536 - 131072	us:		2			0
  #1072 - 262144	us:		1			0


===== Checking how is it on DB on local disk, not RAC with openfiler. =====

# /usr/sbin/oracleasm listdisks
DATA1
# /usr/sbin/oracleasm querydisk -p DATA1
Disk "DATA1" is a valid ASM disk
/dev/sdc1: LABEL="DATA1" TYPE="oracleasm"

$ mkdir orion_test
$ cd orion_test
$ vi orion.lun
$ pwd
/home/oracle/orion_test
$ which orion
# cd /home/oracle/orion_test
# /u01/app/oracle/product/11.2.0/dbhome_1/bin/orion -run simple
Maximum Large MBPS=224.38 @ Small=0 and Large=2

Maximum Small IOPS=524 @ Small=5 and Large=0
Small Read Latency: avg=9530 us, min=16 us, max=69419 us, std dev=17829 us @ Small=5 and Large=0

Minimum Small Latency=1956 usecs @ Small=1 and Large=0
Small Read Latency: avg=1956 us, min=14 us, max=44873 us, std dev=3845 us @ Small=1 and Large=0
Small Read / Write Latency Histogram @ Small=5 and Large=0
Latency:		# of IOs (read) 	 # of IOs (write)
0 - 1		us:		0			0
2 - 4		us:		0			0
4 - 8		us:		0			0
8 - 16		us:		1			0
  # - 32		us:		13523			0
32 - 64		us:		5339			0
64 - 128		us:		4565			0
  #8 - 256		us:		95			0
256 - 512		us:		24			0
512 - 1024	us:		9			0
  #24 - 2048	us:		24			0
2048 - 4096	us:		856			0
4096 - 8192	us:		2535			0
8192 - 16384	us:		3656			0

Much better here. Even thou it is a very simple one node DB.







==== 12.2.3 patch is taking way too much time, almost 24h ====

60     2220972027 SYSTEM	 14840
SELECT RIDX.OWNER OWNER , RIDX.INDEX_NAME REVISED_INDEX , RIDX.TABLE_OWNER TABLE_OWNER , RIDX.TABLE_NAME TABLE_NAME , OIDX.INDEX_NAME ORIGINAL_INDEX , CON.CONSTRAINT_NAME CONSTRAINT_NAME FROM DBA_INDE

> select sql_text from v$sqltext where hash_value=2220972027 order by piece asc;

> EXEC DBMS_STATS.GATHER_DICTIONARY_STATS;
> exec DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;

already cutover

ADZDWRKR.sql

/RYBAK/oracle/VIS/fs_ne/EBSapps/log/adop/11/cutover_20150108_185610/VIS_okon1/log
# tail -f cutover.log

Starting phase 0 (A0): con


There are now 2 jobs remaining (current phase=A0):
0 running, 1 ready to run and 1 waiting.

Assigned: file ADZDWRKR.sql on worker  1 for product ad  username APPLSYS.

MOS:
  * ADZDWRKR.sql Is Running On 8 Workers For Long Time (Doc ID 1946877.1)




=== Start/Stop MT ===

http://okon1.remik.org:7006/console

==== Start ====
. /RYBAK/oracle/VIS/EBSapps.env run

okon1
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon1.env
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstrtal.sh apps/apps

okon2
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon2.env
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstrtal.sh apps/apps

okon3
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon3.env
$ env | grep FILE_EDITION
FILE_EDITION=run
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstrtal.sh apps/apps

==== Stop ====
. /RYBAK/oracle/VIS/EBSapps.env run

okon3
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon3.env
$ env | grep FILE_EDITION
FILE_EDITION=run
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps

okon2
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon2.env
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps

okon1
$ . /RYBAK/oracle/VIS/fs1/EBSapps/appl/APPSVIS_okon1.env
$ cd $ADMIN_SCRIPTS_HOME
$ ./adstpall.sh apps/apps




== Nice links: ==
  * Sharing The Application Tier File System in Oracle E-Business Suite Release 12 (Doc ID 384248.1)
Section 4: Adding a Node to a Shared Application Tier File System
  * Troubleshooting RapidClone issues with Oracle Applications R12 (Doc ID 603104.1)
  * OracleÂ® E-Business Suite Installation Guide: Using Rapid Install
  * Best Practices for Minimizing Oracle EBS R12.2.n Upgrade Downtime Presentation		(PDF 222 KB)
  * Cloning Oracle E-Business Suite Release 12.2 with Rapid Clone (Doc ID 1383621.1)
5.4 Deleting an Application Tier Node
  * Configuring Applications Node Services in Oracle E-Business Suite Release 12 (Doc ID 406558.1)
  * Using the Online Patching Readiness Report in Oracle E-Business Suite Release 12.2 (Doc ID 1531121.1)
  * Troubleshooting Forms Applet issues in E-Business Suite (Doc ID 1300317.1)
  * Using Forms Socket Mode with Oracle E-Business Suite Release 12 (Doc ID 384241.1)
  * R12: Forms Runtime Diagnostics (FRD), Tracing And Logging For Forms In Oracle Applications (Doc ID 438652.1)
NOTE:389422.1 - Recommended Browsers for Oracle E-Business Suite Release 12
NOTE:393931.1 - Deploying JRE (Native Plug-in) for Windows Clients in Oracle E-Business Suite Release 12
NOTE:421245.1 - E-Business Suite Diagnostics References for R12
NOTE:364439.1 - Tips and Queries for Troubleshooting Advanced Topologies
  * Best Practices for Minimizing Oracle EBS R12.2.n Upgrade Downtime Whitepaper		(PDF 675 KB)



Latest file(s) in directory (recursively)
$ find . -type f -printf '%T@ %pn' | sort -n | tail -1 | cut -f2- -d" "


== Verify application tier failover ==
Change the profile FND: Diagnostics to Yes on site and user sysadmin level to enable database host info.

=== Checking how it works now ===
Login as sysadmin
System Administrator -> Requests -> View / Help -> About Oracle Application

At this test:
Machine : usera1.remik.org

Login to usera1.remik.org
> shutdown abort

Receivin errors from forms: FRM-40735, Closing forms.

Trying to login again. Blank new browser window appears, with only a name 'Window' and nothing happens. This is the moment where forms were supposed to open.

Loging to master app tier.

$ tnsping VIS
Attempting to contact (DESCRIPTION= (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.56)(PORT=1521)) (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.54)(PORT=1521)) (ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.55)(PORT=1521)) (CONNECT_DATA= (SERVICE_NAME=VIS) (INSTANCE_NAME=VIS1)))
OK (10 msec)

$ sqlplus apps
ORA-12521: TNS:listener does not currently know of instance requested in
connect descriptor

There is SERVICE_NAME=VIS and? INSTANCE_NAME=VIS1 - weird

=== Fixing manually ===
He tries to connect using scan listener hosts, but not scan listener name, weird too.

$ nslookup usera-scan
Name:	usera-scan.remik.org
Address: 192.168.1.55
Name:	usera-scan.remik.org
Address: 192.168.1.56
Name:	usera-scan.remik.org
Address: 192.168.1.54

On usera1:
eth0:2 inet addr:192.168.1.55

On usera2:
eth0:1 inet addr:192.168.1.54

Ok, that could work.

But this instance name?

Changing tnsnames
form:
VIS=
(DESCRIPTION=
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.56)(PORT=1521))
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.54)(PORT=1521))
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.55)(PORT=1521))
(CONNECT_DATA=
(SERVICE_NAME=VIS)
(INSTANCE_NAME=VIS1)
)
)

to:
VIS=
(DESCRIPTION=
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.56)(PORT=1521))
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.54)(PORT=1521))
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.55)(PORT=1521))
(CONNECT_DATA=
(SERVICE_NAME=VIS)
)
)

Now I can login with sqlplus
$ sqlplus apps/apps

Trying to login from application and open forms
that works!!

So easy? Once again from start. It is working.

Reverting changes done to listeners during: DBCA fails Can not Connect to Database/Instance in Multiple Listener Environment
> alter system set local_listener='VIS1_LOCAL' sid='VIS1';
> alter system set local_listener='VIS2_LOCAL' sid='VIS2';

OK, it worked again.

Checking how will the tnsnames.ora on app tier look like after autoconfig
$ cd $ADMIN_SCRIPTS_HOME
$ ./adautocfg.sh

Now the tnsname.ora that we edidted before is overwritten.

=== Reading some docs ===
Actually better idea ist to follow:
MOS:
  * Using Oracle 11g Release 2 Real Application Clusters and Automatic storage management with Oracle E-Business Suite Release 12.2 (Doc ID 1453213.1)
  * Concurrent Processing - How To Ensure Load Balancing Of Concurrent Manager Processes In PCP-RAC Configuration (Doc ID 762024.1)
  * Configuring and Managing E-Business Application Tier for RAC (Doc ID 1311528.1)


=== Verify listener status ===

Local listener, Source DB env
$ cd /u01/oracle/VIS/11.2.0/appsutil/scripts/VIS1_usera1
$ ./addlnctl.sh status VIS
Listener Parameter File   /u01/oracle/VIS/11.2.0/network/admin/VIS1_usera1/listener.ora
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1526)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1526)))
Services Summary...
Service "VIS" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Service "VIS1" has 1 instance(s).
Instance "VIS1", status UNKNOWN, has 1 handler(s) for this service...
Service "ebs_patch" has 1 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
The command completed successfully


Grid listener, source grid env
$ lsnrctl status
Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.50)(PORT=1521)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.52)(PORT=1521)))
Services Summary...
Service "+ASM" has 1 instance(s).
Instance "+ASM1", status READY, has 1 handler(s) for this service...
The command completed successfully

Scan listener, source grid env
$ srvctl status SCAN_listener
SCAN Listener LISTENER_SCAN1 is enabled
SCAN listener LISTENER_SCAN1 is running on node usera2
SCAN Listener LISTENER_SCAN2 is enabled
SCAN listener LISTENER_SCAN2 is running on node usera1
SCAN Listener LISTENER_SCAN3 is enabled
SCAN listener LISTENER_SCAN3 is running on node usera1

$ srvctl config scan
SCAN name: usera-scan, Network: 1/192.168.1.0/255.255.255.0/eth0
SCAN VIP name: scan1, IP: /usera-scan/192.168.1.54
SCAN VIP name: scan2, IP: /usera-scan/192.168.1.55
SCAN VIP name: scan3, IP: /usera-scan/192.168.1.56

$ lsnrctl status LISTENER_SCAN2
Listener Parameter File   /u01/app/11.2.0/grid/network/admin/listener.ora
Listening Endpoints Summary...
(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER_SCAN2)))
(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.55)(PORT=1521)))
Services Summary...
Service "VIS" has 2 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Instance "VIS2", status READY, has 1 handler(s) for this service...
Service "ebs_patch" has 2 instance(s).
Instance "VIS1", status READY, has 1 handler(s) for this service...
Instance "VIS2", status READY, has 1 handler(s) for this service...
The command completed successfully


=== Performing permanent changes ===
Following:
MOS:
  * Using Oracle 11g Release 2 Real Application Clusters and Automatic storage management with Oracle E-Business Suite Release 12.2 (Doc ID 1453213.1)

Following: 4.7.2 Set Up Load Balancing

$ env | grep TWO_TASK
TWO_TASK=VIS

Modify the $CONTEXT_FILE
$ cp $CONTEXT_FILE ${CONTEXT_FILE}_lb_`date -I`
$ vim $CONTEXT_FILE
$ diff $CONTEXT_FILE ${CONTEXT_FILE}_lb_`date -I`
399c399
<          <TWO_TASK oa_var="s_tools_twotask" osd="unix">VIS_BALANCE</TWO_TASK>
  *--
>          <TWO_TASK oa_var="s_tools_twotask" osd="unix">VIS</TWO_TASK>
414c414
<          <TWO_TASK oa_var="s_weboh_twotask" osd="unix">VIS_BALANCE</TWO_TASK>
  *--
>          <TWO_TASK oa_var="s_weboh_twotask" osd="unix">VIS</TWO_TASK>

Autoconfig
$ cd $ADMIN_SCRIPTS_HOME
$ ./adautocfg.sh

$ env | grep TWO_TASK
TWO_TASK=VIS_BALANCE

$ sqlplus apps/apps
> show parameter instance_name
instance_name			     string	 VIS1

> shutdown abort on VIS1

$ sqlplus apps/apps
> show parameter instance_name
instance_name			     string	 VIS2

> startup on VIS1
> shutdown abort on VIS2

$ sqlplus apps/apps
> show parameter instance_name
instance_name			     string	 VIS1

Conclusion:
  *> all work nicely

Checking the application failover.
  *> works fine, after DB1 fails, next login goes to DB2

Note! I have not changed the s_cp_twotask as advised by (Doc ID 762024.1), which is for 12.1.

After setting TWO_TASK to the load balancing alias, the ADOP cleanup and cutover phases will fail. In order to workaround this problem:

ADOP Cleanup: Copy the adalldefaults.txt file from $APPL_TOP/admin/<sid>/ to the $APPL_TOP/admin/<balance_alias> directory on RUN file system.
$ diff $APPL_TOP/admin/VIS/adalldefaults.txt $APPL_TOP/admin/VIS_BALANCE/adalldefaults.txt
  *> files exist and are the same

WIP: Check if adop cycle will update the context file on the patch edition


=== Check all the relevant places to confirm that we use balance connection ===
Checks as per: Using Oracle 11g Release 2 Real Application Clusters and Automatic storage management with Oracle E-Business Suite Release 12.2 (Doc ID 1453213.1)
5.2.3 Application Tier Install

$ grep s_apps_jdbc_connect_descriptor $CONTEXT_FILE
<jdbc_url oa_var="s_apps_jdbc_connect_descriptor">jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=YES)(FAILOVER=YES)(ADDRESS=(PROTOCOL=tcp)(HOST=usera-scan)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=VIS)))</jdbc_url>

$ grep s_apps_jdbc_patch_connect_descriptor $CONTEXT_FILE
<patch_jdbc_url oa_var="s_apps_jdbc_patch_connect_descriptor">jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=usera-scan)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=ebs_patch)(INSTANCE_NAME=VIS1)))</patch_jdbc_url>

$ cat $FND_SECURE/VIS.dbc | grep APPS_JDBC_URL
APPS_JDBC_URL=jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(LOAD_BALANCE=YES)(FAILOVER=YES)(ADDRESS=(PROTOCOL=tcp)(HOST=usera-scan)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=VIS)))




=== Requests with status: Inactive No Manager ===
If I shutdown the DB1, then the Standard Manager stops to process the requests.

Following MOS:
  * Configuring and Managing E-Business Application Tier for RAC (Doc ID 1311528.1)

==== 3.1.1 Steps to configure Parallel Concurrent Processing ====
==== 1. Change the context variables s_cp_two task to <sid>_BALANCE alias in the context file. ====

$ cp $CONTEXT_FILE ${CONTEXT_FILE}_s_cp_two_`date -I`
$ vim $CONTEXT_FILE
$ diff $CONTEXT_FILE ${CONTEXT_FILE}_s_cp_two_`date -I`
400c400
<          <CP_TWOTASK oa_var="s_cp_twotask">VIS_BALANCE</CP_TWOTASK>
  *--
>          <CP_TWOTASK oa_var="s_cp_twotask">VIS</CP_TWOTASK>



Target node/queue unavailable

==== 2. To enable reviver modify s_cp_reviver to enabled. ====
$ grep s_cp_reviver $CONTEXT_FILE
<cp_reviver oa_var="s_cp_reviver">enabled</cp_reviver>

==== 3. Run Autoconfig and verify that the configuration files tnsnames.ora andlistener.ora files have FNDSM entries for all nodes. ====
Autoconfig
$ cd $ADMIN_SCRIPTS_HOME
$ ./adautocfg.sh


$ cd /RYBAK/oracle/VIS/fs1/inst/apps/VIS_okon1/ora/10.1.2/network/admin
$ grep -i FNDSM tnsnames.ora
FNDSM_OKON3_VIS=
FNDSM_OKON1_VIS=
FNDSM_OKON2_VIS=

==== 4. Restart the application listener process on all application nodes. ====
Restart MT




==== 7. In Parallel Concurrent Processing implementation when the concurrent tier and database tier are different, then there are two options to provide high availability, depending upon the value of the profile 'Concurrent:PCP Instance Check ' . ====




= Upgrading to AD.6 =

Patch 19197270:R12.AD.C.Delta.6
Patch 19330775:R12.TXK.C.Delta.6

https://blogs.oracle.com/stevenChan/entry/12_2_ad_txk_delta

MOS:
  * Oracle E-Business Suite Applications DBA and Technology Stack Release Notes for R12.AD.C.Delta.6 and R12.TXK.C.Delta.6 (Note 1983782.1)
  * Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Note 1617461.1)

Following Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Note 1617461.1)

== Section 1: Preparation ==
Download and unzip all the patches to the default patch location

R12.AD.C.DELTA.6 PATCH (Patchset)
p19197270_R12.AD.C_R12_LINUX.zip	3.3 MB	MD5	C9DFAAB46549BD3A017AAC5B2D55345E

R12.TXK.C.DELTA.6 (Patchset)
p19330775_R12.TXK.C_R12_GENERIC.zip	57.8 MB	MD5	45519AE7E5668CA93B173CA14CDECBE8

$ cd /STAGING/ebs12patches
$ md5sum p19197270_R12.AD.C_R12_LINUX.zip p19330775_R12.TXK.C_R12_GENERIC.zip
c9dfaab46549bd3a017aac5b2d55345e  p19197270_R12.AD.C_R12_LINUX.zip
45519ae7e5668ca93b173ca14cdecbe8  p19330775_R12.TXK.C_R12_GENERIC.zip

$ unzip -o p19197270_R12.AD.C_R12_LINUX.zip
$ unzip -o p19330775_R12.TXK.C_R12_GENERIC.zip

== Section 2: Apply Required Database Patches ==
List of missing bug fixes:
  #608907

According to the doc: Database Patch Set Update Overlay Patches Required for Use with PSUs and Oracle E-Business Suite (Doc ID 1147107.1)

"If the EBS Technology Codelevel Checker  reports missing fixes then contact Oracle Support. You may disregard the  error if it reports Patch 17608907 as missing as long as Patch 18893947  has been applied."

== Section 3: Apply the R12.AD.C.Delta.6 and R12.TXK.C.Delta.6 Release Update Packs ==
Going with: Already using Oracle E-Business Suite Release 12.2 (below AD-TXK Delta 6 codelevel)	Path B

=== 1. Source the run edition environment file. ===
$ . /u01/oracle/VIS/EBSapps.env run

=== 2. Start new online patching cycle. ===
$ adop phase=prepare

=== 3. Apply the latest embedded application tier technology patches on the patch file system. ===

From a separate session, source the patch edition environment file.
$ . /u01/oracle/VIS/EBSapps.env patch

On the patch file system, apply the latest application tier technology patches documented in 'Section 3: Application Tier Technology Patches and Bug Numbers' of My Oracle Support Knowledge Document 1594274.1, Oracle E-Business Suite Release 12.2: Consolidated List of Patches and Technology Bug Fixes.

Note: The latest AD-TXK codelevel has a dependency on Oracle Fusion Middleware Patch 19462638.

  *> We recently performed the upgrade to 12.2.4 and all the patches are installed, together with patch 19462638.

Source the run edition environment file.
$ . /u01/oracle/VIS/EBSapps.env run

=== 4. Unzip patches and run adgrants. ===
Download and unzip the following patches:
$ cd /STAGING/ebs12patches
  *> done already

Execute adgrants by following the instructions in the readme of Patch 19197270:R12.AD.C.Delta.6.
$ cd /STAGING/ebs12patches/19197270/admin

Copy that to db node
$ scp adgrants.sql oracle@ebsdb4:/u01/oracle/VIS/11204/appsutil/admin

On DB node run adgrants
> @?/appsutil/admin/adgrants.sql apps

=== 5. Apply Patch 19197270:R12.AD.C.Delta.6 ===
$ adop phase=apply patches=19197270 patchtop=/STAGING/ebs12patches

[WARNING]   The following required database bug fixes <16299727,19393542>
are missing from this node, <ebsdb4>.

$ opatch lsinventory | grep 16299727
  #299727, 17781991
$ opatch lsinventory | grep 19393542
Patch  19393542     : applied on Tue Mar 31 15:39:31 CEST 2015
  #393542

  *> one mentioned missing patch is part of some other, another is installed
Log file: /u01/oracle/VIS/fs_ne/EBSapps/log/adop/28/adop_20150331_170841.log
adop exiting with status = 0 (Success)


=== 6. Apply Patch 19330775:R12.TXK.C.Delta.6 ===
$ adop phase=apply patches=19330775 patchtop=/STAGING/ebs12patches



=== 7. Apply Patch 19259764:R12.FND.C. ===
select BUG_ID, BUG_NUMBER, LAST_UPDATE_DATE from APPLSYS.AD_BUGS where BUG_NUMBER = '19259764'

BUG_ID BUG_NUMBER			  LAST_UPDATE_DATE
  *--------- ------------------------------ ------------------
937486 19259764			  12-JAN-15

  *> this patch has already been applied

=== 8. Complete the online patching cycle by running the following commands in the order shown. ===

$ adop phase=finalize
$ adop phase=cutover
Relogin
$ . /u01/oracle/VIS/EBSapps.env run
$ adop phase=cleanup
[UNEXPECTED]Error occurred while performing database validations

MOS:
  * Error Occurred Performing Database Validations Applying Patch 19330775 (Doc ID 1993838.1)

> select name from v$parameter where name='_system_trig_enabled';
no rows selected

> alter system set "_system_trig_enabled"=true scope=both;

$ adop phase=cleanup
adop phase=cleanup - Completed Successfully

=== 9. Synchronize file systems ===
$ adop phase=fs_clone

Done with: Applying the Latest AD and TXK Release Update Packs to Oracle E-Business Suite Release 12.2 (Note 1617461.1)





== Applying a patch when AD.6 is in place ==

I just picked a random patch to install, just to see how adop behives now.

Patch 17189881: FND_STATS.RESTORE_SCHEMA_STATS FOR ALL SCHEMA IS FAILED

FND_STATS.RESTORE_SCHEMA_STATS FOR ALL SCHEMA IS FAILED (Patch)
p17189881_R12.FND.C_R12_GENERIC.zip	55.1 KB	MD5	622860627D6C1503CA9AA841EE37A470

$ adop phase=prepare
[WARNING]   ETCC: The following database fixes are not applied in node ebsdb4
  #608907
adop phase=prepare - Completed Successfully

$ md5sum p17189881_R12.FND.C_R12_GENERIC.zip
622860627d6c1503ca9aa841ee37a470  p17189881_R12.FND.C_R12_GENERIC.zip
$ unzip -o p17189881_R12.FND.C_R12_GENERIC.zip
$ adop phase=apply patches=17189881 patchtop=/STAGING/ebs12patches
[WARNING]   ETCC: The following database fixes are not applied in node ebsdb4
  #608907
adop phase=apply - Completed Successfully

$ adop phase=cutover
[WARNING]   ETCC: The following database fixes are not applied in node ebsdb4
  #608907
adop phase=cutover - Completed Successfully


OK, done. We are able to patch even thou one patch is reported as missing by ETCC.


